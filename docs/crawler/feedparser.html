<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>feedparser.py</title>
  <link rel="stylesheet" href="../pycco.css">
</head>
<body>
<div id="background"></div>
<div id='container'>
  
  <div class='section'>
    <div class='docs'><h1>feedparser.py</h1></div>
  </div>
  <div class='clearall'>
  <div class='section' id='section-0'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-0'>#</a>
      </div>
      <p>Universal feed parser</p>
<p>Handles RSS 0.9x, RSS 1.0, RSS 2.0, CDF, Atom 0.3, and Atom 1.0 feeds</p>
<p>Visit http://feedparser.org/ for the latest version
Visit http://feedparser.org/docs/ for the latest documentation</p>
<p>Required: Python 2.1 or later
Recommended: Python 2.3 or later
Recommended: CJKCodecs and iconv_codec <a href="http://cjkpython.i18n.org/">http://cjkpython.i18n.org/</a></p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="n">__version__</span> <span class="o">=</span> <span class="s">&quot;4.1&quot;</span><span class="c"># + &quot;$Revision: 1.92 $&quot;[11:15] + &quot;-cvs&quot;</span>
<span class="n">__license__</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;Copyright (c) 2002-2006, Mark Pilgrim, All rights reserved.</span>

<span class="s">Redistribution and use in source and binary forms, with or without modification,</span>
<span class="s">are permitted provided that the following conditions are met:</span>

<span class="s">* Redistributions of source code must retain the above copyright notice,</span>
<span class="s">  this list of conditions and the following disclaimer.</span>
<span class="s">* Redistributions in binary form must reproduce the above copyright notice,</span>
<span class="s">  this list of conditions and the following disclaimer in the documentation</span>
<span class="s">  and/or other materials provided with the distribution.</span>

<span class="s">THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &#39;AS IS&#39;</span>
<span class="s">AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span>
<span class="s">IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</span>
<span class="s">ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE</span>
<span class="s">LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR</span>
<span class="s">CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF</span>
<span class="s">SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS</span>
<span class="s">INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN</span>
<span class="s">CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)</span>
<span class="s">ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</span>
<span class="s">POSSIBILITY OF SUCH DAMAGE.&quot;&quot;&quot;</span>
<span class="n">__author__</span> <span class="o">=</span> <span class="s">&quot;Mark Pilgrim &lt;http://diveintomark.org/&gt;&quot;</span>
<span class="n">__contributors__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Jason Diamond &lt;http://injektilo.org/&gt;&quot;</span><span class="p">,</span>
                    <span class="s">&quot;John Beimler &lt;http://john.beimler.org/&gt;&quot;</span><span class="p">,</span>
                    <span class="s">&quot;Fazal Majid &lt;http://www.majid.info/mylos/weblog/&gt;&quot;</span><span class="p">,</span>
                    <span class="s">&quot;Aaron Swartz &lt;http://aaronsw.com/&gt;&quot;</span><span class="p">,</span>
                    <span class="s">&quot;Kevin Marks &lt;http://epeus.blogspot.com/&gt;&quot;</span><span class="p">]</span>
<span class="n">_debug</span> <span class="o">=</span> <span class="mi">0</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-1'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-1'>#</a>
      </div>
      <p>HTTP "User-Agent" header to send to servers when downloading feeds.
If you are embedding feedparser in a larger application, you should
change this to your application name and URL.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="n">USER_AGENT</span> <span class="o">=</span> <span class="s">&quot;UniversalFeedParser/</span><span class="si">%s</span><span class="s"> +http://feedparser.org/&quot;</span> <span class="o">%</span> <span class="n">__version__</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-2'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-2'>#</a>
      </div>
      <p>HTTP "Accept" header to send to servers when downloading feeds.  If you don't
want to send an Accept header, set this to None.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="n">ACCEPT_HEADER</span> <span class="o">=</span> <span class="s">&quot;application/atom+xml,application/rdf+xml,application/rss+xml,application/x-netcdf,application/xml;q=0.9,text/xml;q=0.2,*/*;q=0.1&quot;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-3'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-3'>#</a>
      </div>
      <p>List of preferred XML parsers, by SAX driver name.  These will be tried first,
but if they're not installed, Python will keep searching through its own list
of pre-installed parsers until it finds one that supports everything we need.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="n">PREFERRED_XML_PARSERS</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;drv_libxml2&quot;</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-4'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-4'>#</a>
      </div>
      <p>If you want feedparser to automatically run HTML markup through HTML Tidy, set
this to 1.  Requires mxTidy <a href="http://www.egenix.com/files/python/mxTidy.html">http://www.egenix.com/files/python/mxTidy.html</a>
or utidylib <a href="http://utidylib.berlios.de/">http://utidylib.berlios.de/</a>.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="n">TIDY_MARKUP</span> <span class="o">=</span> <span class="mi">0</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-5'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-5'>#</a>
      </div>
      <p>List of Python interfaces for HTML Tidy, in order of preference.  Only useful
if TIDY_MARKUP = 1</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="n">PREFERRED_TIDY_INTERFACES</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;uTidy&quot;</span><span class="p">,</span> <span class="s">&quot;mxTidy&quot;</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-6'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-6'>#</a>
      </div>
      <p>---------- required modules (should come with any Python distribution) ----------</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="kn">import</span> <span class="nn">sgmllib</span><span class="o">,</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">copy</span><span class="o">,</span> <span class="nn">urlparse</span><span class="o">,</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">rfc822</span><span class="o">,</span> <span class="nn">types</span><span class="o">,</span> <span class="nn">cgi</span><span class="o">,</span> <span class="nn">urllib</span><span class="o">,</span> <span class="nn">urllib2</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">cStringIO</span> <span class="kn">import</span> <span class="n">StringIO</span> <span class="k">as</span> <span class="n">_StringIO</span>
<span class="k">except</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">StringIO</span> <span class="kn">import</span> <span class="n">StringIO</span> <span class="k">as</span> <span class="n">_StringIO</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-7'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-7'>#</a>
      </div>
      <p>---------- optional modules (feedparser will work without these, but with reduced functionality) ----------</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-8'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-8'>#</a>
      </div>
      <p>gzip is included with most Python distributions, but may not be available if you compiled your own</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">gzip</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">gzip</span> <span class="o">=</span> <span class="bp">None</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">zlib</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">zlib</span> <span class="o">=</span> <span class="bp">None</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-9'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-9'>#</a>
      </div>
      <p>If a real XML parser is available, feedparser will attempt to use it.  feedparser has
been tested with the built-in SAX parser, PyXML, and libxml2.  On platforms where the
Python distribution does not come with an XML parser (such as Mac OS X 10.2 and some
versions of FreeBSD), feedparser will quietly fall back on regex-based parsing.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">xml.sax</span>
    <span class="n">xml</span><span class="o">.</span><span class="n">sax</span><span class="o">.</span><span class="n">make_parser</span><span class="p">(</span><span class="n">PREFERRED_XML_PARSERS</span><span class="p">)</span> <span class="c"># test for valid parsers</span>
    <span class="kn">from</span> <span class="nn">xml.sax.saxutils</span> <span class="kn">import</span> <span class="n">escape</span> <span class="k">as</span> <span class="n">_xmlescape</span>
    <span class="n">_XML_AVAILABLE</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">_XML_AVAILABLE</span> <span class="o">=</span> <span class="mi">0</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-10'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-10'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_xmlescape</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&amp;&#39;</span><span class="p">,</span> <span class="s">&#39;&amp;amp;&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;&amp;gt;&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s">&#39;&amp;lt;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-11'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-11'>#</a>
      </div>
      <p>base64 support for Atom feeds that contain embedded binary data</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">base64</span><span class="o">,</span> <span class="nn">binascii</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">base64</span> <span class="o">=</span> <span class="n">binascii</span> <span class="o">=</span> <span class="bp">None</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-12'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-12'>#</a>
      </div>
      <p>cjkcodecs and iconv_codec provide support for more character encodings.
Both are available from http://cjkpython.i18n.org/</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">cjkcodecs.aliases</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">iconv_codec</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-13'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-13'>#</a>
      </div>
      <p>chardet library auto-detects character encodings
Download from http://chardet.feedparser.org/</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">chardet</span>
    <span class="k">if</span> <span class="n">_debug</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">chardet.constants</span>
        <span class="n">chardet</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">_debug</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">chardet</span> <span class="o">=</span> <span class="bp">None</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-14'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-14'>#</a>
      </div>
      <p>---------- don't touch these ----------</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">ThingsNobodyCaresAboutButMe</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span> <span class="k">pass</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-15'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-15'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">CharacterEncodingOverride</span><span class="p">(</span><span class="n">ThingsNobodyCaresAboutButMe</span><span class="p">):</span> <span class="k">pass</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-16'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-16'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">CharacterEncodingUnknown</span><span class="p">(</span><span class="n">ThingsNobodyCaresAboutButMe</span><span class="p">):</span> <span class="k">pass</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-17'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-17'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">NonXMLContentType</span><span class="p">(</span><span class="n">ThingsNobodyCaresAboutButMe</span><span class="p">):</span> <span class="k">pass</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-18'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-18'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">UndeclaredNamespace</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span> <span class="k">pass</span>

<span class="n">sgmllib</span><span class="o">.</span><span class="n">tagfind</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&#39;[a-zA-Z][-_.:a-zA-Z0-9]*&#39;</span><span class="p">)</span>
<span class="n">sgmllib</span><span class="o">.</span><span class="n">special</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&#39;&lt;!&#39;</span><span class="p">)</span>
<span class="n">sgmllib</span><span class="o">.</span><span class="n">charref</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&#39;&amp;#(x?[0-9A-Fa-f]+)[^0-9A-Fa-f]&#39;</span><span class="p">)</span>

<span class="n">SUPPORTED_VERSIONS</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;&#39;</span><span class="p">:</span> <span class="s">&#39;unknown&#39;</span><span class="p">,</span>
                      <span class="s">&#39;rss090&#39;</span><span class="p">:</span> <span class="s">&#39;RSS 0.90&#39;</span><span class="p">,</span>
                      <span class="s">&#39;rss091n&#39;</span><span class="p">:</span> <span class="s">&#39;RSS 0.91 (Netscape)&#39;</span><span class="p">,</span>
                      <span class="s">&#39;rss091u&#39;</span><span class="p">:</span> <span class="s">&#39;RSS 0.91 (Userland)&#39;</span><span class="p">,</span>
                      <span class="s">&#39;rss092&#39;</span><span class="p">:</span> <span class="s">&#39;RSS 0.92&#39;</span><span class="p">,</span>
                      <span class="s">&#39;rss093&#39;</span><span class="p">:</span> <span class="s">&#39;RSS 0.93&#39;</span><span class="p">,</span>
                      <span class="s">&#39;rss094&#39;</span><span class="p">:</span> <span class="s">&#39;RSS 0.94&#39;</span><span class="p">,</span>
                      <span class="s">&#39;rss20&#39;</span><span class="p">:</span> <span class="s">&#39;RSS 2.0&#39;</span><span class="p">,</span>
                      <span class="s">&#39;rss10&#39;</span><span class="p">:</span> <span class="s">&#39;RSS 1.0&#39;</span><span class="p">,</span>
                      <span class="s">&#39;rss&#39;</span><span class="p">:</span> <span class="s">&#39;RSS (unknown version)&#39;</span><span class="p">,</span>
                      <span class="s">&#39;atom01&#39;</span><span class="p">:</span> <span class="s">&#39;Atom 0.1&#39;</span><span class="p">,</span>
                      <span class="s">&#39;atom02&#39;</span><span class="p">:</span> <span class="s">&#39;Atom 0.2&#39;</span><span class="p">,</span>
                      <span class="s">&#39;atom03&#39;</span><span class="p">:</span> <span class="s">&#39;Atom 0.3&#39;</span><span class="p">,</span>
                      <span class="s">&#39;atom10&#39;</span><span class="p">:</span> <span class="s">&#39;Atom 1.0&#39;</span><span class="p">,</span>
                      <span class="s">&#39;atom&#39;</span><span class="p">:</span> <span class="s">&#39;Atom (unknown version)&#39;</span><span class="p">,</span>
                      <span class="s">&#39;cdf&#39;</span><span class="p">:</span> <span class="s">&#39;CDF&#39;</span><span class="p">,</span>
                      <span class="s">&#39;hotrss&#39;</span><span class="p">:</span> <span class="s">&#39;Hot RSS&#39;</span>
                      <span class="p">}</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">UserDict</span> <span class="o">=</span> <span class="nb">dict</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-19'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-19'>#</a>
      </div>
      <p>Python 2.1 does not have dict</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="kn">from</span> <span class="nn">UserDict</span> <span class="kn">import</span> <span class="n">UserDict</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-20'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-20'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">dict</span><span class="p">(</span><span class="n">aList</span><span class="p">):</span>
        <span class="n">rc</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">aList</span><span class="p">:</span>
            <span class="n">rc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">return</span> <span class="n">rc</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-21'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-21'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">FeedParserDict</span><span class="p">(</span><span class="n">UserDict</span><span class="p">):</span>
    <span class="n">keymap</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;channel&#39;</span><span class="p">:</span> <span class="s">&#39;feed&#39;</span><span class="p">,</span>
              <span class="s">&#39;items&#39;</span><span class="p">:</span> <span class="s">&#39;entries&#39;</span><span class="p">,</span>
              <span class="s">&#39;guid&#39;</span><span class="p">:</span> <span class="s">&#39;id&#39;</span><span class="p">,</span>
              <span class="s">&#39;date&#39;</span><span class="p">:</span> <span class="s">&#39;updated&#39;</span><span class="p">,</span>
              <span class="s">&#39;date_parsed&#39;</span><span class="p">:</span> <span class="s">&#39;updated_parsed&#39;</span><span class="p">,</span>
              <span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;subtitle&#39;</span><span class="p">,</span> <span class="s">&#39;summary&#39;</span><span class="p">],</span>
              <span class="s">&#39;url&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;href&#39;</span><span class="p">],</span>
              <span class="s">&#39;modified&#39;</span><span class="p">:</span> <span class="s">&#39;updated&#39;</span><span class="p">,</span>
              <span class="s">&#39;modified_parsed&#39;</span><span class="p">:</span> <span class="s">&#39;updated_parsed&#39;</span><span class="p">,</span>
              <span class="s">&#39;issued&#39;</span><span class="p">:</span> <span class="s">&#39;published&#39;</span><span class="p">,</span>
              <span class="s">&#39;issued_parsed&#39;</span><span class="p">:</span> <span class="s">&#39;published_parsed&#39;</span><span class="p">,</span>
              <span class="s">&#39;copyright&#39;</span><span class="p">:</span> <span class="s">&#39;rights&#39;</span><span class="p">,</span>
              <span class="s">&#39;copyright_detail&#39;</span><span class="p">:</span> <span class="s">&#39;rights_detail&#39;</span><span class="p">,</span>
              <span class="s">&#39;tagline&#39;</span><span class="p">:</span> <span class="s">&#39;subtitle&#39;</span><span class="p">,</span>
              <span class="s">&#39;tagline_detail&#39;</span><span class="p">:</span> <span class="s">&#39;subtitle_detail&#39;</span><span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-22'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-22'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&#39;category&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">UserDict</span><span class="o">.</span><span class="n">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;tags&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;term&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&#39;categories&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[(</span><span class="n">tag</span><span class="p">[</span><span class="s">&#39;scheme&#39;</span><span class="p">],</span> <span class="n">tag</span><span class="p">[</span><span class="s">&#39;term&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">UserDict</span><span class="o">.</span><span class="n">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;tags&#39;</span><span class="p">)]</span>
        <span class="n">realkey</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keymap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">realkey</span><span class="p">)</span> <span class="o">==</span> <span class="n">types</span><span class="o">.</span><span class="n">ListType</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">realkey</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">UserDict</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">UserDict</span><span class="o">.</span><span class="n">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">UserDict</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">UserDict</span><span class="o">.</span><span class="n">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">UserDict</span><span class="o">.</span><span class="n">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">realkey</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-23'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-23'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keymap</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="n">k</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keymap</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">==</span> <span class="n">types</span><span class="o">.</span><span class="n">ListType</span><span class="p">:</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">UserDict</span><span class="o">.</span><span class="n">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-24'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-24'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">default</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-25'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-25'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">setdefault</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-26'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-26'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">has_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="ow">or</span> <span class="n">UserDict</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-27'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-27'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">,</span> <span class="s">&quot;object has no attribute &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="n">key</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-28'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-28'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&#39;data&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__setitem__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-29'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-29'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">key</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-30'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-30'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">zopeCompatibilityHack</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">FeedParserDict</span>
    <span class="k">del</span> <span class="n">FeedParserDict</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-31'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-31'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">FeedParserDict</span><span class="p">(</span><span class="n">aDict</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">rc</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">aDict</span><span class="p">:</span>
            <span class="n">rc</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">aDict</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rc</span>

<span class="n">_ebcdic_to_ascii_map</span> <span class="o">=</span> <span class="bp">None</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-32'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-32'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">_ebcdic_to_ascii</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">_ebcdic_to_ascii_map</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_ebcdic_to_ascii_map</span><span class="p">:</span>
        <span class="n">emap</span> <span class="o">=</span> <span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">156</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">134</span><span class="p">,</span><span class="mi">127</span><span class="p">,</span><span class="mi">151</span><span class="p">,</span><span class="mi">141</span><span class="p">,</span><span class="mi">142</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span>
            <span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">157</span><span class="p">,</span><span class="mi">133</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">135</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">146</span><span class="p">,</span><span class="mi">143</span><span class="p">,</span><span class="mi">28</span><span class="p">,</span><span class="mi">29</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">31</span><span class="p">,</span>
            <span class="mi">128</span><span class="p">,</span><span class="mi">129</span><span class="p">,</span><span class="mi">130</span><span class="p">,</span><span class="mi">131</span><span class="p">,</span><span class="mi">132</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">27</span><span class="p">,</span><span class="mi">136</span><span class="p">,</span><span class="mi">137</span><span class="p">,</span><span class="mi">138</span><span class="p">,</span><span class="mi">139</span><span class="p">,</span><span class="mi">140</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span>
            <span class="mi">144</span><span class="p">,</span><span class="mi">145</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">147</span><span class="p">,</span><span class="mi">148</span><span class="p">,</span><span class="mi">149</span><span class="p">,</span><span class="mi">150</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">152</span><span class="p">,</span><span class="mi">153</span><span class="p">,</span><span class="mi">154</span><span class="p">,</span><span class="mi">155</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">158</span><span class="p">,</span><span class="mi">26</span><span class="p">,</span>
            <span class="mi">32</span><span class="p">,</span><span class="mi">160</span><span class="p">,</span><span class="mi">161</span><span class="p">,</span><span class="mi">162</span><span class="p">,</span><span class="mi">163</span><span class="p">,</span><span class="mi">164</span><span class="p">,</span><span class="mi">165</span><span class="p">,</span><span class="mi">166</span><span class="p">,</span><span class="mi">167</span><span class="p">,</span><span class="mi">168</span><span class="p">,</span><span class="mi">91</span><span class="p">,</span><span class="mi">46</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">43</span><span class="p">,</span><span class="mi">33</span><span class="p">,</span>
            <span class="mi">38</span><span class="p">,</span><span class="mi">169</span><span class="p">,</span><span class="mi">170</span><span class="p">,</span><span class="mi">171</span><span class="p">,</span><span class="mi">172</span><span class="p">,</span><span class="mi">173</span><span class="p">,</span><span class="mi">174</span><span class="p">,</span><span class="mi">175</span><span class="p">,</span><span class="mi">176</span><span class="p">,</span><span class="mi">177</span><span class="p">,</span><span class="mi">93</span><span class="p">,</span><span class="mi">36</span><span class="p">,</span><span class="mi">42</span><span class="p">,</span><span class="mi">41</span><span class="p">,</span><span class="mi">59</span><span class="p">,</span><span class="mi">94</span><span class="p">,</span>
            <span class="mi">45</span><span class="p">,</span><span class="mi">47</span><span class="p">,</span><span class="mi">178</span><span class="p">,</span><span class="mi">179</span><span class="p">,</span><span class="mi">180</span><span class="p">,</span><span class="mi">181</span><span class="p">,</span><span class="mi">182</span><span class="p">,</span><span class="mi">183</span><span class="p">,</span><span class="mi">184</span><span class="p">,</span><span class="mi">185</span><span class="p">,</span><span class="mi">124</span><span class="p">,</span><span class="mi">44</span><span class="p">,</span><span class="mi">37</span><span class="p">,</span><span class="mi">95</span><span class="p">,</span><span class="mi">62</span><span class="p">,</span><span class="mi">63</span><span class="p">,</span>
            <span class="mi">186</span><span class="p">,</span><span class="mi">187</span><span class="p">,</span><span class="mi">188</span><span class="p">,</span><span class="mi">189</span><span class="p">,</span><span class="mi">190</span><span class="p">,</span><span class="mi">191</span><span class="p">,</span><span class="mi">192</span><span class="p">,</span><span class="mi">193</span><span class="p">,</span><span class="mi">194</span><span class="p">,</span><span class="mi">96</span><span class="p">,</span><span class="mi">58</span><span class="p">,</span><span class="mi">35</span><span class="p">,</span><span class="mi">64</span><span class="p">,</span><span class="mi">39</span><span class="p">,</span><span class="mi">61</span><span class="p">,</span><span class="mi">34</span><span class="p">,</span>
            <span class="mi">195</span><span class="p">,</span><span class="mi">97</span><span class="p">,</span><span class="mi">98</span><span class="p">,</span><span class="mi">99</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">101</span><span class="p">,</span><span class="mi">102</span><span class="p">,</span><span class="mi">103</span><span class="p">,</span><span class="mi">104</span><span class="p">,</span><span class="mi">105</span><span class="p">,</span><span class="mi">196</span><span class="p">,</span><span class="mi">197</span><span class="p">,</span><span class="mi">198</span><span class="p">,</span><span class="mi">199</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">201</span><span class="p">,</span>
            <span class="mi">202</span><span class="p">,</span><span class="mi">106</span><span class="p">,</span><span class="mi">107</span><span class="p">,</span><span class="mi">108</span><span class="p">,</span><span class="mi">109</span><span class="p">,</span><span class="mi">110</span><span class="p">,</span><span class="mi">111</span><span class="p">,</span><span class="mi">112</span><span class="p">,</span><span class="mi">113</span><span class="p">,</span><span class="mi">114</span><span class="p">,</span><span class="mi">203</span><span class="p">,</span><span class="mi">204</span><span class="p">,</span><span class="mi">205</span><span class="p">,</span><span class="mi">206</span><span class="p">,</span><span class="mi">207</span><span class="p">,</span><span class="mi">208</span><span class="p">,</span>
            <span class="mi">209</span><span class="p">,</span><span class="mi">126</span><span class="p">,</span><span class="mi">115</span><span class="p">,</span><span class="mi">116</span><span class="p">,</span><span class="mi">117</span><span class="p">,</span><span class="mi">118</span><span class="p">,</span><span class="mi">119</span><span class="p">,</span><span class="mi">120</span><span class="p">,</span><span class="mi">121</span><span class="p">,</span><span class="mi">122</span><span class="p">,</span><span class="mi">210</span><span class="p">,</span><span class="mi">211</span><span class="p">,</span><span class="mi">212</span><span class="p">,</span><span class="mi">213</span><span class="p">,</span><span class="mi">214</span><span class="p">,</span><span class="mi">215</span><span class="p">,</span>
            <span class="mi">216</span><span class="p">,</span><span class="mi">217</span><span class="p">,</span><span class="mi">218</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">220</span><span class="p">,</span><span class="mi">221</span><span class="p">,</span><span class="mi">222</span><span class="p">,</span><span class="mi">223</span><span class="p">,</span><span class="mi">224</span><span class="p">,</span><span class="mi">225</span><span class="p">,</span><span class="mi">226</span><span class="p">,</span><span class="mi">227</span><span class="p">,</span><span class="mi">228</span><span class="p">,</span><span class="mi">229</span><span class="p">,</span><span class="mi">230</span><span class="p">,</span><span class="mi">231</span><span class="p">,</span>
            <span class="mi">123</span><span class="p">,</span><span class="mi">65</span><span class="p">,</span><span class="mi">66</span><span class="p">,</span><span class="mi">67</span><span class="p">,</span><span class="mi">68</span><span class="p">,</span><span class="mi">69</span><span class="p">,</span><span class="mi">70</span><span class="p">,</span><span class="mi">71</span><span class="p">,</span><span class="mi">72</span><span class="p">,</span><span class="mi">73</span><span class="p">,</span><span class="mi">232</span><span class="p">,</span><span class="mi">233</span><span class="p">,</span><span class="mi">234</span><span class="p">,</span><span class="mi">235</span><span class="p">,</span><span class="mi">236</span><span class="p">,</span><span class="mi">237</span><span class="p">,</span>
            <span class="mi">125</span><span class="p">,</span><span class="mi">74</span><span class="p">,</span><span class="mi">75</span><span class="p">,</span><span class="mi">76</span><span class="p">,</span><span class="mi">77</span><span class="p">,</span><span class="mi">78</span><span class="p">,</span><span class="mi">79</span><span class="p">,</span><span class="mi">80</span><span class="p">,</span><span class="mi">81</span><span class="p">,</span><span class="mi">82</span><span class="p">,</span><span class="mi">238</span><span class="p">,</span><span class="mi">239</span><span class="p">,</span><span class="mi">240</span><span class="p">,</span><span class="mi">241</span><span class="p">,</span><span class="mi">242</span><span class="p">,</span><span class="mi">243</span><span class="p">,</span>
            <span class="mi">92</span><span class="p">,</span><span class="mi">159</span><span class="p">,</span><span class="mi">83</span><span class="p">,</span><span class="mi">84</span><span class="p">,</span><span class="mi">85</span><span class="p">,</span><span class="mi">86</span><span class="p">,</span><span class="mi">87</span><span class="p">,</span><span class="mi">88</span><span class="p">,</span><span class="mi">89</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">244</span><span class="p">,</span><span class="mi">245</span><span class="p">,</span><span class="mi">246</span><span class="p">,</span><span class="mi">247</span><span class="p">,</span><span class="mi">248</span><span class="p">,</span><span class="mi">249</span><span class="p">,</span>
            <span class="mi">48</span><span class="p">,</span><span class="mi">49</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">51</span><span class="p">,</span><span class="mi">52</span><span class="p">,</span><span class="mi">53</span><span class="p">,</span><span class="mi">54</span><span class="p">,</span><span class="mi">55</span><span class="p">,</span><span class="mi">56</span><span class="p">,</span><span class="mi">57</span><span class="p">,</span><span class="mi">250</span><span class="p">,</span><span class="mi">251</span><span class="p">,</span><span class="mi">252</span><span class="p">,</span><span class="mi">253</span><span class="p">,</span><span class="mi">254</span><span class="p">,</span><span class="mi">255</span>
            <span class="p">)</span>
        <span class="kn">import</span> <span class="nn">string</span>
        <span class="n">_ebcdic_to_ascii_map</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">maketrans</span><span class="p">(</span> \
            <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">chr</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">))),</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">chr</span><span class="p">,</span> <span class="n">emap</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">_ebcdic_to_ascii_map</span><span class="p">)</span>

<span class="n">_urifixer</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&#39;^([A-Za-z][A-Za-z0-9+-.]*://)(/*)(.*?)&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-33'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-33'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">_urljoin</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">uri</span><span class="p">):</span>
    <span class="n">uri</span> <span class="o">=</span> <span class="n">_urifixer</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;\1\3&#39;</span><span class="p">,</span> <span class="n">uri</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">urlparse</span><span class="o">.</span><span class="n">urljoin</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">uri</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-34'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-34'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">_FeedParserMixin</span><span class="p">:</span>
    <span class="n">namespaces</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://backend.userland.com/rss&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://blogs.law.harvard.edu/tech/rss&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://purl.org/rss/1.0/&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://my.netscape.com/rdf/simple/0.9/&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://example.com/newformat#&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://example.com/necho&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://purl.org/echo/&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
                  <span class="s">&#39;uri/of/echo/namespace#&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://purl.org/pie/&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://purl.org/atom/ns#&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://www.w3.org/2005/Atom&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://purl.org/rss/1.0/modules/rss091#&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
                  
                  <span class="s">&#39;http://webns.net/mvcb/&#39;</span><span class="p">:</span>                               <span class="s">&#39;admin&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://purl.org/rss/1.0/modules/aggregation/&#39;</span><span class="p">:</span>         <span class="s">&#39;ag&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://purl.org/rss/1.0/modules/annotate/&#39;</span><span class="p">:</span>            <span class="s">&#39;annotate&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://media.tangent.org/rss/1.0/&#39;</span><span class="p">:</span>                    <span class="s">&#39;audio&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://backend.userland.com/blogChannelModule&#39;</span><span class="p">:</span>        <span class="s">&#39;blogChannel&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://web.resource.org/cc/&#39;</span><span class="p">:</span>                          <span class="s">&#39;cc&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://backend.userland.com/creativeCommonsRssModule&#39;</span><span class="p">:</span> <span class="s">&#39;creativeCommons&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://purl.org/rss/1.0/modules/company&#39;</span><span class="p">:</span>              <span class="s">&#39;co&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://purl.org/rss/1.0/modules/content/&#39;</span><span class="p">:</span>             <span class="s">&#39;content&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://my.theinfo.org/changed/1.0/rss/&#39;</span><span class="p">:</span>               <span class="s">&#39;cp&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://purl.org/dc/elements/1.1/&#39;</span><span class="p">:</span>                     <span class="s">&#39;dc&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://purl.org/dc/terms/&#39;</span><span class="p">:</span>                            <span class="s">&#39;dcterms&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://purl.org/rss/1.0/modules/email/&#39;</span><span class="p">:</span>               <span class="s">&#39;email&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://purl.org/rss/1.0/modules/event/&#39;</span><span class="p">:</span>               <span class="s">&#39;ev&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://rssnamespace.org/feedburner/ext/1.0&#39;</span><span class="p">:</span>           <span class="s">&#39;feedburner&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://freshmeat.net/rss/fm/&#39;</span><span class="p">:</span>                         <span class="s">&#39;fm&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://xmlns.com/foaf/0.1/&#39;</span><span class="p">:</span>                           <span class="s">&#39;foaf&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://www.w3.org/2003/01/geo/wgs84_pos#&#39;</span><span class="p">:</span>             <span class="s">&#39;geo&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://postneo.com/icbm/&#39;</span><span class="p">:</span>                             <span class="s">&#39;icbm&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://purl.org/rss/1.0/modules/image/&#39;</span><span class="p">:</span>               <span class="s">&#39;image&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://www.itunes.com/DTDs/PodCast-1.0.dtd&#39;</span><span class="p">:</span>           <span class="s">&#39;itunes&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://example.com/DTDs/PodCast-1.0.dtd&#39;</span><span class="p">:</span>              <span class="s">&#39;itunes&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://purl.org/rss/1.0/modules/link/&#39;</span><span class="p">:</span>                <span class="s">&#39;l&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://search.yahoo.com/mrss&#39;</span><span class="p">:</span>                         <span class="s">&#39;media&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://madskills.com/public/xml/rss/module/pingback/&#39;</span><span class="p">:</span> <span class="s">&#39;pingback&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://prismstandard.org/namespaces/1.2/basic/&#39;</span><span class="p">:</span>       <span class="s">&#39;prism&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://www.w3.org/1999/02/22-rdf-syntax-ns#&#39;</span><span class="p">:</span>          <span class="s">&#39;rdf&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://www.w3.org/2000/01/rdf-schema#&#39;</span><span class="p">:</span>                <span class="s">&#39;rdfs&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://purl.org/rss/1.0/modules/reference/&#39;</span><span class="p">:</span>           <span class="s">&#39;ref&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://purl.org/rss/1.0/modules/richequiv/&#39;</span><span class="p">:</span>           <span class="s">&#39;reqv&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://purl.org/rss/1.0/modules/search/&#39;</span><span class="p">:</span>              <span class="s">&#39;search&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://purl.org/rss/1.0/modules/slash/&#39;</span><span class="p">:</span>               <span class="s">&#39;slash&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://schemas.xmlsoap.org/soap/envelope/&#39;</span><span class="p">:</span>            <span class="s">&#39;soap&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://purl.org/rss/1.0/modules/servicestatus/&#39;</span><span class="p">:</span>       <span class="s">&#39;ss&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://hacks.benhammersley.com/rss/streaming/&#39;</span><span class="p">:</span>        <span class="s">&#39;str&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://purl.org/rss/1.0/modules/subscription/&#39;</span><span class="p">:</span>        <span class="s">&#39;sub&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://purl.org/rss/1.0/modules/syndication/&#39;</span><span class="p">:</span>         <span class="s">&#39;sy&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://purl.org/rss/1.0/modules/taxonomy/&#39;</span><span class="p">:</span>            <span class="s">&#39;taxo&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://purl.org/rss/1.0/modules/threading/&#39;</span><span class="p">:</span>           <span class="s">&#39;thr&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://purl.org/rss/1.0/modules/textinput/&#39;</span><span class="p">:</span>           <span class="s">&#39;ti&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://madskills.com/public/xml/rss/module/trackback/&#39;</span><span class="p">:</span><span class="s">&#39;trackback&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://wellformedweb.org/commentAPI/&#39;</span><span class="p">:</span>                 <span class="s">&#39;wfw&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://purl.org/rss/1.0/modules/wiki/&#39;</span><span class="p">:</span>                <span class="s">&#39;wiki&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://www.w3.org/1999/xhtml&#39;</span><span class="p">:</span>                         <span class="s">&#39;xhtml&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://www.w3.org/XML/1998/namespace&#39;</span><span class="p">:</span>                 <span class="s">&#39;xml&#39;</span><span class="p">,</span>
                  <span class="s">&#39;http://schemas.pocketsoap.com/rss/myDescModule/&#39;</span><span class="p">:</span>      <span class="s">&#39;szf&#39;</span>
<span class="p">}</span>
    <span class="n">_matchnamespaces</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">can_be_relative_uri</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;link&#39;</span><span class="p">,</span> <span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="s">&#39;wfw_comment&#39;</span><span class="p">,</span> <span class="s">&#39;wfw_commentrss&#39;</span><span class="p">,</span> <span class="s">&#39;docs&#39;</span><span class="p">,</span> <span class="s">&#39;url&#39;</span><span class="p">,</span> <span class="s">&#39;href&#39;</span><span class="p">,</span> <span class="s">&#39;comments&#39;</span><span class="p">,</span> <span class="s">&#39;license&#39;</span><span class="p">,</span> <span class="s">&#39;icon&#39;</span><span class="p">,</span> <span class="s">&#39;logo&#39;</span><span class="p">]</span>
    <span class="n">can_contain_relative_uris</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;content&#39;</span><span class="p">,</span> <span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="s">&#39;summary&#39;</span><span class="p">,</span> <span class="s">&#39;info&#39;</span><span class="p">,</span> <span class="s">&#39;tagline&#39;</span><span class="p">,</span> <span class="s">&#39;subtitle&#39;</span><span class="p">,</span> <span class="s">&#39;copyright&#39;</span><span class="p">,</span> <span class="s">&#39;rights&#39;</span><span class="p">,</span> <span class="s">&#39;description&#39;</span><span class="p">]</span>
    <span class="n">can_contain_dangerous_markup</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;content&#39;</span><span class="p">,</span> <span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="s">&#39;summary&#39;</span><span class="p">,</span> <span class="s">&#39;info&#39;</span><span class="p">,</span> <span class="s">&#39;tagline&#39;</span><span class="p">,</span> <span class="s">&#39;subtitle&#39;</span><span class="p">,</span> <span class="s">&#39;copyright&#39;</span><span class="p">,</span> <span class="s">&#39;rights&#39;</span><span class="p">,</span> <span class="s">&#39;description&#39;</span><span class="p">]</span>
    <span class="n">html_types</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;text/html&#39;</span><span class="p">,</span> <span class="s">&#39;application/xhtml+xml&#39;</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-35'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-35'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">baseuri</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">baselang</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&#39;utf-8&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">_debug</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;initializing FeedParser</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_matchnamespaces</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">namespaces</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_matchnamespaces</span><span class="p">[</span><span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feeddata</span> <span class="o">=</span> <span class="n">FeedParserDict</span><span class="p">()</span> <span class="c"># feed-level data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="n">encoding</span> <span class="c"># character encoding</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entries</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># list of entry-level data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="s">&#39;&#39;</span> <span class="c"># feed type/version, see SUPPORTED_VERSIONS</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">namespacesInUse</span> <span class="o">=</span> <span class="p">{}</span> <span class="c"># dictionary of namespaces defined by the feed</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-36'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-36'>#</a>
      </div>
      <p>the following are used internally to track state;
this is really out of control and should be refactored</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">infeed</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inentry</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">incontent</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intextinput</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inimage</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inauthor</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">incontributor</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inpublisher</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insource</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sourcedata</span> <span class="o">=</span> <span class="n">FeedParserDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contentparams</span> <span class="o">=</span> <span class="n">FeedParserDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_summaryKey</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">namespacemap</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elementstack</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basestack</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">langstack</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">baseuri</span> <span class="o">=</span> <span class="n">baseuri</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lang</span> <span class="o">=</span> <span class="n">baselang</span> <span class="ow">or</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">baselang</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">feeddata</span><span class="p">[</span><span class="s">&#39;language&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">baselang</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-37'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-37'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">unknown_starttag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">_debug</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;start </span><span class="si">%s</span><span class="s"> with </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">attrs</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-38'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-38'>#</a>
      </div>
      <p>normalize attrs</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">attrs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">]</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">k</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;rel&#39;</span><span class="p">,</span> <span class="s">&#39;type&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">v</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">or</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-39'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-39'>#</a>
      </div>
      <p>track xml:base and xml:lang</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">attrsD</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>
        <span class="n">baseuri</span> <span class="o">=</span> <span class="n">attrsD</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;xml:base&#39;</span><span class="p">,</span> <span class="n">attrsD</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;base&#39;</span><span class="p">))</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseuri</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">baseuri</span> <span class="o">=</span> <span class="n">_urljoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseuri</span><span class="p">,</span> <span class="n">baseuri</span><span class="p">)</span>
        <span class="n">lang</span> <span class="o">=</span> <span class="n">attrsD</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;xml:lang&#39;</span><span class="p">,</span> <span class="n">attrsD</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;lang&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">lang</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-40'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-40'>#</a>
      </div>
      <p>xml:lang could be explicitly set to '', we need to capture that</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">lang</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">elif</span> <span class="n">lang</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-41'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-41'>#</a>
      </div>
      <p>if no xml:lang is specified, use parent lang</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">lang</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lang</span>
        <span class="k">if</span> <span class="n">lang</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;feed&#39;</span><span class="p">,</span> <span class="s">&#39;rss&#39;</span><span class="p">,</span> <span class="s">&#39;rdf:RDF&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">feeddata</span><span class="p">[</span><span class="s">&#39;language&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lang</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lang</span> <span class="o">=</span> <span class="n">lang</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basestack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseuri</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">langstack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lang</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-42'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-42'>#</a>
      </div>
      <p>track namespaces</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">for</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">uri</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">prefix</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;xmlns:&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">trackNamespace</span><span class="p">(</span><span class="n">prefix</span><span class="p">[</span><span class="mi">6</span><span class="p">:],</span> <span class="n">uri</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">prefix</span> <span class="o">==</span> <span class="s">&#39;xmlns&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">trackNamespace</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">uri</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-43'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-43'>#</a>
      </div>
      <p>track inline content</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">incontent</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">contentparams</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">contentparams</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">,</span> <span class="s">&#39;xml&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;xml&#39;</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-44'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-44'>#</a>
      </div>
      <p>element declared itself as escaped markup, but it isn't really</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="bp">self</span><span class="o">.</span><span class="n">contentparams</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;application/xhtml+xml&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">incontent</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">contentparams</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;application/xhtml+xml&#39;</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-45'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-45'>#</a>
      </div>
      <p>Note: probably shouldn't simply recreate localname here, but
our namespace handling isn't actually 100% correct in cases where
the feed redefines the default namespace (which is actually
the usual case for inline content, thanks Sam), so here we
cheat and just reconstruct the element based on localname
because that compensates for the bugs in our namespace handling.
This will horribly munge inline content with non-empty qnames,
but nobody actually does that, so I'm not fixing it.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_data</span><span class="p">(</span><span class="s">&#39;&lt;</span><span class="si">%s%s</span><span class="s">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39; </span><span class="si">%s</span><span class="s">=&quot;</span><span class="si">%s</span><span class="s">&quot;&#39;</span> <span class="o">%</span> <span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">])),</span> <span class="n">escape</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-46'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-46'>#</a>
      </div>
      <p>match namespaces</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">tag</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span> <span class="o">&lt;&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">prefix</span><span class="p">,</span> <span class="n">suffix</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">prefix</span><span class="p">,</span> <span class="n">suffix</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">tag</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">namespacemap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">prefix</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">prefix</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s">&#39;_&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-47'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-47'>#</a>
      </div>
      <p>special hack for better tracking of empty textinput/image elements in illformed feeds</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">prefix</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="s">&#39;link&#39;</span><span class="p">,</span> <span class="s">&#39;description&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">intextinput</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">prefix</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="s">&#39;link&#39;</span><span class="p">,</span> <span class="s">&#39;description&#39;</span><span class="p">,</span> <span class="s">&#39;url&#39;</span><span class="p">,</span> <span class="s">&#39;href&#39;</span><span class="p">,</span> <span class="s">&#39;width&#39;</span><span class="p">,</span> <span class="s">&#39;height&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inimage</span> <span class="o">=</span> <span class="mi">0</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-48'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-48'>#</a>
      </div>
      <p>call special handler (if defined) or default handler</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">methodname</span> <span class="o">=</span> <span class="s">&#39;_start_&#39;</span> <span class="o">+</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">suffix</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">methodname</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">method</span><span class="p">(</span><span class="n">attrsD</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">prefix</span> <span class="o">+</span> <span class="n">suffix</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-49'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-49'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">unknown_endtag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">_debug</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;end </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">tag</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-50'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-50'>#</a>
      </div>
      <p>match namespaces</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">tag</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span> <span class="o">&lt;&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">prefix</span><span class="p">,</span> <span class="n">suffix</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">prefix</span><span class="p">,</span> <span class="n">suffix</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">tag</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">namespacemap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">prefix</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">prefix</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s">&#39;_&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-51'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-51'>#</a>
      </div>
      <p>call special handler (if defined) or default handler</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">methodname</span> <span class="o">=</span> <span class="s">&#39;_end_&#39;</span> <span class="o">+</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">suffix</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">methodname</span><span class="p">)</span>
            <span class="n">method</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">prefix</span> <span class="o">+</span> <span class="n">suffix</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-52'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-52'>#</a>
      </div>
      <p>track inline content</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">incontent</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">contentparams</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">contentparams</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">,</span> <span class="s">&#39;xml&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;xml&#39;</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-53'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-53'>#</a>
      </div>
      <p>element declared itself as escaped markup, but it isn't really</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="bp">self</span><span class="o">.</span><span class="n">contentparams</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;application/xhtml+xml&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">incontent</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">contentparams</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;application/xhtml+xml&#39;</span><span class="p">:</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_data</span><span class="p">(</span><span class="s">&#39;&lt;/</span><span class="si">%s</span><span class="s">&gt;&#39;</span> <span class="o">%</span> <span class="n">tag</span><span class="p">,</span> <span class="n">escape</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-54'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-54'>#</a>
      </div>
      <p>track xml:base and xml:lang going out of scope</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">basestack</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">basestack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">basestack</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">basestack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">baseuri</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">basestack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">langstack</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">langstack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">langstack</span><span class="p">:</span> <span class="c"># and (self.langstack[-1] is not None):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lang</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">langstack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-55'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-55'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">handle_charref</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-56'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-56'>#</a>
      </div>
      <p>called for each character reference, e.g. for '&#160;', ref will be '160'</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">elementstack</span><span class="p">:</span> <span class="k">return</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="n">ref</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ref</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;34&#39;</span><span class="p">,</span> <span class="s">&#39;38&#39;</span><span class="p">,</span> <span class="s">&#39;39&#39;</span><span class="p">,</span> <span class="s">&#39;60&#39;</span><span class="p">,</span> <span class="s">&#39;62&#39;</span><span class="p">,</span> <span class="s">&#39;x22&#39;</span><span class="p">,</span> <span class="s">&#39;x26&#39;</span><span class="p">,</span> <span class="s">&#39;x27&#39;</span><span class="p">,</span> <span class="s">&#39;x3c&#39;</span><span class="p">,</span> <span class="s">&#39;x3e&#39;</span><span class="p">):</span>
            <span class="n">text</span> <span class="o">=</span> <span class="s">&#39;&amp;#</span><span class="si">%s</span><span class="s">;&#39;</span> <span class="o">%</span> <span class="n">ref</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ref</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;x&#39;</span><span class="p">:</span>
                <span class="n">c</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ref</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="mi">16</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">c</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>
            <span class="n">text</span> <span class="o">=</span> <span class="nb">unichr</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elementstack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-57'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-57'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">handle_entityref</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-58'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-58'>#</a>
      </div>
      <p>called for each entity reference, e.g. for '&copy;', ref will be 'copy'</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">elementstack</span><span class="p">:</span> <span class="k">return</span>
        <span class="k">if</span> <span class="n">_debug</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;entering handle_entityref with </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">ref</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ref</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;lt&#39;</span><span class="p">,</span> <span class="s">&#39;gt&#39;</span><span class="p">,</span> <span class="s">&#39;quot&#39;</span><span class="p">,</span> <span class="s">&#39;amp&#39;</span><span class="p">,</span> <span class="s">&#39;apos&#39;</span><span class="p">):</span>
            <span class="n">text</span> <span class="o">=</span> <span class="s">&#39;&amp;</span><span class="si">%s</span><span class="s">;&#39;</span> <span class="o">%</span> <span class="n">ref</span>
        <span class="k">else</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-59'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-59'>#</a>
      </div>
      <p>entity resolution graciously donated by Aaron Swartz</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="k">def</span> <span class="nf">name2cp</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
                <span class="kn">import</span> <span class="nn">htmlentitydefs</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">htmlentitydefs</span><span class="p">,</span> <span class="s">&#39;name2codepoint&#39;</span><span class="p">):</span> <span class="c"># requires Python 2.3</span>
                    <span class="k">return</span> <span class="n">htmlentitydefs</span><span class="o">.</span><span class="n">name2codepoint</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">htmlentitydefs</span><span class="o">.</span><span class="n">entitydefs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;&amp;#&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">k</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">):</span>
                    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="c"># not in latin-1</span>
                <span class="k">return</span> <span class="nb">ord</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span> <span class="n">name2cp</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span> <span class="n">text</span> <span class="o">=</span> <span class="s">&#39;&amp;</span><span class="si">%s</span><span class="s">;&#39;</span> <span class="o">%</span> <span class="n">ref</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">text</span> <span class="o">=</span> <span class="nb">unichr</span><span class="p">(</span><span class="n">name2cp</span><span class="p">(</span><span class="n">ref</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elementstack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-60'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-60'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">handle_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">escape</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-61'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-61'>#</a>
      </div>
      <p>called for each block of plain text, i.e. outside of any tag and
not containing any character or entity references</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">elementstack</span><span class="p">:</span> <span class="k">return</span>
        <span class="k">if</span> <span class="n">escape</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">contentparams</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;application/xhtml+xml&#39;</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">_xmlescape</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elementstack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-62'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-62'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">handle_comment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-63'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-63'>#</a>
      </div>
      <p>called for each comment, e.g. <!-- insert message here --></p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">pass</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-64'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-64'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">handle_pi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-65'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-65'>#</a>
      </div>
      <p>called for each processing instruction, e.g. &lt;?instruction&gt;</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">pass</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-66'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-66'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">handle_decl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="k">pass</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-67'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-67'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">parse_declaration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-68'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-68'>#</a>
      </div>
      <p>override internal declaration handler to handle CDATA blocks</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">_debug</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;entering parse_declaration</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rawdata</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">9</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;&lt;![CDATA[&#39;</span><span class="p">:</span>
            <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rawdata</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;]]&gt;&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="n">k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rawdata</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_data</span><span class="p">(</span><span class="n">_xmlescape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rawdata</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">9</span><span class="p">:</span><span class="n">k</span><span class="p">]),</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">k</span><span class="o">+</span><span class="mi">3</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rawdata</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;&gt;&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-69'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-69'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">mapContentType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contentType</span><span class="p">):</span>
        <span class="n">contentType</span> <span class="o">=</span> <span class="n">contentType</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">contentType</span> <span class="o">==</span> <span class="s">&#39;text&#39;</span><span class="p">:</span>
            <span class="n">contentType</span> <span class="o">=</span> <span class="s">&#39;text/plain&#39;</span>
        <span class="k">elif</span> <span class="n">contentType</span> <span class="o">==</span> <span class="s">&#39;html&#39;</span><span class="p">:</span>
            <span class="n">contentType</span> <span class="o">=</span> <span class="s">&#39;text/html&#39;</span>
        <span class="k">elif</span> <span class="n">contentType</span> <span class="o">==</span> <span class="s">&#39;xhtml&#39;</span><span class="p">:</span>
            <span class="n">contentType</span> <span class="o">=</span> <span class="s">&#39;application/xhtml+xml&#39;</span>
        <span class="k">return</span> <span class="n">contentType</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-70'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-70'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">trackNamespace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">uri</span><span class="p">):</span>
        <span class="n">loweruri</span> <span class="o">=</span> <span class="n">uri</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">loweruri</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s">&#39;http://my.netscape.com/rdf/simple/0.9/&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="s">&#39;rss090&#39;</span>
        <span class="k">if</span> <span class="n">loweruri</span> <span class="o">==</span> <span class="s">&#39;http://purl.org/rss/1.0/&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="s">&#39;rss10&#39;</span>
        <span class="k">if</span> <span class="n">loweruri</span> <span class="o">==</span> <span class="s">&#39;http://www.w3.org/2005/atom&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="s">&#39;atom10&#39;</span>
        <span class="k">if</span> <span class="n">loweruri</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;backend.userland.com/rss&#39;</span><span class="p">)</span> <span class="o">&lt;&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-71'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-71'>#</a>
      </div>
      <p>match any backend.userland.com namespace</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">uri</span> <span class="o">=</span> <span class="s">&#39;http://backend.userland.com/rss&#39;</span>
            <span class="n">loweruri</span> <span class="o">=</span> <span class="n">uri</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_matchnamespaces</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">loweruri</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">namespacemap</span><span class="p">[</span><span class="n">prefix</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_matchnamespaces</span><span class="p">[</span><span class="n">loweruri</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">namespacesInUse</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_matchnamespaces</span><span class="p">[</span><span class="n">loweruri</span><span class="p">]]</span> <span class="o">=</span> <span class="n">uri</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">namespacesInUse</span><span class="p">[</span><span class="n">prefix</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">uri</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-72'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-72'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">resolveURI</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uri</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_urljoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseuri</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">uri</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-73'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-73'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">decodeEntities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">data</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-74'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-74'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">push</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">expectingText</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elementstack</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">element</span><span class="p">,</span> <span class="n">expectingText</span><span class="p">,</span> <span class="p">[]])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-75'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-75'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">stripWhitespace</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">elementstack</span><span class="p">:</span> <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">elementstack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">element</span><span class="p">:</span> <span class="k">return</span>
        
        <span class="n">element</span><span class="p">,</span> <span class="n">expectingText</span><span class="p">,</span> <span class="n">pieces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elementstack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="n">output</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pieces</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">stripWhitespace</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">expectingText</span><span class="p">:</span> <span class="k">return</span> <span class="n">output</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-76'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-76'>#</a>
      </div>
      <p>decode base64 content</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">base64</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">contentparams</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;base64&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">output</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">decodestring</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">binascii</span><span class="o">.</span><span class="n">Error</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">except</span> <span class="n">binascii</span><span class="o">.</span><span class="n">Incomplete</span><span class="p">:</span>
                <span class="k">pass</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-77'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-77'>#</a>
      </div>
      <p>resolve relative URIs</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">can_be_relative_uri</span><span class="p">)</span> <span class="ow">and</span> <span class="n">output</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolveURI</span><span class="p">(</span><span class="n">output</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-78'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-78'>#</a>
      </div>
      <p>decode entities within embedded markup</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">contentparams</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;base64&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decodeEntities</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-79'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-79'>#</a>
      </div>
      <p>remove temporary cruft from contentparams</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">try</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">contentparams</span><span class="p">[</span><span class="s">&#39;mode&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">contentparams</span><span class="p">[</span><span class="s">&#39;base64&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-80'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-80'>#</a>
      </div>
      <p>resolve relative URIs within embedded markup</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapContentType</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contentparams</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">,</span> <span class="s">&#39;text/html&#39;</span><span class="p">))</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">html_types</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">can_contain_relative_uris</span><span class="p">:</span>
                <span class="n">output</span> <span class="o">=</span> <span class="n">_resolveRelativeURIs</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseuri</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-81'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-81'>#</a>
      </div>
      <p>sanitize embedded markup</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapContentType</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contentparams</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">,</span> <span class="s">&#39;text/html&#39;</span><span class="p">))</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">html_types</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">can_contain_dangerous_markup</span><span class="p">:</span>
                <span class="n">output</span> <span class="o">=</span> <span class="n">_sanitizeHTML</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">output</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">type</span><span class="p">(</span><span class="s">u&#39;&#39;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">output</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-82'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-82'>#</a>
      </div>
      <p>categories/tags/keywords/whatever are handled in _end_category</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">element</span> <span class="o">==</span> <span class="s">&#39;category&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">output</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-83'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-83'>#</a>
      </div>
      <p>store output in appropriate place(s)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inentry</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">insource</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">element</span> <span class="o">==</span> <span class="s">&#39;content&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="p">[])</span>
                <span class="n">contentparams</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contentparams</span><span class="p">)</span>
                <span class="n">contentparams</span><span class="p">[</span><span class="s">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">element</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">contentparams</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">element</span> <span class="o">==</span> <span class="s">&#39;link&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">element</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span>
                <span class="k">if</span> <span class="n">output</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;links&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;href&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">element</span> <span class="o">==</span> <span class="s">&#39;description&#39;</span><span class="p">:</span>
                    <span class="n">element</span> <span class="o">=</span> <span class="s">&#39;summary&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">element</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">incontent</span><span class="p">:</span>
                    <span class="n">contentparams</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contentparams</span><span class="p">)</span>
                    <span class="n">contentparams</span><span class="p">[</span><span class="s">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">element</span> <span class="o">+</span> <span class="s">&#39;_detail&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">contentparams</span>
        <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">infeed</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">insource</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">intextinput</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">inimage</span><span class="p">):</span>
            <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getContext</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">element</span> <span class="o">==</span> <span class="s">&#39;description&#39;</span><span class="p">:</span>
                <span class="n">element</span> <span class="o">=</span> <span class="s">&#39;subtitle&#39;</span>
            <span class="n">context</span><span class="p">[</span><span class="n">element</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span>
            <span class="k">if</span> <span class="n">element</span> <span class="o">==</span> <span class="s">&#39;link&#39;</span><span class="p">:</span>
                <span class="n">context</span><span class="p">[</span><span class="s">&#39;links&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;href&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">incontent</span><span class="p">:</span>
                <span class="n">contentparams</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contentparams</span><span class="p">)</span>
                <span class="n">contentparams</span><span class="p">[</span><span class="s">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span>
                <span class="n">context</span><span class="p">[</span><span class="n">element</span> <span class="o">+</span> <span class="s">&#39;_detail&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">contentparams</span>
        <span class="k">return</span> <span class="n">output</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-84'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-84'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">pushContent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">,</span> <span class="n">defaultContentType</span><span class="p">,</span> <span class="n">expectingText</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">incontent</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contentparams</span> <span class="o">=</span> <span class="n">FeedParserDict</span><span class="p">({</span>
            <span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapContentType</span><span class="p">(</span><span class="n">attrsD</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">,</span> <span class="n">defaultContentType</span><span class="p">)),</span>
            <span class="s">&#39;language&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">lang</span><span class="p">,</span>
            <span class="s">&#39;base&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseuri</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contentparams</span><span class="p">[</span><span class="s">&#39;base64&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isBase64</span><span class="p">(</span><span class="n">attrsD</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">contentparams</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">expectingText</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-85'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-85'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">popContent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">incontent</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contentparams</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">value</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-86'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-86'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_mapToStandardPrefix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">colonpos</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">colonpos</span> <span class="o">&lt;&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="n">name</span><span class="p">[:</span><span class="n">colonpos</span><span class="p">]</span>
            <span class="n">suffix</span> <span class="o">=</span> <span class="n">name</span><span class="p">[</span><span class="n">colonpos</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">namespacemap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">prefix</span><span class="p">)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s">&#39;:&#39;</span> <span class="o">+</span> <span class="n">suffix</span>
        <span class="k">return</span> <span class="n">name</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-87'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-87'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_getAttribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">attrsD</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mapToStandardPrefix</span><span class="p">(</span><span class="n">name</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-88'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-88'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_isBase64</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">,</span> <span class="n">contentparams</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">attrsD</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;mode&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;base64&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">contentparams</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;text/&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">contentparams</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;+xml&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">contentparams</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;/xml&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="mi">1</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-89'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-89'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_itsAnHrefDamnIt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">):</span>
        <span class="n">href</span> <span class="o">=</span> <span class="n">attrsD</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;url&#39;</span><span class="p">,</span> <span class="n">attrsD</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;uri&#39;</span><span class="p">,</span> <span class="n">attrsD</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;href&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">href</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">attrsD</span><span class="p">[</span><span class="s">&#39;url&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">attrsD</span><span class="p">[</span><span class="s">&#39;uri&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="n">attrsD</span><span class="p">[</span><span class="s">&#39;href&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">href</span>
        <span class="k">return</span> <span class="n">attrsD</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-90'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-90'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getContext</span><span class="p">()</span>
        <span class="n">context</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-91'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-91'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_start_rss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">):</span>
        <span class="n">versionmap</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;0.91&#39;</span><span class="p">:</span> <span class="s">&#39;rss091u&#39;</span><span class="p">,</span>
                      <span class="s">&#39;0.92&#39;</span><span class="p">:</span> <span class="s">&#39;rss092&#39;</span><span class="p">,</span>
                      <span class="s">&#39;0.93&#39;</span><span class="p">:</span> <span class="s">&#39;rss093&#39;</span><span class="p">,</span>
                      <span class="s">&#39;0.94&#39;</span><span class="p">:</span> <span class="s">&#39;rss094&#39;</span><span class="p">}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">:</span>
            <span class="n">attr_version</span> <span class="o">=</span> <span class="n">attrsD</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;version&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
            <span class="n">version</span> <span class="o">=</span> <span class="n">versionmap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attr_version</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">version</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">version</span>
            <span class="k">elif</span> <span class="n">attr_version</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;2.&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="s">&#39;rss20&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="s">&#39;rss&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-92'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-92'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_start_dlhottitles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="s">&#39;hotrss&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-93'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-93'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_start_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infeed</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cdf_common</span><span class="p">(</span><span class="n">attrsD</span><span class="p">)</span>
    <span class="n">_start_feedinfo</span> <span class="o">=</span> <span class="n">_start_channel</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-94'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-94'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_cdf_common</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">attrsD</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;lastmod&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_start_modified</span><span class="p">({})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">elementstack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">attrsD</span><span class="p">[</span><span class="s">&#39;lastmod&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_end_modified</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">attrsD</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;href&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_start_link</span><span class="p">({})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">elementstack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">attrsD</span><span class="p">[</span><span class="s">&#39;href&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_end_link</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-95'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-95'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_start_feed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infeed</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">versionmap</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;0.1&#39;</span><span class="p">:</span> <span class="s">&#39;atom01&#39;</span><span class="p">,</span>
                      <span class="s">&#39;0.2&#39;</span><span class="p">:</span> <span class="s">&#39;atom02&#39;</span><span class="p">,</span>
                      <span class="s">&#39;0.3&#39;</span><span class="p">:</span> <span class="s">&#39;atom03&#39;</span><span class="p">}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">:</span>
            <span class="n">attr_version</span> <span class="o">=</span> <span class="n">attrsD</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;version&#39;</span><span class="p">)</span>
            <span class="n">version</span> <span class="o">=</span> <span class="n">versionmap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attr_version</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">version</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">version</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="s">&#39;atom&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-96'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-96'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_end_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infeed</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">_end_feed</span> <span class="o">=</span> <span class="n">_end_channel</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-97'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-97'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_start_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inimage</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;image&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getContext</span><span class="p">()</span>
        <span class="n">context</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&#39;image&#39;</span><span class="p">,</span> <span class="n">FeedParserDict</span><span class="p">())</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-98'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-98'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_end_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;image&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inimage</span> <span class="o">=</span> <span class="mi">0</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-99'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-99'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_start_textinput</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intextinput</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;textinput&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getContext</span><span class="p">()</span>
        <span class="n">context</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&#39;textinput&#39;</span><span class="p">,</span> <span class="n">FeedParserDict</span><span class="p">())</span>
    <span class="n">_start_textInput</span> <span class="o">=</span> <span class="n">_start_textinput</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-100'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-100'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_end_textinput</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;textinput&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intextinput</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">_end_textInput</span> <span class="o">=</span> <span class="n">_end_textinput</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-101'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-101'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_start_author</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inauthor</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;author&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">_start_managingeditor</span> <span class="o">=</span> <span class="n">_start_author</span>
    <span class="n">_start_dc_author</span> <span class="o">=</span> <span class="n">_start_author</span>
    <span class="n">_start_dc_creator</span> <span class="o">=</span> <span class="n">_start_author</span>
    <span class="n">_start_itunes_author</span> <span class="o">=</span> <span class="n">_start_author</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-102'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-102'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_end_author</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;author&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inauthor</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sync_author_detail</span><span class="p">()</span>
    <span class="n">_end_managingeditor</span> <span class="o">=</span> <span class="n">_end_author</span>
    <span class="n">_end_dc_author</span> <span class="o">=</span> <span class="n">_end_author</span>
    <span class="n">_end_dc_creator</span> <span class="o">=</span> <span class="n">_end_author</span>
    <span class="n">_end_itunes_author</span> <span class="o">=</span> <span class="n">_end_author</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-103'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-103'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_start_itunes_owner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inpublisher</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;publisher&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-104'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-104'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_end_itunes_owner</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;publisher&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inpublisher</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sync_author_detail</span><span class="p">(</span><span class="s">&#39;publisher&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-105'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-105'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_start_contributor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">incontributor</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getContext</span><span class="p">()</span>
        <span class="n">context</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&#39;contributors&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">context</span><span class="p">[</span><span class="s">&#39;contributors&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">FeedParserDict</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;contributor&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-106'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-106'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_end_contributor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;contributor&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">incontributor</span> <span class="o">=</span> <span class="mi">0</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-107'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-107'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_start_dc_contributor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">incontributor</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getContext</span><span class="p">()</span>
        <span class="n">context</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&#39;contributors&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">context</span><span class="p">[</span><span class="s">&#39;contributors&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">FeedParserDict</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-108'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-108'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_end_dc_contributor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_end_name</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">incontributor</span> <span class="o">=</span> <span class="mi">0</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-109'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-109'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_start_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">_start_itunes_name</span> <span class="o">=</span> <span class="n">_start_name</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-110'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-110'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_end_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inpublisher</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_author</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="s">&#39;publisher&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">inauthor</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_author</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">incontributor</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_contributor</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">intextinput</span><span class="p">:</span>
            <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getContext</span><span class="p">()</span>
            <span class="n">context</span><span class="p">[</span><span class="s">&#39;textinput&#39;</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="n">_end_itunes_name</span> <span class="o">=</span> <span class="n">_end_name</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-111'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-111'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_start_width</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;width&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-112'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-112'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_end_width</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;width&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inimage</span><span class="p">:</span>
            <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getContext</span><span class="p">()</span>
            <span class="n">context</span><span class="p">[</span><span class="s">&#39;image&#39;</span><span class="p">][</span><span class="s">&#39;width&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-113'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-113'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_start_height</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;height&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-114'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-114'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_end_height</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;height&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inimage</span><span class="p">:</span>
            <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getContext</span><span class="p">()</span>
            <span class="n">context</span><span class="p">[</span><span class="s">&#39;image&#39;</span><span class="p">][</span><span class="s">&#39;height&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-115'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-115'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_start_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;href&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">_start_homepage</span> <span class="o">=</span> <span class="n">_start_url</span>
    <span class="n">_start_uri</span> <span class="o">=</span> <span class="n">_start_url</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-116'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-116'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_end_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;href&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inauthor</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_author</span><span class="p">(</span><span class="s">&#39;href&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">incontributor</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_contributor</span><span class="p">(</span><span class="s">&#39;href&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">inimage</span><span class="p">:</span>
            <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getContext</span><span class="p">()</span>
            <span class="n">context</span><span class="p">[</span><span class="s">&#39;image&#39;</span><span class="p">][</span><span class="s">&#39;href&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">intextinput</span><span class="p">:</span>
            <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getContext</span><span class="p">()</span>
            <span class="n">context</span><span class="p">[</span><span class="s">&#39;textinput&#39;</span><span class="p">][</span><span class="s">&#39;link&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="n">_end_homepage</span> <span class="o">=</span> <span class="n">_end_url</span>
    <span class="n">_end_uri</span> <span class="o">=</span> <span class="n">_end_url</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-117'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-117'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_start_email</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;email&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">_start_itunes_email</span> <span class="o">=</span> <span class="n">_start_email</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-118'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-118'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_end_email</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;email&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inpublisher</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_author</span><span class="p">(</span><span class="s">&#39;email&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="s">&#39;publisher&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">inauthor</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_author</span><span class="p">(</span><span class="s">&#39;email&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">incontributor</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_contributor</span><span class="p">(</span><span class="s">&#39;email&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="n">_end_itunes_email</span> <span class="o">=</span> <span class="n">_end_email</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-119'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-119'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_getContext</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">insource</span><span class="p">:</span>
            <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sourcedata</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">inentry</span><span class="p">:</span>
            <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feeddata</span>
        <span class="k">return</span> <span class="n">context</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-120'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-120'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_save_author</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&#39;author&#39;</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getContext</span><span class="p">()</span>
        <span class="n">context</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">prefix</span> <span class="o">+</span> <span class="s">&#39;_detail&#39;</span><span class="p">,</span> <span class="n">FeedParserDict</span><span class="p">())</span>
        <span class="n">context</span><span class="p">[</span><span class="n">prefix</span> <span class="o">+</span> <span class="s">&#39;_detail&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sync_author_detail</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-121'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-121'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_save_contributor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getContext</span><span class="p">()</span>
        <span class="n">context</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&#39;contributors&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">FeedParserDict</span><span class="p">()])</span>
        <span class="n">context</span><span class="p">[</span><span class="s">&#39;contributors&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-122'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-122'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_sync_author_detail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s">&#39;author&#39;</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getContext</span><span class="p">()</span>
        <span class="n">detail</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">_detail&#39;</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">detail</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">detail</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">)</span>
            <span class="n">email</span> <span class="o">=</span> <span class="n">detail</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;email&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">and</span> <span class="n">email</span><span class="p">:</span>
                <span class="n">context</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> (</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">email</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">name</span><span class="p">:</span>
                <span class="n">context</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
            <span class="k">elif</span> <span class="n">email</span><span class="p">:</span>
                <span class="n">context</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">email</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">author</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">author</span><span class="p">:</span> <span class="k">return</span>
            <span class="n">emailmatch</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&#39;&#39;&#39;(([a-zA-Z0-9\_\-\.\+]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([a-zA-Z0-9\-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?))&#39;&#39;&#39;</span><span class="p">,</span> <span class="n">author</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">emailmatch</span><span class="p">:</span> <span class="k">return</span>
            <span class="n">email</span> <span class="o">=</span> <span class="n">emailmatch</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-123'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-123'>#</a>
      </div>
      <p>probably a better way to do the following, but it passes all the tests</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">author</span> <span class="o">=</span> <span class="n">author</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
            <span class="n">author</span> <span class="o">=</span> <span class="n">author</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;()&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
            <span class="n">author</span> <span class="o">=</span> <span class="n">author</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">author</span> <span class="ow">and</span> <span class="p">(</span><span class="n">author</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;(&#39;</span><span class="p">):</span>
                <span class="n">author</span> <span class="o">=</span> <span class="n">author</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">if</span> <span class="n">author</span> <span class="ow">and</span> <span class="p">(</span><span class="n">author</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;)&#39;</span><span class="p">):</span>
                <span class="n">author</span> <span class="o">=</span> <span class="n">author</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">author</span> <span class="o">=</span> <span class="n">author</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">context</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">_detail&#39;</span> <span class="o">%</span> <span class="n">key</span><span class="p">,</span> <span class="n">FeedParserDict</span><span class="p">())</span>
            <span class="n">context</span><span class="p">[</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">_detail&#39;</span> <span class="o">%</span> <span class="n">key</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">author</span>
            <span class="n">context</span><span class="p">[</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">_detail&#39;</span> <span class="o">%</span> <span class="n">key</span><span class="p">][</span><span class="s">&#39;email&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">email</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-124'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-124'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_start_subtitle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pushContent</span><span class="p">(</span><span class="s">&#39;subtitle&#39;</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">,</span> <span class="s">&#39;text/plain&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">_start_tagline</span> <span class="o">=</span> <span class="n">_start_subtitle</span>
    <span class="n">_start_itunes_subtitle</span> <span class="o">=</span> <span class="n">_start_subtitle</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-125'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-125'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_end_subtitle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">popContent</span><span class="p">(</span><span class="s">&#39;subtitle&#39;</span><span class="p">)</span>
    <span class="n">_end_tagline</span> <span class="o">=</span> <span class="n">_end_subtitle</span>
    <span class="n">_end_itunes_subtitle</span> <span class="o">=</span> <span class="n">_end_subtitle</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-126'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-126'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_start_rights</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pushContent</span><span class="p">(</span><span class="s">&#39;rights&#39;</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">,</span> <span class="s">&#39;text/plain&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">_start_dc_rights</span> <span class="o">=</span> <span class="n">_start_rights</span>
    <span class="n">_start_copyright</span> <span class="o">=</span> <span class="n">_start_rights</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-127'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-127'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_end_rights</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">popContent</span><span class="p">(</span><span class="s">&#39;rights&#39;</span><span class="p">)</span>
    <span class="n">_end_dc_rights</span> <span class="o">=</span> <span class="n">_end_rights</span>
    <span class="n">_end_copyright</span> <span class="o">=</span> <span class="n">_end_rights</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-128'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-128'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_start_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">FeedParserDict</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;item&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inentry</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">guidislink</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getAttribute</span><span class="p">(</span><span class="n">attrsD</span><span class="p">,</span> <span class="s">&#39;rdf:about&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">id</span><span class="p">:</span>
            <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getContext</span><span class="p">()</span>
            <span class="n">context</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cdf_common</span><span class="p">(</span><span class="n">attrsD</span><span class="p">)</span>
    <span class="n">_start_entry</span> <span class="o">=</span> <span class="n">_start_item</span>
    <span class="n">_start_product</span> <span class="o">=</span> <span class="n">_start_item</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-129'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-129'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_end_item</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;item&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inentry</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">_end_entry</span> <span class="o">=</span> <span class="n">_end_item</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-130'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-130'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_start_dc_language</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;language&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">_start_language</span> <span class="o">=</span> <span class="n">_start_dc_language</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-131'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-131'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_end_dc_language</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lang</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;language&#39;</span><span class="p">)</span>
    <span class="n">_end_language</span> <span class="o">=</span> <span class="n">_end_dc_language</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-132'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-132'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_start_dc_publisher</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;publisher&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">_start_webmaster</span> <span class="o">=</span> <span class="n">_start_dc_publisher</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-133'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-133'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_end_dc_publisher</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;publisher&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sync_author_detail</span><span class="p">(</span><span class="s">&#39;publisher&#39;</span><span class="p">)</span>
    <span class="n">_end_webmaster</span> <span class="o">=</span> <span class="n">_end_dc_publisher</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-134'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-134'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_start_published</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;published&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">_start_dcterms_issued</span> <span class="o">=</span> <span class="n">_start_published</span>
    <span class="n">_start_issued</span> <span class="o">=</span> <span class="n">_start_published</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-135'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-135'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_end_published</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;published&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save</span><span class="p">(</span><span class="s">&#39;published_parsed&#39;</span><span class="p">,</span> <span class="n">_parse_date</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
    <span class="n">_end_dcterms_issued</span> <span class="o">=</span> <span class="n">_end_published</span>
    <span class="n">_end_issued</span> <span class="o">=</span> <span class="n">_end_published</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-136'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-136'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_start_updated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;updated&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">_start_modified</span> <span class="o">=</span> <span class="n">_start_updated</span>
    <span class="n">_start_dcterms_modified</span> <span class="o">=</span> <span class="n">_start_updated</span>
    <span class="n">_start_pubdate</span> <span class="o">=</span> <span class="n">_start_updated</span>
    <span class="n">_start_dc_date</span> <span class="o">=</span> <span class="n">_start_updated</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-137'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-137'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_end_updated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;updated&#39;</span><span class="p">)</span>
        <span class="n">parsed_value</span> <span class="o">=</span> <span class="n">_parse_date</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save</span><span class="p">(</span><span class="s">&#39;updated_parsed&#39;</span><span class="p">,</span> <span class="n">parsed_value</span><span class="p">)</span>
    <span class="n">_end_modified</span> <span class="o">=</span> <span class="n">_end_updated</span>
    <span class="n">_end_dcterms_modified</span> <span class="o">=</span> <span class="n">_end_updated</span>
    <span class="n">_end_pubdate</span> <span class="o">=</span> <span class="n">_end_updated</span>
    <span class="n">_end_dc_date</span> <span class="o">=</span> <span class="n">_end_updated</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-138'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-138'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_start_created</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;created&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">_start_dcterms_created</span> <span class="o">=</span> <span class="n">_start_created</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-139'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-139'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_end_created</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;created&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save</span><span class="p">(</span><span class="s">&#39;created_parsed&#39;</span><span class="p">,</span> <span class="n">_parse_date</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
    <span class="n">_end_dcterms_created</span> <span class="o">=</span> <span class="n">_end_created</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-140'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-140'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_start_expirationdate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;expired&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-141'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-141'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_end_expirationdate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save</span><span class="p">(</span><span class="s">&#39;expired_parsed&#39;</span><span class="p">,</span> <span class="n">_parse_date</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;expired&#39;</span><span class="p">)))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-142'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-142'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_start_cc_license</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;license&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getAttribute</span><span class="p">(</span><span class="n">attrsD</span><span class="p">,</span> <span class="s">&#39;rdf:resource&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">elementstack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;license&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-143'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-143'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_start_creativecommons_license</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;license&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-144'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-144'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_end_creativecommons_license</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;license&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-145'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-145'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_addTag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">term</span><span class="p">,</span> <span class="n">scheme</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getContext</span><span class="p">()</span>
        <span class="n">tags</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&#39;tags&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">term</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">scheme</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">label</span><span class="p">):</span> <span class="k">return</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">FeedParserDict</span><span class="p">({</span><span class="s">&#39;term&#39;</span><span class="p">:</span> <span class="n">term</span><span class="p">,</span> <span class="s">&#39;scheme&#39;</span><span class="p">:</span> <span class="n">scheme</span><span class="p">,</span> <span class="s">&#39;label&#39;</span><span class="p">:</span> <span class="n">label</span><span class="p">})</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">:</span>
            <span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">FeedParserDict</span><span class="p">({</span><span class="s">&#39;term&#39;</span><span class="p">:</span> <span class="n">term</span><span class="p">,</span> <span class="s">&#39;scheme&#39;</span><span class="p">:</span> <span class="n">scheme</span><span class="p">,</span> <span class="s">&#39;label&#39;</span><span class="p">:</span> <span class="n">label</span><span class="p">}))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-146'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-146'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_start_category</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">_debug</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;entering _start_category with </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">attrsD</span><span class="p">))</span>
        <span class="n">term</span> <span class="o">=</span> <span class="n">attrsD</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;term&#39;</span><span class="p">)</span>
        <span class="n">scheme</span> <span class="o">=</span> <span class="n">attrsD</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;scheme&#39;</span><span class="p">,</span> <span class="n">attrsD</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;domain&#39;</span><span class="p">))</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">attrsD</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;label&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_addTag</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">scheme</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;category&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">_start_dc_subject</span> <span class="o">=</span> <span class="n">_start_category</span>
    <span class="n">_start_keywords</span> <span class="o">=</span> <span class="n">_start_category</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-147'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-147'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_end_itunes_keywords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;itunes_keywords&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_addTag</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="s">&#39;http://www.itunes.com/&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-148'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-148'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_start_itunes_category</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_addTag</span><span class="p">(</span><span class="n">attrsD</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;text&#39;</span><span class="p">),</span> <span class="s">&#39;http://www.itunes.com/&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;category&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-149'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-149'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_end_category</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;category&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span> <span class="k">return</span>
        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getContext</span><span class="p">()</span>
        <span class="n">tags</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="s">&#39;tags&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">tags</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;term&#39;</span><span class="p">]:</span>
            <span class="n">tags</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;term&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_addTag</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="n">_end_dc_subject</span> <span class="o">=</span> <span class="n">_end_category</span>
    <span class="n">_end_keywords</span> <span class="o">=</span> <span class="n">_end_category</span>
    <span class="n">_end_itunes_category</span> <span class="o">=</span> <span class="n">_end_category</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-150'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-150'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_start_cloud</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_getContext</span><span class="p">()[</span><span class="s">&#39;cloud&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FeedParserDict</span><span class="p">(</span><span class="n">attrsD</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-151'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-151'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_start_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">):</span>
        <span class="n">attrsD</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&#39;rel&#39;</span><span class="p">,</span> <span class="s">&#39;alternate&#39;</span><span class="p">)</span>
        <span class="n">attrsD</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">,</span> <span class="s">&#39;text/html&#39;</span><span class="p">)</span>
        <span class="n">attrsD</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_itsAnHrefDamnIt</span><span class="p">(</span><span class="n">attrsD</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">attrsD</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;href&#39;</span><span class="p">):</span>
            <span class="n">attrsD</span><span class="p">[</span><span class="s">&#39;href&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolveURI</span><span class="p">(</span><span class="n">attrsD</span><span class="p">[</span><span class="s">&#39;href&#39;</span><span class="p">])</span>
        <span class="n">expectingText</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infeed</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">inentry</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">insource</span>
        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getContext</span><span class="p">()</span>
        <span class="n">context</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&#39;links&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">context</span><span class="p">[</span><span class="s">&#39;links&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">FeedParserDict</span><span class="p">(</span><span class="n">attrsD</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">attrsD</span><span class="p">[</span><span class="s">&#39;rel&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;enclosure&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_start_enclosure</span><span class="p">(</span><span class="n">attrsD</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">attrsD</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;href&#39;</span><span class="p">):</span>
            <span class="n">expectingText</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">attrsD</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;rel&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;alternate&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapContentType</span><span class="p">(</span><span class="n">attrsD</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">))</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">html_types</span><span class="p">):</span>
                <span class="n">context</span><span class="p">[</span><span class="s">&#39;link&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">attrsD</span><span class="p">[</span><span class="s">&#39;href&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;link&#39;</span><span class="p">,</span> <span class="n">expectingText</span><span class="p">)</span>
    <span class="n">_start_producturl</span> <span class="o">=</span> <span class="n">_start_link</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-152'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-152'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_end_link</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;link&#39;</span><span class="p">)</span>
        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getContext</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">intextinput</span><span class="p">:</span>
            <span class="n">context</span><span class="p">[</span><span class="s">&#39;textinput&#39;</span><span class="p">][</span><span class="s">&#39;link&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inimage</span><span class="p">:</span>
            <span class="n">context</span><span class="p">[</span><span class="s">&#39;image&#39;</span><span class="p">][</span><span class="s">&#39;link&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="n">_end_producturl</span> <span class="o">=</span> <span class="n">_end_link</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-153'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-153'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_start_guid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">guidislink</span> <span class="o">=</span> <span class="p">(</span><span class="n">attrsD</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;ispermalink&#39;</span><span class="p">,</span> <span class="s">&#39;true&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;true&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-154'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-154'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_end_guid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save</span><span class="p">(</span><span class="s">&#39;guidislink&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">guidislink</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getContext</span><span class="p">()</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;link&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">guidislink</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-155'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-155'>#</a>
      </div>
      <p>guid acts as link, but only if 'ispermalink' is not present or is 'true',
and only if the item doesn't already have a link element</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="bp">self</span><span class="o">.</span><span class="n">_save</span><span class="p">(</span><span class="s">&#39;link&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-156'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-156'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_start_title</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pushContent</span><span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">,</span> <span class="s">&#39;text/plain&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">infeed</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">inentry</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">insource</span><span class="p">)</span>
    <span class="n">_start_dc_title</span> <span class="o">=</span> <span class="n">_start_title</span>
    <span class="n">_start_media_title</span> <span class="o">=</span> <span class="n">_start_title</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-157'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-157'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_end_title</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">popContent</span><span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">)</span>
        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getContext</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">intextinput</span><span class="p">:</span>
            <span class="n">context</span><span class="p">[</span><span class="s">&#39;textinput&#39;</span><span class="p">][</span><span class="s">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">inimage</span><span class="p">:</span>
            <span class="n">context</span><span class="p">[</span><span class="s">&#39;image&#39;</span><span class="p">][</span><span class="s">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="n">_end_dc_title</span> <span class="o">=</span> <span class="n">_end_title</span>
    <span class="n">_end_media_title</span> <span class="o">=</span> <span class="n">_end_title</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-158'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-158'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_start_description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getContext</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;summary&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_summaryKey</span> <span class="o">=</span> <span class="s">&#39;content&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_start_content</span><span class="p">(</span><span class="n">attrsD</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pushContent</span><span class="p">(</span><span class="s">&#39;description&#39;</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">,</span> <span class="s">&#39;text/html&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">infeed</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">inentry</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">insource</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-159'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-159'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_start_abstract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pushContent</span><span class="p">(</span><span class="s">&#39;description&#39;</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">,</span> <span class="s">&#39;text/plain&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">infeed</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">inentry</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">insource</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-160'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-160'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_end_description</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summaryKey</span> <span class="o">==</span> <span class="s">&#39;content&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_end_content</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">popContent</span><span class="p">(</span><span class="s">&#39;description&#39;</span><span class="p">)</span>
            <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getContext</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">intextinput</span><span class="p">:</span>
                <span class="n">context</span><span class="p">[</span><span class="s">&#39;textinput&#39;</span><span class="p">][</span><span class="s">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">inimage</span><span class="p">:</span>
                <span class="n">context</span><span class="p">[</span><span class="s">&#39;image&#39;</span><span class="p">][</span><span class="s">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_summaryKey</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_end_abstract</span> <span class="o">=</span> <span class="n">_end_description</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-161'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-161'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_start_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pushContent</span><span class="p">(</span><span class="s">&#39;info&#39;</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">,</span> <span class="s">&#39;text/plain&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">_start_feedburner_browserfriendly</span> <span class="o">=</span> <span class="n">_start_info</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-162'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-162'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_end_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">popContent</span><span class="p">(</span><span class="s">&#39;info&#39;</span><span class="p">)</span>
    <span class="n">_end_feedburner_browserfriendly</span> <span class="o">=</span> <span class="n">_end_info</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-163'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-163'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_start_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">attrsD</span><span class="p">:</span>
            <span class="n">attrsD</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_itsAnHrefDamnIt</span><span class="p">(</span><span class="n">attrsD</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">attrsD</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;href&#39;</span><span class="p">):</span>
                <span class="n">attrsD</span><span class="p">[</span><span class="s">&#39;href&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolveURI</span><span class="p">(</span><span class="n">attrsD</span><span class="p">[</span><span class="s">&#39;href&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_getContext</span><span class="p">()[</span><span class="s">&#39;generator_detail&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FeedParserDict</span><span class="p">(</span><span class="n">attrsD</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;generator&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-164'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-164'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_end_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;generator&#39;</span><span class="p">)</span>
        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getContext</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;generator_detail&#39;</span><span class="p">):</span>
            <span class="n">context</span><span class="p">[</span><span class="s">&#39;generator_detail&#39;</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-165'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-165'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_start_admin_generatoragent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;generator&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getAttribute</span><span class="p">(</span><span class="n">attrsD</span><span class="p">,</span> <span class="s">&#39;rdf:resource&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">elementstack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;generator&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_getContext</span><span class="p">()[</span><span class="s">&#39;generator_detail&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FeedParserDict</span><span class="p">({</span><span class="s">&#39;href&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">})</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-166'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-166'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_start_admin_errorreportsto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;errorreportsto&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getAttribute</span><span class="p">(</span><span class="n">attrsD</span><span class="p">,</span> <span class="s">&#39;rdf:resource&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">elementstack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;errorreportsto&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-167'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-167'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_start_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getContext</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;summary&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_summaryKey</span> <span class="o">=</span> <span class="s">&#39;content&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_start_content</span><span class="p">(</span><span class="n">attrsD</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_summaryKey</span> <span class="o">=</span> <span class="s">&#39;summary&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pushContent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_summaryKey</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">,</span> <span class="s">&#39;text/plain&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">_start_itunes_summary</span> <span class="o">=</span> <span class="n">_start_summary</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-168'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-168'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_end_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summaryKey</span> <span class="o">==</span> <span class="s">&#39;content&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_end_content</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">popContent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_summaryKey</span> <span class="ow">or</span> <span class="s">&#39;summary&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_summaryKey</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_end_itunes_summary</span> <span class="o">=</span> <span class="n">_end_summary</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-169'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-169'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_start_enclosure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">):</span>
        <span class="n">attrsD</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_itsAnHrefDamnIt</span><span class="p">(</span><span class="n">attrsD</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_getContext</span><span class="p">()</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&#39;enclosures&#39;</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">FeedParserDict</span><span class="p">(</span><span class="n">attrsD</span><span class="p">))</span>
        <span class="n">href</span> <span class="o">=</span> <span class="n">attrsD</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;href&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">href</span><span class="p">:</span>
            <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getContext</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">):</span>
                <span class="n">context</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">href</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-170'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-170'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_start_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insource</span> <span class="o">=</span> <span class="mi">1</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-171'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-171'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_end_source</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insource</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_getContext</span><span class="p">()[</span><span class="s">&#39;source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sourcedata</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sourcedata</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-172'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-172'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_start_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pushContent</span><span class="p">(</span><span class="s">&#39;content&#39;</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">,</span> <span class="s">&#39;text/plain&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">src</span> <span class="o">=</span> <span class="n">attrsD</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;src&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">src</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">contentparams</span><span class="p">[</span><span class="s">&#39;src&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">src</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;content&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-173'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-173'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_start_prodlink</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pushContent</span><span class="p">(</span><span class="s">&#39;content&#39;</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">,</span> <span class="s">&#39;text/html&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-174'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-174'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_start_body</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pushContent</span><span class="p">(</span><span class="s">&#39;content&#39;</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">,</span> <span class="s">&#39;application/xhtml+xml&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">_start_xhtml_body</span> <span class="o">=</span> <span class="n">_start_body</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-175'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-175'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_start_content_encoded</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pushContent</span><span class="p">(</span><span class="s">&#39;content&#39;</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">,</span> <span class="s">&#39;text/html&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">_start_fullitem</span> <span class="o">=</span> <span class="n">_start_content_encoded</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-176'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-176'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_end_content</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">copyToDescription</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapContentType</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contentparams</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">))</span> <span class="ow">in</span> <span class="p">([</span><span class="s">&#39;text/plain&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">html_types</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">popContent</span><span class="p">(</span><span class="s">&#39;content&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">copyToDescription</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save</span><span class="p">(</span><span class="s">&#39;description&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="n">_end_body</span> <span class="o">=</span> <span class="n">_end_content</span>
    <span class="n">_end_xhtml_body</span> <span class="o">=</span> <span class="n">_end_content</span>
    <span class="n">_end_content_encoded</span> <span class="o">=</span> <span class="n">_end_content</span>
    <span class="n">_end_fullitem</span> <span class="o">=</span> <span class="n">_end_content</span>
    <span class="n">_end_prodlink</span> <span class="o">=</span> <span class="n">_end_content</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-177'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-177'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_start_itunes_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrsD</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s">&#39;itunes_image&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_getContext</span><span class="p">()[</span><span class="s">&#39;image&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FeedParserDict</span><span class="p">({</span><span class="s">&#39;href&#39;</span><span class="p">:</span> <span class="n">attrsD</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;href&#39;</span><span class="p">)})</span>
    <span class="n">_start_itunes_link</span> <span class="o">=</span> <span class="n">_start_itunes_image</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-178'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-178'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_end_itunes_block</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;itunes_block&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_getContext</span><span class="p">()[</span><span class="s">&#39;itunes_block&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span> <span class="o">==</span> <span class="s">&#39;yes&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="mi">1</span> <span class="ow">or</span> <span class="mi">0</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-179'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-179'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_end_itunes_explicit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;itunes_explicit&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_getContext</span><span class="p">()[</span><span class="s">&#39;itunes_explicit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span> <span class="o">==</span> <span class="s">&#39;yes&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="mi">1</span> <span class="ow">or</span> <span class="mi">0</span>

<span class="k">if</span> <span class="n">_XML_AVAILABLE</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-180'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-180'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">class</span> <span class="nc">_StrictFeedParser</span><span class="p">(</span><span class="n">_FeedParserMixin</span><span class="p">,</span> <span class="n">xml</span><span class="o">.</span><span class="n">sax</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">ContentHandler</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-181'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-181'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">baseuri</span><span class="p">,</span> <span class="n">baselang</span><span class="p">,</span> <span class="n">encoding</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">_debug</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;trying StrictFeedParser</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">xml</span><span class="o">.</span><span class="n">sax</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">ContentHandler</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">_FeedParserMixin</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">baseuri</span><span class="p">,</span> <span class="n">baselang</span><span class="p">,</span> <span class="n">encoding</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bozo</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exc</span> <span class="o">=</span> <span class="bp">None</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-182'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-182'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">def</span> <span class="nf">startPrefixMapping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">uri</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trackNamespace</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">uri</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-183'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-183'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">def</span> <span class="nf">startElementNS</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">qname</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
            <span class="n">namespace</span><span class="p">,</span> <span class="n">localname</span> <span class="o">=</span> <span class="n">name</span>
            <span class="n">lowernamespace</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">namespace</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">lowernamespace</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;backend.userland.com/rss&#39;</span><span class="p">)</span> <span class="o">&lt;&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-184'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-184'>#</a>
      </div>
      <p>match any backend.userland.com namespace</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="n">namespace</span> <span class="o">=</span> <span class="s">&#39;http://backend.userland.com/rss&#39;</span>
                <span class="n">lowernamespace</span> <span class="o">=</span> <span class="n">namespace</span>
            <span class="k">if</span> <span class="n">qname</span> <span class="ow">and</span> <span class="n">qname</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">givenprefix</span> <span class="o">=</span> <span class="n">qname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">givenprefix</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_matchnamespaces</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">lowernamespace</span><span class="p">,</span> <span class="n">givenprefix</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">givenprefix</span> <span class="ow">and</span> <span class="p">(</span><span class="n">prefix</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span> <span class="p">(</span><span class="n">prefix</span> <span class="o">==</span> <span class="s">&#39;&#39;</span> <span class="ow">and</span> <span class="n">lowernamespace</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">))</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">namespacesInUse</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">givenprefix</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">UndeclaredNamespace</span><span class="p">,</span> <span class="s">&quot;&#39;</span><span class="si">%s</span><span class="s">&#39; is not associated with a namespace&quot;</span> <span class="o">%</span> <span class="n">givenprefix</span>
            <span class="k">if</span> <span class="n">prefix</span><span class="p">:</span>
                <span class="n">localname</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s">&#39;:&#39;</span> <span class="o">+</span> <span class="n">localname</span>
            <span class="n">localname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">localname</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">_debug</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;startElementNS: qname = </span><span class="si">%s</span><span class="s">, namespace = </span><span class="si">%s</span><span class="s">, givenprefix = </span><span class="si">%s</span><span class="s">, prefix = </span><span class="si">%s</span><span class="s">, attrs = </span><span class="si">%s</span><span class="s">, localname = </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">qname</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">givenprefix</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">attrs</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">localname</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-185'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-185'>#</a>
      </div>
      <p>qname implementation is horribly broken in Python 2.1 (it
doesn't report any), and slightly broken in Python 2.2 (it
doesn't report the xml: namespace). So we match up namespaces
with a known list first, and then possibly override them with
the qnames the SAX parser gives us (if indeed it gives us any
at all).  Thanks to MatejC for helping me test this and
tirelessly telling me that it didn't work yet.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">attrsD</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">attrlocalname</span><span class="p">),</span> <span class="n">attrvalue</span> <span class="ow">in</span> <span class="n">attrs</span><span class="o">.</span><span class="n">_attrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">lowernamespace</span> <span class="o">=</span> <span class="p">(</span><span class="n">namespace</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="n">prefix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_matchnamespaces</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">lowernamespace</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">prefix</span><span class="p">:</span>
                    <span class="n">attrlocalname</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s">&#39;:&#39;</span> <span class="o">+</span> <span class="n">attrlocalname</span>
                <span class="n">attrsD</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">attrlocalname</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="n">attrvalue</span>
            <span class="k">for</span> <span class="n">qname</span> <span class="ow">in</span> <span class="n">attrs</span><span class="o">.</span><span class="n">getQNames</span><span class="p">():</span>
                <span class="n">attrsD</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">qname</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">getValueByQName</span><span class="p">(</span><span class="n">qname</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unknown_starttag</span><span class="p">(</span><span class="n">localname</span><span class="p">,</span> <span class="n">attrsD</span><span class="o">.</span><span class="n">items</span><span class="p">())</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-186'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-186'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">def</span> <span class="nf">characters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_data</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-187'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-187'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">def</span> <span class="nf">endElementNS</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">qname</span><span class="p">):</span>
            <span class="n">namespace</span><span class="p">,</span> <span class="n">localname</span> <span class="o">=</span> <span class="n">name</span>
            <span class="n">lowernamespace</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">namespace</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">qname</span> <span class="ow">and</span> <span class="n">qname</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">givenprefix</span> <span class="o">=</span> <span class="n">qname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">givenprefix</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_matchnamespaces</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">lowernamespace</span><span class="p">,</span> <span class="n">givenprefix</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">prefix</span><span class="p">:</span>
                <span class="n">localname</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s">&#39;:&#39;</span> <span class="o">+</span> <span class="n">localname</span>
            <span class="n">localname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">localname</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unknown_endtag</span><span class="p">(</span><span class="n">localname</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-188'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-188'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bozo</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exc</span> <span class="o">=</span> <span class="n">exc</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-189'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-189'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">def</span> <span class="nf">fatalError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">exc</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-190'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-190'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">_BaseHTMLProcessor</span><span class="p">(</span><span class="n">sgmllib</span><span class="o">.</span><span class="n">SGMLParser</span><span class="p">):</span>
    <span class="n">elements_no_end_tag</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;area&#39;</span><span class="p">,</span> <span class="s">&#39;base&#39;</span><span class="p">,</span> <span class="s">&#39;basefont&#39;</span><span class="p">,</span> <span class="s">&#39;br&#39;</span><span class="p">,</span> <span class="s">&#39;col&#39;</span><span class="p">,</span> <span class="s">&#39;frame&#39;</span><span class="p">,</span> <span class="s">&#39;hr&#39;</span><span class="p">,</span>
      <span class="s">&#39;img&#39;</span><span class="p">,</span> <span class="s">&#39;input&#39;</span><span class="p">,</span> <span class="s">&#39;isindex&#39;</span><span class="p">,</span> <span class="s">&#39;link&#39;</span><span class="p">,</span> <span class="s">&#39;meta&#39;</span><span class="p">,</span> <span class="s">&#39;param&#39;</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-191'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-191'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encoding</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="n">encoding</span>
        <span class="k">if</span> <span class="n">_debug</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;entering BaseHTMLProcessor, encoding=</span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span>
        <span class="n">sgmllib</span><span class="o">.</span><span class="n">SGMLParser</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-192'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-192'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pieces</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">sgmllib</span><span class="o">.</span><span class="n">SGMLParser</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-193'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-193'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_shorttag_replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">match</span><span class="p">):</span>
        <span class="n">tag</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements_no_end_tag</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;&lt;&#39;</span> <span class="o">+</span> <span class="n">tag</span> <span class="o">+</span> <span class="s">&#39; /&gt;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;&lt;&#39;</span> <span class="o">+</span> <span class="n">tag</span> <span class="o">+</span> <span class="s">&#39;&gt;&lt;/&#39;</span> <span class="o">+</span> <span class="n">tag</span> <span class="o">+</span> <span class="s">&#39;&gt;&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-194'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-194'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">feed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;&lt;!((?!DOCTYPE|--|\[))&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;&amp;lt;!\1&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-195'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-195'>#</a>
      </div>
      <p>data = re.sub(r'&lt;(\S+?)\s*?/&gt;', self._shorttag_replace, data) # bug [ 1399464 ] Bad regexp for _shorttag_replace</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">data</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;&lt;([^&lt;\s]+?)\s*/&gt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shorttag_replace</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> 
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&amp;#39;&#39;</span><span class="p">,</span> <span class="s">&quot;&#39;&quot;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&amp;#34;&#39;</span><span class="p">,</span> <span class="s">&#39;&quot;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="s">u&#39;&#39;</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span>
        <span class="n">sgmllib</span><span class="o">.</span><span class="n">SGMLParser</span><span class="o">.</span><span class="n">feed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-196'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-196'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">normalize_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-197'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-197'>#</a>
      </div>
      <p>utility method to be called by descendants</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">attrs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">]</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">k</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;rel&#39;</span><span class="p">,</span> <span class="s">&#39;type&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">v</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">or</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">attrs</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-198'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-198'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">unknown_starttag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-199'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-199'>#</a>
      </div>
      <p>called for each start tag
attrs is a list of (attr, value) tuples
e.g. for <pre class='screen'>, tag='pre', attrs=[('class', 'screen')]</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">_debug</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;_BaseHTMLProcessor, unknown_starttag, tag=</span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">tag</span><span class="p">)</span>
        <span class="n">uattrs</span> <span class="o">=</span> <span class="p">[]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-200'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-200'>#</a>
      </div>
      <p>thanks to Kevin Marks for this breathtaking hack to deal with (valid) high-bit attribute values in UTF-8 feeds</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">type</span><span class="p">(</span><span class="s">u&#39;&#39;</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span>
            <span class="n">uattrs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">unicode</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">),</span> <span class="n">value</span><span class="p">))</span>
        <span class="n">strattrs</span> <span class="o">=</span> <span class="s">u&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">u&#39; </span><span class="si">%s</span><span class="s">=&quot;</span><span class="si">%s</span><span class="s">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">uattrs</span><span class="p">])</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements_no_end_tag</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pieces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;&lt;</span><span class="si">%(tag)s%(strattrs)s</span><span class="s"> /&gt;&#39;</span> <span class="o">%</span> <span class="nb">locals</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pieces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;&lt;</span><span class="si">%(tag)s%(strattrs)s</span><span class="s">&gt;&#39;</span> <span class="o">%</span> <span class="nb">locals</span><span class="p">())</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-201'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-201'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">unknown_endtag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-202'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-202'>#</a>
      </div>
      <p>called for each end tag, e.g. for </pre>, tag will be 'pre'
Reconstruct the original end tag.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">tag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements_no_end_tag</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pieces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;&lt;/</span><span class="si">%(tag)s</span><span class="s">&gt;&quot;</span> <span class="o">%</span> <span class="nb">locals</span><span class="p">())</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-203'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-203'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">handle_charref</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-204'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-204'>#</a>
      </div>
      <p>called for each character reference, e.g. for '&#160;', ref will be '160'
Reconstruct the original character reference.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">pieces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;&amp;#</span><span class="si">%(ref)s</span><span class="s">;&#39;</span> <span class="o">%</span> <span class="nb">locals</span><span class="p">())</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-205'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-205'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">handle_entityref</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-206'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-206'>#</a>
      </div>
      <p>called for each entity reference, e.g. for '&copy;', ref will be 'copy'
Reconstruct the original entity reference.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">pieces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;&amp;</span><span class="si">%(ref)s</span><span class="s">;&#39;</span> <span class="o">%</span> <span class="nb">locals</span><span class="p">())</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-207'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-207'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">handle_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-208'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-208'>#</a>
      </div>
      <p>called for each block of plain text, i.e. outside of any tag and
not containing any character or entity references
Store the original text verbatim.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">_debug</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;_BaseHTMLProcessor, handle_text, text=</span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">text</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pieces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-209'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-209'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">handle_comment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-210'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-210'>#</a>
      </div>
      <p>called for each HTML comment, e.g. <!-- insert Javascript code here -->
Reconstruct the original comment.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">pieces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;&lt;!--</span><span class="si">%(text)s</span><span class="s">--&gt;&#39;</span> <span class="o">%</span> <span class="nb">locals</span><span class="p">())</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-211'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-211'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">handle_pi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-212'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-212'>#</a>
      </div>
      <p>called for each processing instruction, e.g. &lt;?instruction&gt;
Reconstruct original processing instruction.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">pieces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;&lt;?</span><span class="si">%(text)s</span><span class="s">&gt;&#39;</span> <span class="o">%</span> <span class="nb">locals</span><span class="p">())</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-213'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-213'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">handle_decl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-214'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-214'>#</a>
      </div>
      <p>called for the DOCTYPE, if present, e.g.
&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
    "http://www.w3.org/TR/html4/loose.dtd"&gt;
Reconstruct original DOCTYPE</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">pieces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;&lt;!</span><span class="si">%(text)s</span><span class="s">&gt;&#39;</span> <span class="o">%</span> <span class="nb">locals</span><span class="p">())</span>
        
    <span class="n">_new_declname_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;[a-zA-Z][-_.a-zA-Z0-9:]*\s*&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">match</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-215'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-215'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_scan_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">declstartpos</span><span class="p">):</span>
        <span class="n">rawdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rawdata</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rawdata</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">n</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_declname_match</span><span class="p">(</span><span class="n">rawdata</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">))</span> <span class="o">==</span> <span class="n">n</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>  <span class="c"># end of buffer</span>
            <span class="k">return</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">m</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_data</span><span class="p">(</span><span class="n">rawdata</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-216'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-216'>#</a>
      </div>
      <pre><code>       self.updatepos(declstartpos, i)
</code></pre>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="k">return</span> <span class="bp">None</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-217'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-217'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return processed HTML as a single string&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pieces</span><span class="p">])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-218'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-218'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">_LooseFeedParser</span><span class="p">(</span><span class="n">_FeedParserMixin</span><span class="p">,</span> <span class="n">_BaseHTMLProcessor</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-219'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-219'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">baseuri</span><span class="p">,</span> <span class="n">baselang</span><span class="p">,</span> <span class="n">encoding</span><span class="p">):</span>
        <span class="n">sgmllib</span><span class="o">.</span><span class="n">SGMLParser</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">_FeedParserMixin</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">baseuri</span><span class="p">,</span> <span class="n">baselang</span><span class="p">,</span> <span class="n">encoding</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-220'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-220'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">decodeEntities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&amp;#60;&#39;</span><span class="p">,</span> <span class="s">&#39;&amp;lt;&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&amp;#x3c;&#39;</span><span class="p">,</span> <span class="s">&#39;&amp;lt;&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&amp;#62;&#39;</span><span class="p">,</span> <span class="s">&#39;&amp;gt;&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&amp;#x3e;&#39;</span><span class="p">,</span> <span class="s">&#39;&amp;gt;&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&amp;#38;&#39;</span><span class="p">,</span> <span class="s">&#39;&amp;amp;&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&amp;#x26;&#39;</span><span class="p">,</span> <span class="s">&#39;&amp;amp;&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&amp;#34;&#39;</span><span class="p">,</span> <span class="s">&#39;&amp;quot;&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&amp;#x22;&#39;</span><span class="p">,</span> <span class="s">&#39;&amp;quot;&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&amp;#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&amp;apos;&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&amp;#x27;&#39;</span><span class="p">,</span> <span class="s">&#39;&amp;apos;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">contentparams</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">contentparams</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">,</span> <span class="s">&#39;xml&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;xml&#39;</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&amp;lt;&#39;</span><span class="p">,</span> <span class="s">&#39;&lt;&#39;</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&amp;gt;&#39;</span><span class="p">,</span> <span class="s">&#39;&gt;&#39;</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&amp;amp;&#39;</span><span class="p">,</span> <span class="s">&#39;&amp;&#39;</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&amp;quot;&#39;</span><span class="p">,</span> <span class="s">&#39;&quot;&#39;</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&amp;apos;&#39;</span><span class="p">,</span> <span class="s">&quot;&#39;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-221'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-221'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">_RelativeURIResolver</span><span class="p">(</span><span class="n">_BaseHTMLProcessor</span><span class="p">):</span>
    <span class="n">relative_uris</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;href&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s">&#39;applet&#39;</span><span class="p">,</span> <span class="s">&#39;codebase&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s">&#39;area&#39;</span><span class="p">,</span> <span class="s">&#39;href&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s">&#39;blockquote&#39;</span><span class="p">,</span> <span class="s">&#39;cite&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s">&#39;body&#39;</span><span class="p">,</span> <span class="s">&#39;background&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s">&#39;del&#39;</span><span class="p">,</span> <span class="s">&#39;cite&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s">&#39;form&#39;</span><span class="p">,</span> <span class="s">&#39;action&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s">&#39;frame&#39;</span><span class="p">,</span> <span class="s">&#39;longdesc&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s">&#39;frame&#39;</span><span class="p">,</span> <span class="s">&#39;src&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s">&#39;iframe&#39;</span><span class="p">,</span> <span class="s">&#39;longdesc&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s">&#39;iframe&#39;</span><span class="p">,</span> <span class="s">&#39;src&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s">&#39;head&#39;</span><span class="p">,</span> <span class="s">&#39;profile&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s">&#39;img&#39;</span><span class="p">,</span> <span class="s">&#39;longdesc&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s">&#39;img&#39;</span><span class="p">,</span> <span class="s">&#39;src&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s">&#39;img&#39;</span><span class="p">,</span> <span class="s">&#39;usemap&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s">&#39;input&#39;</span><span class="p">,</span> <span class="s">&#39;src&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s">&#39;input&#39;</span><span class="p">,</span> <span class="s">&#39;usemap&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s">&#39;ins&#39;</span><span class="p">,</span> <span class="s">&#39;cite&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s">&#39;link&#39;</span><span class="p">,</span> <span class="s">&#39;href&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s">&#39;object&#39;</span><span class="p">,</span> <span class="s">&#39;classid&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s">&#39;object&#39;</span><span class="p">,</span> <span class="s">&#39;codebase&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s">&#39;object&#39;</span><span class="p">,</span> <span class="s">&#39;data&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s">&#39;object&#39;</span><span class="p">,</span> <span class="s">&#39;usemap&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s">&#39;q&#39;</span><span class="p">,</span> <span class="s">&#39;cite&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s">&#39;script&#39;</span><span class="p">,</span> <span class="s">&#39;src&#39;</span><span class="p">)]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-222'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-222'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">baseuri</span><span class="p">,</span> <span class="n">encoding</span><span class="p">):</span>
        <span class="n">_BaseHTMLProcessor</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encoding</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">baseuri</span> <span class="o">=</span> <span class="n">baseuri</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-223'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-223'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">resolveURI</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uri</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_urljoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseuri</span><span class="p">,</span> <span class="n">uri</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-224'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-224'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">unknown_starttag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalize_attrs</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">key</span><span class="p">,</span> <span class="p">((</span><span class="n">tag</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">relative_uris</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolveURI</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">or</span> <span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">]</span>
        <span class="n">_BaseHTMLProcessor</span><span class="o">.</span><span class="n">unknown_starttag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-225'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-225'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">_resolveRelativeURIs</span><span class="p">(</span><span class="n">htmlSource</span><span class="p">,</span> <span class="n">baseURI</span><span class="p">,</span> <span class="n">encoding</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">_debug</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;entering _resolveRelativeURIs</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">_RelativeURIResolver</span><span class="p">(</span><span class="n">baseURI</span><span class="p">,</span> <span class="n">encoding</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">feed</span><span class="p">(</span><span class="n">htmlSource</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">output</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-226'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-226'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">_HTMLSanitizer</span><span class="p">(</span><span class="n">_BaseHTMLProcessor</span><span class="p">):</span>
    <span class="n">acceptable_elements</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;abbr&#39;</span><span class="p">,</span> <span class="s">&#39;acronym&#39;</span><span class="p">,</span> <span class="s">&#39;address&#39;</span><span class="p">,</span> <span class="s">&#39;area&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;big&#39;</span><span class="p">,</span>
      <span class="s">&#39;blockquote&#39;</span><span class="p">,</span> <span class="s">&#39;br&#39;</span><span class="p">,</span> <span class="s">&#39;button&#39;</span><span class="p">,</span> <span class="s">&#39;caption&#39;</span><span class="p">,</span> <span class="s">&#39;center&#39;</span><span class="p">,</span> <span class="s">&#39;cite&#39;</span><span class="p">,</span> <span class="s">&#39;code&#39;</span><span class="p">,</span> <span class="s">&#39;col&#39;</span><span class="p">,</span>
      <span class="s">&#39;colgroup&#39;</span><span class="p">,</span> <span class="s">&#39;dd&#39;</span><span class="p">,</span> <span class="s">&#39;del&#39;</span><span class="p">,</span> <span class="s">&#39;dfn&#39;</span><span class="p">,</span> <span class="s">&#39;dir&#39;</span><span class="p">,</span> <span class="s">&#39;div&#39;</span><span class="p">,</span> <span class="s">&#39;dl&#39;</span><span class="p">,</span> <span class="s">&#39;dt&#39;</span><span class="p">,</span> <span class="s">&#39;em&#39;</span><span class="p">,</span> <span class="s">&#39;fieldset&#39;</span><span class="p">,</span>
      <span class="s">&#39;font&#39;</span><span class="p">,</span> <span class="s">&#39;form&#39;</span><span class="p">,</span> <span class="s">&#39;h1&#39;</span><span class="p">,</span> <span class="s">&#39;h2&#39;</span><span class="p">,</span> <span class="s">&#39;h3&#39;</span><span class="p">,</span> <span class="s">&#39;h4&#39;</span><span class="p">,</span> <span class="s">&#39;h5&#39;</span><span class="p">,</span> <span class="s">&#39;h6&#39;</span><span class="p">,</span> <span class="s">&#39;hr&#39;</span><span class="p">,</span> <span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="s">&#39;img&#39;</span><span class="p">,</span> <span class="s">&#39;input&#39;</span><span class="p">,</span>
      <span class="s">&#39;ins&#39;</span><span class="p">,</span> <span class="s">&#39;kbd&#39;</span><span class="p">,</span> <span class="s">&#39;label&#39;</span><span class="p">,</span> <span class="s">&#39;legend&#39;</span><span class="p">,</span> <span class="s">&#39;li&#39;</span><span class="p">,</span> <span class="s">&#39;map&#39;</span><span class="p">,</span> <span class="s">&#39;menu&#39;</span><span class="p">,</span> <span class="s">&#39;ol&#39;</span><span class="p">,</span> <span class="s">&#39;optgroup&#39;</span><span class="p">,</span>
      <span class="s">&#39;option&#39;</span><span class="p">,</span> <span class="s">&#39;p&#39;</span><span class="p">,</span> <span class="s">&#39;pre&#39;</span><span class="p">,</span> <span class="s">&#39;q&#39;</span><span class="p">,</span> <span class="s">&#39;s&#39;</span><span class="p">,</span> <span class="s">&#39;samp&#39;</span><span class="p">,</span> <span class="s">&#39;select&#39;</span><span class="p">,</span> <span class="s">&#39;small&#39;</span><span class="p">,</span> <span class="s">&#39;span&#39;</span><span class="p">,</span> <span class="s">&#39;strike&#39;</span><span class="p">,</span>
      <span class="s">&#39;strong&#39;</span><span class="p">,</span> <span class="s">&#39;sub&#39;</span><span class="p">,</span> <span class="s">&#39;sup&#39;</span><span class="p">,</span> <span class="s">&#39;table&#39;</span><span class="p">,</span> <span class="s">&#39;tbody&#39;</span><span class="p">,</span> <span class="s">&#39;td&#39;</span><span class="p">,</span> <span class="s">&#39;textarea&#39;</span><span class="p">,</span> <span class="s">&#39;tfoot&#39;</span><span class="p">,</span> <span class="s">&#39;th&#39;</span><span class="p">,</span>
      <span class="s">&#39;thead&#39;</span><span class="p">,</span> <span class="s">&#39;tr&#39;</span><span class="p">,</span> <span class="s">&#39;tt&#39;</span><span class="p">,</span> <span class="s">&#39;u&#39;</span><span class="p">,</span> <span class="s">&#39;ul&#39;</span><span class="p">,</span> <span class="s">&#39;var&#39;</span><span class="p">]</span>

    <span class="n">acceptable_attributes</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;abbr&#39;</span><span class="p">,</span> <span class="s">&#39;accept&#39;</span><span class="p">,</span> <span class="s">&#39;accept-charset&#39;</span><span class="p">,</span> <span class="s">&#39;accesskey&#39;</span><span class="p">,</span>
      <span class="s">&#39;action&#39;</span><span class="p">,</span> <span class="s">&#39;align&#39;</span><span class="p">,</span> <span class="s">&#39;alt&#39;</span><span class="p">,</span> <span class="s">&#39;axis&#39;</span><span class="p">,</span> <span class="s">&#39;border&#39;</span><span class="p">,</span> <span class="s">&#39;cellpadding&#39;</span><span class="p">,</span> <span class="s">&#39;cellspacing&#39;</span><span class="p">,</span>
      <span class="s">&#39;char&#39;</span><span class="p">,</span> <span class="s">&#39;charoff&#39;</span><span class="p">,</span> <span class="s">&#39;charset&#39;</span><span class="p">,</span> <span class="s">&#39;checked&#39;</span><span class="p">,</span> <span class="s">&#39;cite&#39;</span><span class="p">,</span> <span class="s">&#39;class&#39;</span><span class="p">,</span> <span class="s">&#39;clear&#39;</span><span class="p">,</span> <span class="s">&#39;cols&#39;</span><span class="p">,</span>
      <span class="s">&#39;colspan&#39;</span><span class="p">,</span> <span class="s">&#39;color&#39;</span><span class="p">,</span> <span class="s">&#39;compact&#39;</span><span class="p">,</span> <span class="s">&#39;coords&#39;</span><span class="p">,</span> <span class="s">&#39;datetime&#39;</span><span class="p">,</span> <span class="s">&#39;dir&#39;</span><span class="p">,</span> <span class="s">&#39;disabled&#39;</span><span class="p">,</span>
      <span class="s">&#39;enctype&#39;</span><span class="p">,</span> <span class="s">&#39;for&#39;</span><span class="p">,</span> <span class="s">&#39;frame&#39;</span><span class="p">,</span> <span class="s">&#39;headers&#39;</span><span class="p">,</span> <span class="s">&#39;height&#39;</span><span class="p">,</span> <span class="s">&#39;href&#39;</span><span class="p">,</span> <span class="s">&#39;hreflang&#39;</span><span class="p">,</span> <span class="s">&#39;hspace&#39;</span><span class="p">,</span>
      <span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="s">&#39;ismap&#39;</span><span class="p">,</span> <span class="s">&#39;label&#39;</span><span class="p">,</span> <span class="s">&#39;lang&#39;</span><span class="p">,</span> <span class="s">&#39;longdesc&#39;</span><span class="p">,</span> <span class="s">&#39;maxlength&#39;</span><span class="p">,</span> <span class="s">&#39;media&#39;</span><span class="p">,</span> <span class="s">&#39;method&#39;</span><span class="p">,</span>
      <span class="s">&#39;multiple&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;nohref&#39;</span><span class="p">,</span> <span class="s">&#39;noshade&#39;</span><span class="p">,</span> <span class="s">&#39;nowrap&#39;</span><span class="p">,</span> <span class="s">&#39;prompt&#39;</span><span class="p">,</span> <span class="s">&#39;readonly&#39;</span><span class="p">,</span>
      <span class="s">&#39;rel&#39;</span><span class="p">,</span> <span class="s">&#39;rev&#39;</span><span class="p">,</span> <span class="s">&#39;rows&#39;</span><span class="p">,</span> <span class="s">&#39;rowspan&#39;</span><span class="p">,</span> <span class="s">&#39;rules&#39;</span><span class="p">,</span> <span class="s">&#39;scope&#39;</span><span class="p">,</span> <span class="s">&#39;selected&#39;</span><span class="p">,</span> <span class="s">&#39;shape&#39;</span><span class="p">,</span> <span class="s">&#39;size&#39;</span><span class="p">,</span>
      <span class="s">&#39;span&#39;</span><span class="p">,</span> <span class="s">&#39;src&#39;</span><span class="p">,</span> <span class="s">&#39;start&#39;</span><span class="p">,</span> <span class="s">&#39;summary&#39;</span><span class="p">,</span> <span class="s">&#39;tabindex&#39;</span><span class="p">,</span> <span class="s">&#39;target&#39;</span><span class="p">,</span> <span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="s">&#39;type&#39;</span><span class="p">,</span>
      <span class="s">&#39;usemap&#39;</span><span class="p">,</span> <span class="s">&#39;valign&#39;</span><span class="p">,</span> <span class="s">&#39;value&#39;</span><span class="p">,</span> <span class="s">&#39;vspace&#39;</span><span class="p">,</span> <span class="s">&#39;width&#39;</span><span class="p">]</span>

    <span class="n">unacceptable_elements_with_end_tag</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;script&#39;</span><span class="p">,</span> <span class="s">&#39;applet&#39;</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-227'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-227'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">_BaseHTMLProcessor</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unacceptablestack</span> <span class="o">=</span> <span class="mi">0</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-228'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-228'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">unknown_starttag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">acceptable_elements</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unacceptable_elements_with_end_tag</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">unacceptablestack</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalize_attrs</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">attrs</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">acceptable_attributes</span><span class="p">]</span>
        <span class="n">_BaseHTMLProcessor</span><span class="o">.</span><span class="n">unknown_starttag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-229'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-229'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">unknown_endtag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">acceptable_elements</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unacceptable_elements_with_end_tag</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">unacceptablestack</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">return</span>
        <span class="n">_BaseHTMLProcessor</span><span class="o">.</span><span class="n">unknown_endtag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-230'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-230'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">handle_pi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="k">pass</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-231'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-231'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">handle_decl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="k">pass</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-232'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-232'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">handle_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">unacceptablestack</span><span class="p">:</span>
            <span class="n">_BaseHTMLProcessor</span><span class="o">.</span><span class="n">handle_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-233'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-233'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">_sanitizeHTML</span><span class="p">(</span><span class="n">htmlSource</span><span class="p">,</span> <span class="n">encoding</span><span class="p">):</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">_HTMLSanitizer</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">feed</span><span class="p">(</span><span class="n">htmlSource</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">output</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">TIDY_MARKUP</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-234'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-234'>#</a>
      </div>
      <p>loop through list of preferred Tidy interfaces looking for one that's installed,
then set up a common _tidy function to wrap the interface-specific API.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">_tidy</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">for</span> <span class="n">tidy_interface</span> <span class="ow">in</span> <span class="n">PREFERRED_TIDY_INTERFACES</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">tidy_interface</span> <span class="o">==</span> <span class="s">&quot;uTidy&quot;</span><span class="p">:</span>
                    <span class="kn">from</span> <span class="nn">tidy</span> <span class="kn">import</span> <span class="n">parseString</span> <span class="k">as</span> <span class="n">_utidy</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-235'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-235'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>                    <span class="k">def</span> <span class="nf">_tidy</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">_utidy</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
                    <span class="k">break</span>
                <span class="k">elif</span> <span class="n">tidy_interface</span> <span class="o">==</span> <span class="s">&quot;mxTidy&quot;</span><span class="p">:</span>
                    <span class="kn">from</span> <span class="nn">mx.Tidy</span> <span class="kn">import</span> <span class="n">Tidy</span> <span class="k">as</span> <span class="n">_mxtidy</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-236'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-236'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>                    <span class="k">def</span> <span class="nf">_tidy</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                        <span class="n">nerrors</span><span class="p">,</span> <span class="n">nwarnings</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">errordata</span> <span class="o">=</span> <span class="n">_mxtidy</span><span class="o">.</span><span class="n">tidy</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                        <span class="k">return</span> <span class="n">data</span>
                    <span class="k">break</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">if</span> <span class="n">_tidy</span><span class="p">:</span>
            <span class="n">utf8</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="s">u&#39;&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">utf8</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">_tidy</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">output_xhtml</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">numeric_entities</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">wrap</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">char_encoding</span><span class="o">=</span><span class="s">&quot;utf8&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">utf8</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&#39;&lt;body&#39;</span><span class="p">):</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;&lt;body&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&#39;&gt;&#39;</span><span class="p">):</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&#39;&lt;/body&#39;</span><span class="p">):</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;&lt;/body&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-237'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-237'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">_FeedURLHandler</span><span class="p">(</span><span class="n">urllib2</span><span class="o">.</span><span class="n">HTTPDigestAuthHandler</span><span class="p">,</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">HTTPRedirectHandler</span><span class="p">,</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">HTTPDefaultErrorHandler</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-238'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-238'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">http_error_default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">headers</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">code</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">code</span> <span class="o">!=</span> <span class="mi">304</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">http_error_302</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>
        <span class="n">infourl</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">addinfourl</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">req</span><span class="o">.</span><span class="n">get_full_url</span><span class="p">())</span>
        <span class="n">infourl</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">code</span>
        <span class="k">return</span> <span class="n">infourl</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-239'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-239'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">http_error_302</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">headers</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">headers</span><span class="o">.</span><span class="n">dict</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;location&#39;</span><span class="p">):</span>
            <span class="n">infourl</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">HTTPRedirectHandler</span><span class="o">.</span><span class="n">http_error_302</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">infourl</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">addinfourl</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">req</span><span class="o">.</span><span class="n">get_full_url</span><span class="p">())</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">infourl</span><span class="p">,</span> <span class="s">&#39;status&#39;</span><span class="p">):</span>
            <span class="n">infourl</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">code</span>
        <span class="k">return</span> <span class="n">infourl</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-240'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-240'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">http_error_301</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">headers</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">headers</span><span class="o">.</span><span class="n">dict</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;location&#39;</span><span class="p">):</span>
            <span class="n">infourl</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">HTTPRedirectHandler</span><span class="o">.</span><span class="n">http_error_301</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">infourl</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">addinfourl</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">req</span><span class="o">.</span><span class="n">get_full_url</span><span class="p">())</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">infourl</span><span class="p">,</span> <span class="s">&#39;status&#39;</span><span class="p">):</span>
            <span class="n">infourl</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">code</span>
        <span class="k">return</span> <span class="n">infourl</span>

    <span class="n">http_error_300</span> <span class="o">=</span> <span class="n">http_error_302</span>
    <span class="n">http_error_303</span> <span class="o">=</span> <span class="n">http_error_302</span>
    <span class="n">http_error_307</span> <span class="o">=</span> <span class="n">http_error_302</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-241'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-241'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">http_error_401</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">headers</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-242'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-242'>#</a>
      </div>
      <p>Check if
- server requires digest auth, AND
- we tried (unsuccessfully) with basic auth, AND
- we're using Python 2.3.3 or later (digest auth is irreparably broken in earlier versions)
If all conditions hold, parse authentication information
out of the Authorization header we sent the first time
(for the username and password) and the WWW-Authenticate
header the server sent back (for the realm) and retry
the request with the appropriate digest auth headers instead.
This evil genius hack has been brought to you by Aaron Swartz.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">host</span> <span class="o">=</span> <span class="n">urlparse</span><span class="o">.</span><span class="n">urlparse</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">get_full_url</span><span class="p">())[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="s">&#39;2.3.3&#39;</span>
            <span class="k">assert</span> <span class="n">base64</span> <span class="o">!=</span> <span class="bp">None</span>
            <span class="n">user</span><span class="p">,</span> <span class="n">passw</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">decodestring</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s">&#39;Authorization&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span>
            <span class="n">realm</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">&#39;realm=&quot;([^&quot;]*)&quot;&#39;</span><span class="p">,</span> <span class="n">headers</span><span class="p">[</span><span class="s">&#39;WWW-Authenticate&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_password</span><span class="p">(</span><span class="n">realm</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">passw</span><span class="p">)</span>
            <span class="n">retry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">http_error_auth_reqed</span><span class="p">(</span><span class="s">&#39;www-authenticate&#39;</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reset_retry_count</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">retry</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">http_error_default</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-243'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-243'>#</a>
      </div>
      <p>URL, filename, or string --&gt; stream</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">_open_resource</span><span class="p">(</span><span class="n">url_file_stream_or_string</span><span class="p">,</span> <span class="n">etag</span><span class="p">,</span> <span class="n">modified</span><span class="p">,</span> <span class="n">agent</span><span class="p">,</span> <span class="n">referrer</span><span class="p">,</span> <span class="n">handlers</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-244'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-244'>#</a>
      </div>
      <p>This function lets you define parsers that take any input source
(URL, pathname to local or network file, or actual data as a string)
and deal with it in a uniform manner.  Returned object is guaranteed
to have all the basic stdio read methods (read, readline, readlines).
Just .close() the object when you're done with it.</p>
<p>If the etag argument is supplied, it will be used as the value of an
If-None-Match request header.</p>
<p>If the modified argument is supplied, it must be a tuple of 9 integers
as returned by gmtime() in the standard Python time module. This MUST
be in GMT (Greenwich Mean Time). The formatted date/time will be used
as the value of an If-Modified-Since request header.</p>
<p>If the agent argument is supplied, it will be used as the value of a
User-Agent request header.</p>
<p>If the referrer argument is supplied, it will be used as the value of a
Referer[sic] request header.</p>
<p>If handlers is supplied, it is a list of handlers used to build a
urllib2 opener.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">url_file_stream_or_string</span><span class="p">,</span> <span class="s">&#39;read&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">url_file_stream_or_string</span>

    <span class="k">if</span> <span class="n">url_file_stream_or_string</span> <span class="o">==</span> <span class="s">&#39;-&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span>

    <span class="k">if</span> <span class="n">urlparse</span><span class="o">.</span><span class="n">urlparse</span><span class="p">(</span><span class="n">url_file_stream_or_string</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;http&#39;</span><span class="p">,</span> <span class="s">&#39;https&#39;</span><span class="p">,</span> <span class="s">&#39;ftp&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">agent</span><span class="p">:</span>
            <span class="n">agent</span> <span class="o">=</span> <span class="n">USER_AGENT</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-245'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-245'>#</a>
      </div>
      <p>test for inline user:password for basic auth</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">auth</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">base64</span><span class="p">:</span>
            <span class="n">urltype</span><span class="p">,</span> <span class="n">rest</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">splittype</span><span class="p">(</span><span class="n">url_file_stream_or_string</span><span class="p">)</span>
            <span class="n">realhost</span><span class="p">,</span> <span class="n">rest</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">splithost</span><span class="p">(</span><span class="n">rest</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">realhost</span><span class="p">:</span>
                <span class="n">user_passwd</span><span class="p">,</span> <span class="n">realhost</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">splituser</span><span class="p">(</span><span class="n">realhost</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">user_passwd</span><span class="p">:</span>
                    <span class="n">url_file_stream_or_string</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">://</span><span class="si">%s%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">urltype</span><span class="p">,</span> <span class="n">realhost</span><span class="p">,</span> <span class="n">rest</span><span class="p">)</span>
                    <span class="n">auth</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">encodestring</span><span class="p">(</span><span class="n">user_passwd</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-246'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-246'>#</a>
      </div>
      <p>try to open with urllib2 (to use optional headers)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">request</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url_file_stream_or_string</span><span class="p">)</span>
        <span class="n">request</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">&#39;User-Agent&#39;</span><span class="p">,</span> <span class="n">agent</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">etag</span><span class="p">:</span>
            <span class="n">request</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">&#39;If-None-Match&#39;</span><span class="p">,</span> <span class="n">etag</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">modified</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-247'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-247'>#</a>
      </div>
      <p>format into an RFC 1123-compliant timestamp. We can't use
time.strftime() since the %a and %b directives can be affected
by the current locale, but RFC 2616 states that dates must be
in English.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">short_weekdays</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Mon&#39;</span><span class="p">,</span> <span class="s">&#39;Tue&#39;</span><span class="p">,</span> <span class="s">&#39;Wed&#39;</span><span class="p">,</span> <span class="s">&#39;Thu&#39;</span><span class="p">,</span> <span class="s">&#39;Fri&#39;</span><span class="p">,</span> <span class="s">&#39;Sat&#39;</span><span class="p">,</span> <span class="s">&#39;Sun&#39;</span><span class="p">]</span>
            <span class="n">months</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Jan&#39;</span><span class="p">,</span> <span class="s">&#39;Feb&#39;</span><span class="p">,</span> <span class="s">&#39;Mar&#39;</span><span class="p">,</span> <span class="s">&#39;Apr&#39;</span><span class="p">,</span> <span class="s">&#39;May&#39;</span><span class="p">,</span> <span class="s">&#39;Jun&#39;</span><span class="p">,</span> <span class="s">&#39;Jul&#39;</span><span class="p">,</span> <span class="s">&#39;Aug&#39;</span><span class="p">,</span> <span class="s">&#39;Sep&#39;</span><span class="p">,</span> <span class="s">&#39;Oct&#39;</span><span class="p">,</span> <span class="s">&#39;Nov&#39;</span><span class="p">,</span> <span class="s">&#39;Dec&#39;</span><span class="p">]</span>
            <span class="n">request</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">&#39;If-Modified-Since&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">, </span><span class="si">%02d</span><span class="s"> </span><span class="si">%s</span><span class="s"> </span><span class="si">%04d</span><span class="s"> </span><span class="si">%02d</span><span class="s">:</span><span class="si">%02d</span><span class="s">:</span><span class="si">%02d</span><span class="s"> GMT&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">short_weekdays</span><span class="p">[</span><span class="n">modified</span><span class="p">[</span><span class="mi">6</span><span class="p">]],</span> <span class="n">modified</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">months</span><span class="p">[</span><span class="n">modified</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">modified</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">modified</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">modified</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">modified</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">referrer</span><span class="p">:</span>
            <span class="n">request</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">&#39;Referer&#39;</span><span class="p">,</span> <span class="n">referrer</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">gzip</span> <span class="ow">and</span> <span class="n">zlib</span><span class="p">:</span>
            <span class="n">request</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">&#39;Accept-encoding&#39;</span><span class="p">,</span> <span class="s">&#39;gzip, deflate&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">gzip</span><span class="p">:</span>
            <span class="n">request</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">&#39;Accept-encoding&#39;</span><span class="p">,</span> <span class="s">&#39;gzip&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">zlib</span><span class="p">:</span>
            <span class="n">request</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">&#39;Accept-encoding&#39;</span><span class="p">,</span> <span class="s">&#39;deflate&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">request</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">&#39;Accept-encoding&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">auth</span><span class="p">:</span>
            <span class="n">request</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">&#39;Authorization&#39;</span><span class="p">,</span> <span class="s">&#39;Basic </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">auth</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ACCEPT_HEADER</span><span class="p">:</span>
            <span class="n">request</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">&#39;Accept&#39;</span><span class="p">,</span> <span class="n">ACCEPT_HEADER</span><span class="p">)</span>
        <span class="n">request</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">&#39;A-IM&#39;</span><span class="p">,</span> <span class="s">&#39;feed&#39;</span><span class="p">)</span> <span class="c"># RFC 3229 support</span>
        <span class="n">opener</span> <span class="o">=</span> <span class="nb">apply</span><span class="p">(</span><span class="n">urllib2</span><span class="o">.</span><span class="n">build_opener</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">_FeedURLHandler</span><span class="p">()]</span> <span class="o">+</span> <span class="n">handlers</span><span class="p">))</span>
        <span class="n">opener</span><span class="o">.</span><span class="n">addheaders</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># RMK - must clear so we only send our custom User-Agent</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">opener</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">opener</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> <span class="c"># JohnD</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-248'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-248'>#</a>
      </div>
      <p>try to open with native open function (if url_file_stream_or_string is a filename)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">open</span><span class="p">(</span><span class="n">url_file_stream_or_string</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-249'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-249'>#</a>
      </div>
      <p>treat url_file_stream_or_string as string</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">return</span> <span class="n">_StringIO</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">url_file_stream_or_string</span><span class="p">))</span>

<span class="n">_date_handlers</span> <span class="o">=</span> <span class="p">[]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-250'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-250'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">registerDateHandler</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Register a date handler function (takes string, returns 9-tuple date in GMT)&#39;&#39;&#39;</span>
    <span class="n">_date_handlers</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-251'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-251'>#</a>
      </div>
      <p>ISO-8601 date parsing routines written by Fazal Majid.
The ISO 8601 standard is very convoluted and irregular - a full ISO 8601
parser is beyond the scope of feedparser and would be a worthwhile addition
to the Python library.
A single regular expression cannot parse ISO 8601 date formats into groups
as the standard is highly irregular (for instance is 030104 2003-01-04 or
0301-04-01), so we use templates instead.
Please note the order in templates is significant because we need a
greedy match.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="n">_iso8601_tmpl</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;YYYY-?MM-?DD&#39;</span><span class="p">,</span> <span class="s">&#39;YYYY-MM&#39;</span><span class="p">,</span> <span class="s">&#39;YYYY-?OOO&#39;</span><span class="p">,</span>
                <span class="s">&#39;YY-?MM-?DD&#39;</span><span class="p">,</span> <span class="s">&#39;YY-?OOO&#39;</span><span class="p">,</span> <span class="s">&#39;YYYY&#39;</span><span class="p">,</span> 
                <span class="s">&#39;-YY-?MM&#39;</span><span class="p">,</span> <span class="s">&#39;-OOO&#39;</span><span class="p">,</span> <span class="s">&#39;-YY&#39;</span><span class="p">,</span>
                <span class="s">&#39;--MM-?DD&#39;</span><span class="p">,</span> <span class="s">&#39;--MM&#39;</span><span class="p">,</span>
                <span class="s">&#39;---DD&#39;</span><span class="p">,</span>
                <span class="s">&#39;CC&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">]</span>
<span class="n">_iso8601_re</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">tmpl</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
    <span class="s">&#39;YYYY&#39;</span><span class="p">,</span> <span class="s">r&#39;(?P&lt;year&gt;\d{4})&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
    <span class="s">&#39;YY&#39;</span><span class="p">,</span> <span class="s">r&#39;(?P&lt;year&gt;\d\d)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
    <span class="s">&#39;MM&#39;</span><span class="p">,</span> <span class="s">r&#39;(?P&lt;month&gt;[01]\d)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
    <span class="s">&#39;DD&#39;</span><span class="p">,</span> <span class="s">r&#39;(?P&lt;day&gt;[0123]\d)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
    <span class="s">&#39;OOO&#39;</span><span class="p">,</span> <span class="s">r&#39;(?P&lt;ordinal&gt;[0123]\d\d)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
    <span class="s">&#39;CC&#39;</span><span class="p">,</span> <span class="s">r&#39;(?P&lt;century&gt;\d\d$)&#39;</span><span class="p">)</span>
    <span class="o">+</span> <span class="s">r&#39;(T?(?P&lt;hour&gt;\d{2}):(?P&lt;minute&gt;\d{2})&#39;</span>
    <span class="o">+</span> <span class="s">r&#39;(:(?P&lt;second&gt;\d{2}))?&#39;</span>
    <span class="o">+</span> <span class="s">r&#39;(?P&lt;tz&gt;[+-](?P&lt;tzhour&gt;\d{2})(:(?P&lt;tzmin&gt;\d{2}))?|Z)?)?&#39;</span>
    <span class="k">for</span> <span class="n">tmpl</span> <span class="ow">in</span> <span class="n">_iso8601_tmpl</span><span class="p">]</span>
<span class="k">del</span> <span class="n">tmpl</span>
<span class="n">_iso8601_matches</span> <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">regex</span><span class="p">)</span><span class="o">.</span><span class="n">match</span> <span class="k">for</span> <span class="n">regex</span> <span class="ow">in</span> <span class="n">_iso8601_re</span><span class="p">]</span>
<span class="k">del</span> <span class="n">regex</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-252'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-252'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">_parse_date_iso8601</span><span class="p">(</span><span class="n">dateString</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Parse a variety of ISO-8601-compatible formats like 20040105&#39;&#39;&#39;</span>
    <span class="n">m</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">for</span> <span class="n">_iso8601_match</span> <span class="ow">in</span> <span class="n">_iso8601_matches</span><span class="p">:</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">_iso8601_match</span><span class="p">(</span><span class="n">dateString</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">m</span><span class="p">:</span> <span class="k">break</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="p">:</span> <span class="k">return</span>
    <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">span</span><span class="p">()</span> <span class="o">==</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="k">return</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">groupdict</span><span class="p">()</span>
    <span class="n">ordinal</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;ordinal&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ordinal</span><span class="p">:</span>
        <span class="n">ordinal</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ordinal</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ordinal</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">year</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;year&#39;</span><span class="p">,</span> <span class="s">&#39;--&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">year</span> <span class="ow">or</span> <span class="n">year</span> <span class="o">==</span> <span class="s">&#39;--&#39;</span><span class="p">:</span>
        <span class="n">year</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">gmtime</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-253'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-253'>#</a>
      </div>
      <p>ISO 8601 assumes current century, i.e. 93 -&gt; 2093, NOT 1993</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">year</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">gmtime</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
    <span class="n">month</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;month&#39;</span><span class="p">,</span> <span class="s">&#39;-&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">month</span> <span class="ow">or</span> <span class="n">month</span> <span class="o">==</span> <span class="s">&#39;-&#39;</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-254'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-254'>#</a>
      </div>
      <p>ordinals are NOT normalized by mktime, we simulate them
by setting month=1, day=ordinal</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">ordinal</span><span class="p">:</span>
            <span class="n">month</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">month</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">gmtime</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">month</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">month</span><span class="p">)</span>
    <span class="n">day</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;day&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">day</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-255'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-255'>#</a>
      </div>
      <p>see above</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">ordinal</span><span class="p">:</span>
            <span class="n">day</span> <span class="o">=</span> <span class="n">ordinal</span>
        <span class="k">elif</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;century&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> \
                 <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;year&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;month&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">day</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">day</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">gmtime</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">day</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">day</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-256'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-256'>#</a>
      </div>
      <p>special case of the century - is the first year of the 21st century
2000 or 2001 ? The debate goes on...</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="s">&#39;century&#39;</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">year</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s">&#39;century&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="mi">1</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-257'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-257'>#</a>
      </div>
      <p>in ISO 8601 most fields are optional</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;hour&#39;</span><span class="p">,</span> <span class="s">&#39;minute&#39;</span><span class="p">,</span> <span class="s">&#39;second&#39;</span><span class="p">,</span> <span class="s">&#39;tzhour&#39;</span><span class="p">,</span> <span class="s">&#39;tzmin&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">params</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">hour</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;hour&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">minute</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;minute&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">second</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;second&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-258'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-258'>#</a>
      </div>
      <p>weekday is normalized by mktime(), we can ignore it</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">weekday</span> <span class="o">=</span> <span class="mi">0</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-259'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-259'>#</a>
      </div>
      <p>daylight savings is complex, but not needed for feedparser's purposes
as time zones, if specified, include mention of whether it is active
(e.g. PST vs. PDT, CET). Using -1 is implementation-dependent and
and most implementations have DST bugs</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">daylight_savings_flag</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">tm</span> <span class="o">=</span> <span class="p">[</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">hour</span><span class="p">,</span> <span class="n">minute</span><span class="p">,</span> <span class="n">second</span><span class="p">,</span> <span class="n">weekday</span><span class="p">,</span>
          <span class="n">ordinal</span><span class="p">,</span> <span class="n">daylight_savings_flag</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-260'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-260'>#</a>
      </div>
      <p>ISO 8601 time zone adjustments</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">tz</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;tz&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tz</span> <span class="ow">and</span> <span class="n">tz</span> <span class="o">!=</span> <span class="s">&#39;Z&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">tz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;-&#39;</span><span class="p">:</span>
            <span class="n">tm</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;tzhour&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="n">tm</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;tzmin&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">tz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;+&#39;</span><span class="p">:</span>
            <span class="n">tm</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;tzhour&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="n">tm</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">-=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;tzmin&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-261'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-261'>#</a>
      </div>
      <p>Python's time.mktime() is a wrapper around the ANSI C mktime(3c)
which is guaranteed to normalize d/m/y/h/m/s.
Many implementations have bugs, but we'll pretend they don't.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">mktime</span><span class="p">(</span><span class="n">tm</span><span class="p">))</span>
<span class="n">registerDateHandler</span><span class="p">(</span><span class="n">_parse_date_iso8601</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-262'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-262'>#</a>
      </div>
      <p>8-bit date handling routines written by ytrewq1.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="n">_korean_year</span>  <span class="o">=</span> <span class="s">u&#39;</span><span class="se">\ub144</span><span class="s">&#39;</span> <span class="c"># b3e2 in euc-kr</span>
<span class="n">_korean_month</span> <span class="o">=</span> <span class="s">u&#39;</span><span class="se">\uc6d4</span><span class="s">&#39;</span> <span class="c"># bff9 in euc-kr</span>
<span class="n">_korean_day</span>   <span class="o">=</span> <span class="s">u&#39;</span><span class="se">\uc77c</span><span class="s">&#39;</span> <span class="c"># c0cf in euc-kr</span>
<span class="n">_korean_am</span>    <span class="o">=</span> <span class="s">u&#39;</span><span class="se">\uc624\uc804</span><span class="s">&#39;</span> <span class="c"># bfc0 c0fc in euc-kr</span>
<span class="n">_korean_pm</span>    <span class="o">=</span> <span class="s">u&#39;</span><span class="se">\uc624\ud6c4</span><span class="s">&#39;</span> <span class="c"># bfc0 c8c4 in euc-kr</span>

<span class="n">_korean_onblog_date_re</span> <span class="o">=</span> \
    <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&#39;(\d{4})</span><span class="si">%s</span><span class="s">\s+(\d{2})</span><span class="si">%s</span><span class="s">\s+(\d{2})</span><span class="si">%s</span><span class="s">\s+(\d{2}):(\d{2}):(\d{2})&#39;</span> <span class="o">%</span> \
               <span class="p">(</span><span class="n">_korean_year</span><span class="p">,</span> <span class="n">_korean_month</span><span class="p">,</span> <span class="n">_korean_day</span><span class="p">))</span>
<span class="n">_korean_nate_date_re</span> <span class="o">=</span> \
    <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">u&#39;(\d{4})-(\d{2})-(\d{2})\s+(</span><span class="si">%s</span><span class="s">|</span><span class="si">%s</span><span class="s">)\s+(\d{,2}):(\d{,2}):(\d{,2})&#39;</span> <span class="o">%</span> \
               <span class="p">(</span><span class="n">_korean_am</span><span class="p">,</span> <span class="n">_korean_pm</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-263'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-263'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">_parse_date_onblog</span><span class="p">(</span><span class="n">dateString</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Parse a string according to the OnBlog 8-bit date format&#39;&#39;&#39;</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">_korean_onblog_date_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">dateString</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="p">:</span> <span class="k">return</span>
    <span class="n">w3dtfdate</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%(year)s</span><span class="s">-</span><span class="si">%(month)s</span><span class="s">-</span><span class="si">%(day)s</span><span class="s">T</span><span class="si">%(hour)s</span><span class="s">:</span><span class="si">%(minute)s</span><span class="s">:</span><span class="si">%(second)s%(zonediff)s</span><span class="s">&#39;</span> <span class="o">%</span> \
                <span class="p">{</span><span class="s">&#39;year&#39;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="s">&#39;month&#39;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="s">&#39;day&#39;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>\
                 <span class="s">&#39;hour&#39;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="s">&#39;minute&#39;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="s">&#39;second&#39;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span>\
                 <span class="s">&#39;zonediff&#39;</span><span class="p">:</span> <span class="s">&#39;+09:00&#39;</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">_debug</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;OnBlog date parsed as: </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">w3dtfdate</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_parse_date_w3dtf</span><span class="p">(</span><span class="n">w3dtfdate</span><span class="p">)</span>
<span class="n">registerDateHandler</span><span class="p">(</span><span class="n">_parse_date_onblog</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-264'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-264'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">_parse_date_nate</span><span class="p">(</span><span class="n">dateString</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Parse a string according to the Nate 8-bit date format&#39;&#39;&#39;</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">_korean_nate_date_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">dateString</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="p">:</span> <span class="k">return</span>
    <span class="n">hour</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
    <span class="n">ampm</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ampm</span> <span class="o">==</span> <span class="n">_korean_pm</span><span class="p">):</span>
        <span class="n">hour</span> <span class="o">+=</span> <span class="mi">12</span>
    <span class="n">hour</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">hour</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hour</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">hour</span> <span class="o">=</span> <span class="s">&#39;0&#39;</span> <span class="o">+</span> <span class="n">hour</span>
    <span class="n">w3dtfdate</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%(year)s</span><span class="s">-</span><span class="si">%(month)s</span><span class="s">-</span><span class="si">%(day)s</span><span class="s">T</span><span class="si">%(hour)s</span><span class="s">:</span><span class="si">%(minute)s</span><span class="s">:</span><span class="si">%(second)s%(zonediff)s</span><span class="s">&#39;</span> <span class="o">%</span> \
                <span class="p">{</span><span class="s">&#39;year&#39;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="s">&#39;month&#39;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="s">&#39;day&#39;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>\
                 <span class="s">&#39;hour&#39;</span><span class="p">:</span> <span class="n">hour</span><span class="p">,</span> <span class="s">&#39;minute&#39;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="s">&#39;second&#39;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span>\
                 <span class="s">&#39;zonediff&#39;</span><span class="p">:</span> <span class="s">&#39;+09:00&#39;</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">_debug</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Nate date parsed as: </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">w3dtfdate</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_parse_date_w3dtf</span><span class="p">(</span><span class="n">w3dtfdate</span><span class="p">)</span>
<span class="n">registerDateHandler</span><span class="p">(</span><span class="n">_parse_date_nate</span><span class="p">)</span>

<span class="n">_mssql_date_re</span> <span class="o">=</span> \
    <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&#39;(\d{4})-(\d{2})-(\d{2})\s+(\d{2}):(\d{2}):(\d{2})(\.\d+)?&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-265'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-265'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">_parse_date_mssql</span><span class="p">(</span><span class="n">dateString</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Parse a string according to the MS SQL date format&#39;&#39;&#39;</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">_mssql_date_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">dateString</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="p">:</span> <span class="k">return</span>
    <span class="n">w3dtfdate</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%(year)s</span><span class="s">-</span><span class="si">%(month)s</span><span class="s">-</span><span class="si">%(day)s</span><span class="s">T</span><span class="si">%(hour)s</span><span class="s">:</span><span class="si">%(minute)s</span><span class="s">:</span><span class="si">%(second)s%(zonediff)s</span><span class="s">&#39;</span> <span class="o">%</span> \
                <span class="p">{</span><span class="s">&#39;year&#39;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="s">&#39;month&#39;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="s">&#39;day&#39;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>\
                 <span class="s">&#39;hour&#39;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="s">&#39;minute&#39;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="s">&#39;second&#39;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span>\
                 <span class="s">&#39;zonediff&#39;</span><span class="p">:</span> <span class="s">&#39;+09:00&#39;</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">_debug</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;MS SQL date parsed as: </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">w3dtfdate</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_parse_date_w3dtf</span><span class="p">(</span><span class="n">w3dtfdate</span><span class="p">)</span>
<span class="n">registerDateHandler</span><span class="p">(</span><span class="n">_parse_date_mssql</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-266'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-266'>#</a>
      </div>
      <p>Unicode strings for Greek date strings</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="n">_greek_months</span> <span class="o">=</span> \
  <span class="p">{</span> \
   <span class="s">u&#39;</span><span class="se">\u0399\u03b1\u03bd</span><span class="s">&#39;</span><span class="p">:</span> <span class="s">u&#39;Jan&#39;</span><span class="p">,</span>       <span class="c"># c9e1ed in iso-8859-7</span>
   <span class="s">u&#39;</span><span class="se">\u03a6\u03b5\u03b2</span><span class="s">&#39;</span><span class="p">:</span> <span class="s">u&#39;Feb&#39;</span><span class="p">,</span>       <span class="c"># d6e5e2 in iso-8859-7</span>
   <span class="s">u&#39;</span><span class="se">\u039c\u03ac\u03ce</span><span class="s">&#39;</span><span class="p">:</span> <span class="s">u&#39;Mar&#39;</span><span class="p">,</span>       <span class="c"># ccdcfe in iso-8859-7</span>
   <span class="s">u&#39;</span><span class="se">\u039c\u03b1\u03ce</span><span class="s">&#39;</span><span class="p">:</span> <span class="s">u&#39;Mar&#39;</span><span class="p">,</span>       <span class="c"># cce1fe in iso-8859-7</span>
   <span class="s">u&#39;</span><span class="se">\u0391\u03c0\u03c1</span><span class="s">&#39;</span><span class="p">:</span> <span class="s">u&#39;Apr&#39;</span><span class="p">,</span>       <span class="c"># c1f0f1 in iso-8859-7</span>
   <span class="s">u&#39;</span><span class="se">\u039c\u03ac\u03b9</span><span class="s">&#39;</span><span class="p">:</span> <span class="s">u&#39;May&#39;</span><span class="p">,</span>       <span class="c"># ccdce9 in iso-8859-7</span>
   <span class="s">u&#39;</span><span class="se">\u039c\u03b1\u03ca</span><span class="s">&#39;</span><span class="p">:</span> <span class="s">u&#39;May&#39;</span><span class="p">,</span>       <span class="c"># cce1fa in iso-8859-7</span>
   <span class="s">u&#39;</span><span class="se">\u039c\u03b1\u03b9</span><span class="s">&#39;</span><span class="p">:</span> <span class="s">u&#39;May&#39;</span><span class="p">,</span>       <span class="c"># cce1e9 in iso-8859-7</span>
   <span class="s">u&#39;</span><span class="se">\u0399\u03bf\u03cd\u03bd</span><span class="s">&#39;</span><span class="p">:</span> <span class="s">u&#39;Jun&#39;</span><span class="p">,</span> <span class="c"># c9effded in iso-8859-7</span>
   <span class="s">u&#39;</span><span class="se">\u0399\u03bf\u03bd</span><span class="s">&#39;</span><span class="p">:</span> <span class="s">u&#39;Jun&#39;</span><span class="p">,</span>       <span class="c"># c9efed in iso-8859-7</span>
   <span class="s">u&#39;</span><span class="se">\u0399\u03bf\u03cd\u03bb</span><span class="s">&#39;</span><span class="p">:</span> <span class="s">u&#39;Jul&#39;</span><span class="p">,</span> <span class="c"># c9effdeb in iso-8859-7</span>
   <span class="s">u&#39;</span><span class="se">\u0399\u03bf\u03bb</span><span class="s">&#39;</span><span class="p">:</span> <span class="s">u&#39;Jul&#39;</span><span class="p">,</span>       <span class="c"># c9f9eb in iso-8859-7</span>
   <span class="s">u&#39;</span><span class="se">\u0391\u03cd\u03b3</span><span class="s">&#39;</span><span class="p">:</span> <span class="s">u&#39;Aug&#39;</span><span class="p">,</span>       <span class="c"># c1fde3 in iso-8859-7</span>
   <span class="s">u&#39;</span><span class="se">\u0391\u03c5\u03b3</span><span class="s">&#39;</span><span class="p">:</span> <span class="s">u&#39;Aug&#39;</span><span class="p">,</span>       <span class="c"># c1f5e3 in iso-8859-7</span>
   <span class="s">u&#39;</span><span class="se">\u03a3\u03b5\u03c0</span><span class="s">&#39;</span><span class="p">:</span> <span class="s">u&#39;Sep&#39;</span><span class="p">,</span>       <span class="c"># d3e5f0 in iso-8859-7</span>
   <span class="s">u&#39;</span><span class="se">\u039f\u03ba\u03c4</span><span class="s">&#39;</span><span class="p">:</span> <span class="s">u&#39;Oct&#39;</span><span class="p">,</span>       <span class="c"># cfeaf4 in iso-8859-7</span>
   <span class="s">u&#39;</span><span class="se">\u039d\u03bf\u03ad</span><span class="s">&#39;</span><span class="p">:</span> <span class="s">u&#39;Nov&#39;</span><span class="p">,</span>       <span class="c"># cdefdd in iso-8859-7</span>
   <span class="s">u&#39;</span><span class="se">\u039d\u03bf\u03b5</span><span class="s">&#39;</span><span class="p">:</span> <span class="s">u&#39;Nov&#39;</span><span class="p">,</span>       <span class="c"># cdefe5 in iso-8859-7</span>
   <span class="s">u&#39;</span><span class="se">\u0394\u03b5\u03ba</span><span class="s">&#39;</span><span class="p">:</span> <span class="s">u&#39;Dec&#39;</span><span class="p">,</span>       <span class="c"># c4e5ea in iso-8859-7</span>
  <span class="p">}</span>

<span class="n">_greek_wdays</span> <span class="o">=</span> \
  <span class="p">{</span> \
   <span class="s">u&#39;</span><span class="se">\u039a\u03c5\u03c1</span><span class="s">&#39;</span><span class="p">:</span> <span class="s">u&#39;Sun&#39;</span><span class="p">,</span> <span class="c"># caf5f1 in iso-8859-7</span>
   <span class="s">u&#39;</span><span class="se">\u0394\u03b5\u03c5</span><span class="s">&#39;</span><span class="p">:</span> <span class="s">u&#39;Mon&#39;</span><span class="p">,</span> <span class="c"># c4e5f5 in iso-8859-7</span>
   <span class="s">u&#39;</span><span class="se">\u03a4\u03c1\u03b9</span><span class="s">&#39;</span><span class="p">:</span> <span class="s">u&#39;Tue&#39;</span><span class="p">,</span> <span class="c"># d4f1e9 in iso-8859-7</span>
   <span class="s">u&#39;</span><span class="se">\u03a4\u03b5\u03c4</span><span class="s">&#39;</span><span class="p">:</span> <span class="s">u&#39;Wed&#39;</span><span class="p">,</span> <span class="c"># d4e5f4 in iso-8859-7</span>
   <span class="s">u&#39;</span><span class="se">\u03a0\u03b5\u03bc</span><span class="s">&#39;</span><span class="p">:</span> <span class="s">u&#39;Thu&#39;</span><span class="p">,</span> <span class="c"># d0e5ec in iso-8859-7</span>
   <span class="s">u&#39;</span><span class="se">\u03a0\u03b1\u03c1</span><span class="s">&#39;</span><span class="p">:</span> <span class="s">u&#39;Fri&#39;</span><span class="p">,</span> <span class="c"># d0e1f1 in iso-8859-7</span>
   <span class="s">u&#39;</span><span class="se">\u03a3\u03b1\u03b2</span><span class="s">&#39;</span><span class="p">:</span> <span class="s">u&#39;Sat&#39;</span><span class="p">,</span> <span class="c"># d3e1e2 in iso-8859-7   </span>
  <span class="p">}</span>

<span class="n">_greek_date_format_re</span> <span class="o">=</span> \
    <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">u&#39;([^,]+),\s+(\d{2})\s+([^\s]+)\s+(\d{4})\s+(\d{2}):(\d{2}):(\d{2})\s+([^\s]+)&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-267'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-267'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">_parse_date_greek</span><span class="p">(</span><span class="n">dateString</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Parse a string according to a Greek 8-bit date format.&#39;&#39;&#39;</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">_greek_date_format_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">dateString</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="p">:</span> <span class="k">return</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">wday</span> <span class="o">=</span> <span class="n">_greek_wdays</span><span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span>
        <span class="n">month</span> <span class="o">=</span> <span class="n">_greek_months</span><span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">rfc822date</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%(wday)s</span><span class="s">, </span><span class="si">%(day)s</span><span class="s"> </span><span class="si">%(month)s</span><span class="s"> </span><span class="si">%(year)s</span><span class="s"> </span><span class="si">%(hour)s</span><span class="s">:</span><span class="si">%(minute)s</span><span class="s">:</span><span class="si">%(second)s</span><span class="s"> </span><span class="si">%(zonediff)s</span><span class="s">&#39;</span> <span class="o">%</span> \
                 <span class="p">{</span><span class="s">&#39;wday&#39;</span><span class="p">:</span> <span class="n">wday</span><span class="p">,</span> <span class="s">&#39;day&#39;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="s">&#39;month&#39;</span><span class="p">:</span> <span class="n">month</span><span class="p">,</span> <span class="s">&#39;year&#39;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>\
                  <span class="s">&#39;hour&#39;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="s">&#39;minute&#39;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="s">&#39;second&#39;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span>\
                  <span class="s">&#39;zonediff&#39;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">8</span><span class="p">)}</span>
    <span class="k">if</span> <span class="n">_debug</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Greek date parsed as: </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">rfc822date</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_parse_date_rfc822</span><span class="p">(</span><span class="n">rfc822date</span><span class="p">)</span>
<span class="n">registerDateHandler</span><span class="p">(</span><span class="n">_parse_date_greek</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-268'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-268'>#</a>
      </div>
      <p>Unicode strings for Hungarian date strings</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="n">_hungarian_months</span> <span class="o">=</span> \
  <span class="p">{</span> \
    <span class="s">u&#39;janu</span><span class="se">\u00e1</span><span class="s">r&#39;</span><span class="p">:</span>   <span class="s">u&#39;01&#39;</span><span class="p">,</span>  <span class="c"># e1 in iso-8859-2</span>
    <span class="s">u&#39;febru</span><span class="se">\u00e1</span><span class="s">ri&#39;</span><span class="p">:</span> <span class="s">u&#39;02&#39;</span><span class="p">,</span>  <span class="c"># e1 in iso-8859-2</span>
    <span class="s">u&#39;m</span><span class="se">\u00e1</span><span class="s">rcius&#39;</span><span class="p">:</span>  <span class="s">u&#39;03&#39;</span><span class="p">,</span>  <span class="c"># e1 in iso-8859-2</span>
    <span class="s">u&#39;</span><span class="se">\u00e1</span><span class="s">prilis&#39;</span><span class="p">:</span>  <span class="s">u&#39;04&#39;</span><span class="p">,</span>  <span class="c"># e1 in iso-8859-2</span>
    <span class="s">u&#39;m</span><span class="se">\u00e1</span><span class="s">ujus&#39;</span><span class="p">:</span>   <span class="s">u&#39;05&#39;</span><span class="p">,</span>  <span class="c"># e1 in iso-8859-2</span>
    <span class="s">u&#39;j</span><span class="se">\u00fa</span><span class="s">nius&#39;</span><span class="p">:</span>   <span class="s">u&#39;06&#39;</span><span class="p">,</span>  <span class="c"># fa in iso-8859-2</span>
    <span class="s">u&#39;j</span><span class="se">\u00fa</span><span class="s">lius&#39;</span><span class="p">:</span>   <span class="s">u&#39;07&#39;</span><span class="p">,</span>  <span class="c"># fa in iso-8859-2</span>
    <span class="s">u&#39;augusztus&#39;</span><span class="p">:</span>     <span class="s">u&#39;08&#39;</span><span class="p">,</span>
    <span class="s">u&#39;szeptember&#39;</span><span class="p">:</span>    <span class="s">u&#39;09&#39;</span><span class="p">,</span>
    <span class="s">u&#39;okt</span><span class="se">\u00f3</span><span class="s">ber&#39;</span><span class="p">:</span>  <span class="s">u&#39;10&#39;</span><span class="p">,</span>  <span class="c"># f3 in iso-8859-2</span>
    <span class="s">u&#39;november&#39;</span><span class="p">:</span>      <span class="s">u&#39;11&#39;</span><span class="p">,</span>
    <span class="s">u&#39;december&#39;</span><span class="p">:</span>      <span class="s">u&#39;12&#39;</span><span class="p">,</span>
  <span class="p">}</span>

<span class="n">_hungarian_date_format_re</span> <span class="o">=</span> \
  <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">u&#39;(\d{4})-([^-]+)-(\d{,2})T(\d{,2}):(\d{2})((\+|-)(\d{,2}:\d{2}))&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-269'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-269'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">_parse_date_hungarian</span><span class="p">(</span><span class="n">dateString</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Parse a string according to a Hungarian 8-bit date format.&#39;&#39;&#39;</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">_hungarian_date_format_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">dateString</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="p">:</span> <span class="k">return</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">month</span> <span class="o">=</span> <span class="n">_hungarian_months</span><span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span>
        <span class="n">day</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">day</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">day</span> <span class="o">=</span> <span class="s">&#39;0&#39;</span> <span class="o">+</span> <span class="n">day</span>
        <span class="n">hour</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hour</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">hour</span> <span class="o">=</span> <span class="s">&#39;0&#39;</span> <span class="o">+</span> <span class="n">hour</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">w3dtfdate</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%(year)s</span><span class="s">-</span><span class="si">%(month)s</span><span class="s">-</span><span class="si">%(day)s</span><span class="s">T</span><span class="si">%(hour)s</span><span class="s">:</span><span class="si">%(minute)s%(zonediff)s</span><span class="s">&#39;</span> <span class="o">%</span> \
                <span class="p">{</span><span class="s">&#39;year&#39;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="s">&#39;month&#39;</span><span class="p">:</span> <span class="n">month</span><span class="p">,</span> <span class="s">&#39;day&#39;</span><span class="p">:</span> <span class="n">day</span><span class="p">,</span>\
                 <span class="s">&#39;hour&#39;</span><span class="p">:</span> <span class="n">hour</span><span class="p">,</span> <span class="s">&#39;minute&#39;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>\
                 <span class="s">&#39;zonediff&#39;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">6</span><span class="p">)}</span>
    <span class="k">if</span> <span class="n">_debug</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Hungarian date parsed as: </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">w3dtfdate</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_parse_date_w3dtf</span><span class="p">(</span><span class="n">w3dtfdate</span><span class="p">)</span>
<span class="n">registerDateHandler</span><span class="p">(</span><span class="n">_parse_date_hungarian</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-270'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-270'>#</a>
      </div>
      <p>W3DTF-style date parsing adapted from PyXML xml.utils.iso8601, written by
Drake and licensed under the Python license.  Removed all range checking
for month, day, hour, minute, and second, since mktime will normalize
these later</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">_parse_date_w3dtf</span><span class="p">(</span><span class="n">dateString</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-271'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-271'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__extract_date</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
        <span class="n">year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s">&#39;year&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">year</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span>
            <span class="n">year</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">gmtime</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">year</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
        <span class="n">julian</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s">&#39;julian&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">julian</span><span class="p">:</span>
            <span class="n">julian</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">julian</span><span class="p">)</span>
            <span class="n">month</span> <span class="o">=</span> <span class="n">julian</span> <span class="o">/</span> <span class="mi">30</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">day</span> <span class="o">=</span> <span class="n">julian</span> <span class="o">%</span> <span class="mi">30</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">jday</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">while</span> <span class="n">jday</span> <span class="o">!=</span> <span class="n">julian</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">mktime</span><span class="p">((</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
                <span class="n">jday</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">gmtime</span><span class="p">(</span><span class="n">t</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">diff</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">jday</span> <span class="o">-</span> <span class="n">julian</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">jday</span> <span class="o">&gt;</span> <span class="n">julian</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">diff</span> <span class="o">&lt;</span> <span class="n">day</span><span class="p">:</span>
                        <span class="n">day</span> <span class="o">=</span> <span class="n">day</span> <span class="o">-</span> <span class="n">diff</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">month</span> <span class="o">=</span> <span class="n">month</span> <span class="o">-</span> <span class="mi">1</span>
                        <span class="n">day</span> <span class="o">=</span> <span class="mi">31</span>
                <span class="k">elif</span> <span class="n">jday</span> <span class="o">&lt;</span> <span class="n">julian</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">day</span> <span class="o">+</span> <span class="n">diff</span> <span class="o">&lt;</span> <span class="mi">28</span><span class="p">:</span>
                       <span class="n">day</span> <span class="o">=</span> <span class="n">day</span> <span class="o">+</span> <span class="n">diff</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">month</span> <span class="o">=</span> <span class="n">month</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span>
        <span class="n">month</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s">&#39;month&#39;</span><span class="p">)</span>
        <span class="n">day</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">month</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">month</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">month</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">month</span><span class="p">)</span>
            <span class="n">day</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s">&#39;day&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">day</span><span class="p">:</span>
                <span class="n">day</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">day</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">day</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-272'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-272'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__extract_time</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
        <span class="n">hours</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s">&#39;hours&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">hours</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
        <span class="n">hours</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hours</span><span class="p">)</span>
        <span class="n">minutes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s">&#39;minutes&#39;</span><span class="p">))</span>
        <span class="n">seconds</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s">&#39;seconds&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">seconds</span><span class="p">:</span>
            <span class="n">seconds</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">seconds</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">seconds</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">hours</span><span class="p">,</span> <span class="n">minutes</span><span class="p">,</span> <span class="n">seconds</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-273'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-273'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__extract_tzd</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return the Time Zone Designator as an offset in seconds from UTC.&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="n">tzd</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s">&#39;tzd&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tzd</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">tzd</span> <span class="o">==</span> <span class="s">&#39;Z&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="n">hours</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s">&#39;tzdhours&#39;</span><span class="p">))</span>
        <span class="n">minutes</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s">&#39;tzdminutes&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">minutes</span><span class="p">:</span>
            <span class="n">minutes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">minutes</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">minutes</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="p">(</span><span class="n">hours</span><span class="o">*</span><span class="mi">60</span> <span class="o">+</span> <span class="n">minutes</span><span class="p">)</span> <span class="o">*</span> <span class="mi">60</span>
        <span class="k">if</span> <span class="n">tzd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;+&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">offset</span>
        <span class="k">return</span> <span class="n">offset</span>

    <span class="n">__date_re</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;(?P&lt;year&gt;\d\d\d\d)&#39;</span>
                 <span class="s">&#39;(?:(?P&lt;dsep&gt;-|)&#39;</span>
                 <span class="s">&#39;(?:(?P&lt;julian&gt;\d\d\d)&#39;</span>
                 <span class="s">&#39;|(?P&lt;month&gt;\d\d)(?:(?P=dsep)(?P&lt;day&gt;\d\d))?))?&#39;</span><span class="p">)</span>
    <span class="n">__tzd_re</span> <span class="o">=</span> <span class="s">&#39;(?P&lt;tzd&gt;[-+](?P&lt;tzdhours&gt;\d\d)(?::?(?P&lt;tzdminutes&gt;\d\d))|Z)&#39;</span>
    <span class="n">__tzd_rx</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">__tzd_re</span><span class="p">)</span>
    <span class="n">__time_re</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;(?P&lt;hours&gt;\d\d)(?P&lt;tsep&gt;:|)(?P&lt;minutes&gt;\d\d)&#39;</span>
                 <span class="s">&#39;(?:(?P=tsep)(?P&lt;seconds&gt;\d\d(?:[.,]\d+)?))?&#39;</span>
                 <span class="o">+</span> <span class="n">__tzd_re</span><span class="p">)</span>
    <span class="n">__datetime_re</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">(?:T</span><span class="si">%s</span><span class="s">)?&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">__date_re</span><span class="p">,</span> <span class="n">__time_re</span><span class="p">)</span>
    <span class="n">__datetime_rx</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">__datetime_re</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">__datetime_rx</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">dateString</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">m</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">()</span> <span class="o">!=</span> <span class="n">dateString</span><span class="p">):</span> <span class="k">return</span>
    <span class="n">gmt</span> <span class="o">=</span> <span class="n">__extract_date</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">+</span> <span class="n">__extract_time</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gmt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span>
    <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">gmtime</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">mktime</span><span class="p">(</span><span class="n">gmt</span><span class="p">)</span> <span class="o">+</span> <span class="n">__extract_tzd</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">-</span> <span class="n">time</span><span class="o">.</span><span class="n">timezone</span><span class="p">)</span>
<span class="n">registerDateHandler</span><span class="p">(</span><span class="n">_parse_date_w3dtf</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-274'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-274'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">_parse_date_rfc822</span><span class="p">(</span><span class="n">dateString</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Parse an RFC822, RFC1123, RFC2822, or asctime-style date&#39;&#39;&#39;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">dateString</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">rfc822</span><span class="o">.</span><span class="n">_daynames</span><span class="p">:</span>
        <span class="k">del</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;+&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="p">[:</span><span class="n">i</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">dateString</span> <span class="o">=</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">dateString</span> <span class="o">+=</span> <span class="s">&#39; 00:00:00 GMT&#39;</span>
    <span class="n">tm</span> <span class="o">=</span> <span class="n">rfc822</span><span class="o">.</span><span class="n">parsedate_tz</span><span class="p">(</span><span class="n">dateString</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tm</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">gmtime</span><span class="p">(</span><span class="n">rfc822</span><span class="o">.</span><span class="n">mktime_tz</span><span class="p">(</span><span class="n">tm</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-275'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-275'>#</a>
      </div>
      <p>rfc822.py defines several time zones, but we define some extra ones.
'ET' is equivalent to 'EST', etc.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="n">_additional_timezones</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;AT&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">400</span><span class="p">,</span> <span class="s">&#39;ET&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">500</span><span class="p">,</span> <span class="s">&#39;CT&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">600</span><span class="p">,</span> <span class="s">&#39;MT&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">700</span><span class="p">,</span> <span class="s">&#39;PT&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">800</span><span class="p">}</span>
<span class="n">rfc822</span><span class="o">.</span><span class="n">_timezones</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">_additional_timezones</span><span class="p">)</span>
<span class="n">registerDateHandler</span><span class="p">(</span><span class="n">_parse_date_rfc822</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-276'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-276'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">_parse_date</span><span class="p">(</span><span class="n">dateString</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Parses a variety of date formats into a 9-tuple in GMT&#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">_date_handlers</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">date9tuple</span> <span class="o">=</span> <span class="n">handler</span><span class="p">(</span><span class="n">dateString</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">date9tuple</span><span class="p">:</span> <span class="k">continue</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">date9tuple</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">9</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_debug</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;date handler function must return 9-tuple</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span>
            <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">date9tuple</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">date9tuple</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_debug</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> raised </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">handler</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
            <span class="k">pass</span>
    <span class="k">return</span> <span class="bp">None</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-277'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-277'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">_getCharacterEncoding</span><span class="p">(</span><span class="n">http_headers</span><span class="p">,</span> <span class="n">xml_data</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Get the character encoding of the XML document</span>

<span class="sd">    http_headers is a dictionary</span>
<span class="sd">    xml_data is a raw string (not Unicode)</span>
<span class="sd">    </span>
<span class="sd">    This is so much trickier than it sounds, it&#39;s not even funny.</span>
<span class="sd">    According to RFC 3023 (&#39;XML Media Types&#39;), if the HTTP Content-Type</span>
<span class="sd">    is application/xml, application/*+xml,</span>
<span class="sd">    application/xml-external-parsed-entity, or application/xml-dtd,</span>
<span class="sd">    the encoding given in the charset parameter of the HTTP Content-Type</span>
<span class="sd">    takes precedence over the encoding given in the XML prefix within the</span>
<span class="sd">    document, and defaults to &#39;utf-8&#39; if neither are specified.  But, if</span>
<span class="sd">    the HTTP Content-Type is text/xml, text/*+xml, or</span>
<span class="sd">    text/xml-external-parsed-entity, the encoding given in the XML prefix</span>
<span class="sd">    within the document is ALWAYS IGNORED and only the encoding given in</span>
<span class="sd">    the charset parameter of the HTTP Content-Type header should be</span>
<span class="sd">    respected, and it defaults to &#39;us-ascii&#39; if not specified.</span>

<span class="sd">    Furthermore, discussion on the atom-syntax mailing list with the</span>
<span class="sd">    author of RFC 3023 leads me to the conclusion that any document</span>
<span class="sd">    served with a Content-Type of text/* and no charset parameter</span>
<span class="sd">    must be treated as us-ascii.  (We now do this.)  And also that it</span>
<span class="sd">    must always be flagged as non-well-formed.  (We now do this too.)</span>
<span class="sd">    </span>
<span class="sd">    If Content-Type is unspecified (input was local file or non-HTTP source)</span>
<span class="sd">    or unrecognized (server just got it totally wrong), then go by the</span>
<span class="sd">    encoding given in the XML prefix of the document and default to</span>
<span class="sd">    &#39;iso-8859-1&#39; as per the HTTP specification (RFC 2616).</span>
<span class="sd">    </span>
<span class="sd">    Then, assuming we didn&#39;t find a character encoding in the HTTP headers</span>
<span class="sd">    (and the HTTP Content-type allowed us to look in the body), we need</span>
<span class="sd">    to sniff the first few bytes of the XML data and try to determine</span>
<span class="sd">    whether the encoding is ASCII-compatible.  Section F of the XML</span>
<span class="sd">    specification shows the way here:</span>
<span class="sd">    http://www.w3.org/TR/REC-xml/#sec-guessing-no-ext-info</span>

<span class="sd">    If the sniffed encoding is not ASCII-compatible, we need to make it</span>
<span class="sd">    ASCII compatible so that we can sniff further into the XML declaration</span>
<span class="sd">    to find the encoding attribute, which will tell us the true encoding.</span>

<span class="sd">    Of course, none of this guarantees that we will be able to parse the</span>
<span class="sd">    feed in the declared character encoding (assuming it was declared</span>
<span class="sd">    correctly, which many are not).  CJKCodecs and iconv_codec help a lot;</span>
<span class="sd">    you should definitely install them if you can.</span>
<span class="sd">    http://cjkpython.i18n.org/</span>
<span class="sd">    &#39;&#39;&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-278'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-278'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_parseHTTPContentType</span><span class="p">(</span><span class="n">content_type</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;takes HTTP Content-Type header and returns (content type, charset)</span>

<span class="sd">        If no charset is specified, returns (content type, &#39;&#39;)</span>
<span class="sd">        If no content type is specified, returns (&#39;&#39;, &#39;&#39;)</span>
<span class="sd">        Both return parameters are guaranteed to be lowercase strings</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">content_type</span> <span class="o">=</span> <span class="n">content_type</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span>
        <span class="n">content_type</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">cgi</span><span class="o">.</span><span class="n">parse_header</span><span class="p">(</span><span class="n">content_type</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">content_type</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;charset&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>

    <span class="n">sniffed_xml_encoding</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="n">xml_encoding</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="n">true_encoding</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="n">http_content_type</span><span class="p">,</span> <span class="n">http_encoding</span> <span class="o">=</span> <span class="n">_parseHTTPContentType</span><span class="p">(</span><span class="n">http_headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;content-type&#39;</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-279'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-279'>#</a>
      </div>
      <p>Must sniff for non-ASCII-compatible character encodings before
searching for XML declaration.  This heuristic is defined in
section F of the XML specification:
http://www.w3.org/TR/REC-xml/#sec-guessing-no-ext-info</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">xml_data</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;</span><span class="se">\x4c\x6f\xa7\x94</span><span class="s">&#39;</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-280'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-280'>#</a>
      </div>
      <p>EBCDIC</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">xml_data</span> <span class="o">=</span> <span class="n">_ebcdic_to_ascii</span><span class="p">(</span><span class="n">xml_data</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">xml_data</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;</span><span class="se">\x00\x3c\x00\x3f</span><span class="s">&#39;</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-281'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-281'>#</a>
      </div>
      <p>UTF-16BE</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">sniffed_xml_encoding</span> <span class="o">=</span> <span class="s">&#39;utf-16be&#39;</span>
            <span class="n">xml_data</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">xml_data</span><span class="p">,</span> <span class="s">&#39;utf-16be&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xml_data</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">xml_data</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;</span><span class="se">\xfe\xff</span><span class="s">&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">xml_data</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;</span><span class="se">\x00\x00</span><span class="s">&#39;</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-282'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-282'>#</a>
      </div>
      <p>UTF-16BE with BOM</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">sniffed_xml_encoding</span> <span class="o">=</span> <span class="s">&#39;utf-16be&#39;</span>
            <span class="n">xml_data</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">xml_data</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span> <span class="s">&#39;utf-16be&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">xml_data</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;</span><span class="se">\x3c\x00\x3f\x00</span><span class="s">&#39;</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-283'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-283'>#</a>
      </div>
      <p>UTF-16LE</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">sniffed_xml_encoding</span> <span class="o">=</span> <span class="s">&#39;utf-16le&#39;</span>
            <span class="n">xml_data</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">xml_data</span><span class="p">,</span> <span class="s">&#39;utf-16le&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xml_data</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">xml_data</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;</span><span class="se">\xff\xfe</span><span class="s">&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">xml_data</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;</span><span class="se">\x00\x00</span><span class="s">&#39;</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-284'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-284'>#</a>
      </div>
      <p>UTF-16LE with BOM</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">sniffed_xml_encoding</span> <span class="o">=</span> <span class="s">&#39;utf-16le&#39;</span>
            <span class="n">xml_data</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">xml_data</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span> <span class="s">&#39;utf-16le&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">xml_data</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;</span><span class="se">\x00\x00\x00\x3c</span><span class="s">&#39;</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-285'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-285'>#</a>
      </div>
      <p>UTF-32BE</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">sniffed_xml_encoding</span> <span class="o">=</span> <span class="s">&#39;utf-32be&#39;</span>
            <span class="n">xml_data</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">xml_data</span><span class="p">,</span> <span class="s">&#39;utf-32be&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">xml_data</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;</span><span class="se">\x3c\x00\x00\x00</span><span class="s">&#39;</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-286'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-286'>#</a>
      </div>
      <p>UTF-32LE</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">sniffed_xml_encoding</span> <span class="o">=</span> <span class="s">&#39;utf-32le&#39;</span>
            <span class="n">xml_data</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">xml_data</span><span class="p">,</span> <span class="s">&#39;utf-32le&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">xml_data</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;</span><span class="se">\x00\x00\xfe\xff</span><span class="s">&#39;</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-287'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-287'>#</a>
      </div>
      <p>UTF-32BE with BOM</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">sniffed_xml_encoding</span> <span class="o">=</span> <span class="s">&#39;utf-32be&#39;</span>
            <span class="n">xml_data</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">xml_data</span><span class="p">[</span><span class="mi">4</span><span class="p">:],</span> <span class="s">&#39;utf-32be&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">xml_data</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;</span><span class="se">\xff\xfe\x00\x00</span><span class="s">&#39;</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-288'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-288'>#</a>
      </div>
      <p>UTF-32LE with BOM</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">sniffed_xml_encoding</span> <span class="o">=</span> <span class="s">&#39;utf-32le&#39;</span>
            <span class="n">xml_data</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">xml_data</span><span class="p">[</span><span class="mi">4</span><span class="p">:],</span> <span class="s">&#39;utf-32le&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">xml_data</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;</span><span class="se">\xef\xbb\xbf</span><span class="s">&#39;</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-289'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-289'>#</a>
      </div>
      <p>UTF-8 with BOM</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">sniffed_xml_encoding</span> <span class="o">=</span> <span class="s">&#39;utf-8&#39;</span>
            <span class="n">xml_data</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">xml_data</span><span class="p">[</span><span class="mi">3</span><span class="p">:],</span> <span class="s">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-290'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-290'>#</a>
      </div>
      <p>ASCII-compatible</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="k">pass</span>
        <span class="n">xml_encoding_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&#39;^&lt;\?.*encoding=[</span><span class="se">\&#39;</span><span class="s">&quot;](.*?)[</span><span class="se">\&#39;</span><span class="s">&quot;].*\?&gt;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">xml_data</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">xml_encoding_match</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">xml_encoding_match</span><span class="p">:</span>
        <span class="n">xml_encoding</span> <span class="o">=</span> <span class="n">xml_encoding_match</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">sniffed_xml_encoding</span> <span class="ow">and</span> <span class="p">(</span><span class="n">xml_encoding</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;iso-10646-ucs-2&#39;</span><span class="p">,</span> <span class="s">&#39;ucs-2&#39;</span><span class="p">,</span> <span class="s">&#39;csunicode&#39;</span><span class="p">,</span> <span class="s">&#39;iso-10646-ucs-4&#39;</span><span class="p">,</span> <span class="s">&#39;ucs-4&#39;</span><span class="p">,</span> <span class="s">&#39;csucs4&#39;</span><span class="p">,</span> <span class="s">&#39;utf-16&#39;</span><span class="p">,</span> <span class="s">&#39;utf-32&#39;</span><span class="p">,</span> <span class="s">&#39;utf_16&#39;</span><span class="p">,</span> <span class="s">&#39;utf_32&#39;</span><span class="p">,</span> <span class="s">&#39;utf16&#39;</span><span class="p">,</span> <span class="s">&#39;u16&#39;</span><span class="p">)):</span>
            <span class="n">xml_encoding</span> <span class="o">=</span> <span class="n">sniffed_xml_encoding</span>
    <span class="n">acceptable_content_type</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">application_content_types</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;application/xml&#39;</span><span class="p">,</span> <span class="s">&#39;application/xml-dtd&#39;</span><span class="p">,</span> <span class="s">&#39;application/xml-external-parsed-entity&#39;</span><span class="p">)</span>
    <span class="n">text_content_types</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;text/xml&#39;</span><span class="p">,</span> <span class="s">&#39;text/xml-external-parsed-entity&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">http_content_type</span> <span class="ow">in</span> <span class="n">application_content_types</span><span class="p">)</span> <span class="ow">or</span> \
       <span class="p">(</span><span class="n">http_content_type</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;application/&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">http_content_type</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;+xml&#39;</span><span class="p">)):</span>
        <span class="n">acceptable_content_type</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">true_encoding</span> <span class="o">=</span> <span class="n">http_encoding</span> <span class="ow">or</span> <span class="n">xml_encoding</span> <span class="ow">or</span> <span class="s">&#39;utf-8&#39;</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">http_content_type</span> <span class="ow">in</span> <span class="n">text_content_types</span><span class="p">)</span> <span class="ow">or</span> \
         <span class="p">(</span><span class="n">http_content_type</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;text/&#39;</span><span class="p">))</span> <span class="ow">and</span> <span class="n">http_content_type</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;+xml&#39;</span><span class="p">):</span>
        <span class="n">acceptable_content_type</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">true_encoding</span> <span class="o">=</span> <span class="n">http_encoding</span> <span class="ow">or</span> <span class="s">&#39;us-ascii&#39;</span>
    <span class="k">elif</span> <span class="n">http_content_type</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;text/&#39;</span><span class="p">):</span>
        <span class="n">true_encoding</span> <span class="o">=</span> <span class="n">http_encoding</span> <span class="ow">or</span> <span class="s">&#39;us-ascii&#39;</span>
    <span class="k">elif</span> <span class="n">http_headers</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">http_headers</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;content-type&#39;</span><span class="p">)):</span>
        <span class="n">true_encoding</span> <span class="o">=</span> <span class="n">xml_encoding</span> <span class="ow">or</span> <span class="s">&#39;iso-8859-1&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">true_encoding</span> <span class="o">=</span> <span class="n">xml_encoding</span> <span class="ow">or</span> <span class="s">&#39;utf-8&#39;</span>
    <span class="k">return</span> <span class="n">true_encoding</span><span class="p">,</span> <span class="n">http_encoding</span><span class="p">,</span> <span class="n">xml_encoding</span><span class="p">,</span> <span class="n">sniffed_xml_encoding</span><span class="p">,</span> <span class="n">acceptable_content_type</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-291'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-291'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">_toUTF8</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">encoding</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Changes an XML data stream on the fly to specify a new encoding</span>

<span class="sd">    data is a raw sequence of bytes (not Unicode) that is presumed to be in %encoding already</span>
<span class="sd">    encoding is a string recognized by encodings.aliases</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">_debug</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;entering _toUTF8, trying encoding </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">encoding</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-292'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-292'>#</a>
      </div>
      <p>strip Byte Order Mark (if present)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;</span><span class="se">\xfe\xff</span><span class="s">&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;</span><span class="se">\x00\x00</span><span class="s">&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">_debug</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;stripping BOM</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">encoding</span> <span class="o">!=</span> <span class="s">&#39;utf-16be&#39;</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;trying utf-16be instead</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">encoding</span> <span class="o">=</span> <span class="s">&#39;utf-16be&#39;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
    <span class="k">elif</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;</span><span class="se">\xff\xfe</span><span class="s">&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;</span><span class="se">\x00\x00</span><span class="s">&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">_debug</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;stripping BOM</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">encoding</span> <span class="o">!=</span> <span class="s">&#39;utf-16le&#39;</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;trying utf-16le instead</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">encoding</span> <span class="o">=</span> <span class="s">&#39;utf-16le&#39;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
    <span class="k">elif</span> <span class="n">data</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;</span><span class="se">\xef\xbb\xbf</span><span class="s">&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">_debug</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;stripping BOM</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">encoding</span> <span class="o">!=</span> <span class="s">&#39;utf-8&#39;</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;trying utf-8 instead</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">encoding</span> <span class="o">=</span> <span class="s">&#39;utf-8&#39;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>
    <span class="k">elif</span> <span class="n">data</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;</span><span class="se">\x00\x00\xfe\xff</span><span class="s">&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">_debug</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;stripping BOM</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">encoding</span> <span class="o">!=</span> <span class="s">&#39;utf-32be&#39;</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;trying utf-32be instead</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">encoding</span> <span class="o">=</span> <span class="s">&#39;utf-32be&#39;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span>
    <span class="k">elif</span> <span class="n">data</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;</span><span class="se">\xff\xfe\x00\x00</span><span class="s">&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">_debug</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;stripping BOM</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">encoding</span> <span class="o">!=</span> <span class="s">&#39;utf-32le&#39;</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;trying utf-32le instead</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">encoding</span> <span class="o">=</span> <span class="s">&#39;utf-32le&#39;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span>
    <span class="n">newdata</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">encoding</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_debug</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;successfully converted </span><span class="si">%s</span><span class="s"> data to unicode</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">encoding</span><span class="p">)</span>
    <span class="n">declmatch</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&#39;^&lt;\?xml[^&gt;]*?&gt;&#39;</span><span class="p">)</span>
    <span class="n">newdecl</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;&lt;?xml version=&#39;1.0&#39; encoding=&#39;utf-8&#39;?&gt;&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">declmatch</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">newdata</span><span class="p">):</span>
        <span class="n">newdata</span> <span class="o">=</span> <span class="n">declmatch</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">newdecl</span><span class="p">,</span> <span class="n">newdata</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">newdata</span> <span class="o">=</span> <span class="n">newdecl</span> <span class="o">+</span> <span class="s">u&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">newdata</span>
    <span class="k">return</span> <span class="n">newdata</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-293'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-293'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">_stripDoctype</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Strips DOCTYPE from XML document, returns (rss_version, stripped_data)</span>

<span class="sd">    rss_version may be &#39;rss091n&#39; or None</span>
<span class="sd">    stripped_data is the same XML document, minus the DOCTYPE</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">entity_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;&lt;!ENTITY([^&gt;]*?)&gt;&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">entity_pattern</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    <span class="n">doctype_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;&lt;!DOCTYPE([^&gt;]*?)&gt;&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>
    <span class="n">doctype_results</span> <span class="o">=</span> <span class="n">doctype_pattern</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">doctype</span> <span class="o">=</span> <span class="n">doctype_results</span> <span class="ow">and</span> <span class="n">doctype_results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">doctype</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&#39;netscape&#39;</span><span class="p">):</span>
        <span class="n">version</span> <span class="o">=</span> <span class="s">&#39;rss091n&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">version</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">doctype_pattern</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">version</span><span class="p">,</span> <span class="n">data</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-294'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-294'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">url_file_stream_or_string</span><span class="p">,</span> <span class="n">etag</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">modified</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">agent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">referrer</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">handlers</span><span class="o">=</span><span class="p">[]):</span>
    <span class="sd">&#39;&#39;&#39;Parse a feed from a URL, file, stream, or string&#39;&#39;&#39;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">FeedParserDict</span><span class="p">()</span>
    <span class="n">result</span><span class="p">[</span><span class="s">&#39;feed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FeedParserDict</span><span class="p">()</span>
    <span class="n">result</span><span class="p">[</span><span class="s">&#39;entries&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">_XML_AVAILABLE</span><span class="p">:</span>
        <span class="n">result</span><span class="p">[</span><span class="s">&#39;bozo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">handlers</span><span class="p">)</span> <span class="o">==</span> <span class="n">types</span><span class="o">.</span><span class="n">InstanceType</span><span class="p">:</span>
        <span class="n">handlers</span> <span class="o">=</span> <span class="p">[</span><span class="n">handlers</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">_open_resource</span><span class="p">(</span><span class="n">url_file_stream_or_string</span><span class="p">,</span> <span class="n">etag</span><span class="p">,</span> <span class="n">modified</span><span class="p">,</span> <span class="n">agent</span><span class="p">,</span> <span class="n">referrer</span><span class="p">,</span> <span class="n">handlers</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">result</span><span class="p">[</span><span class="s">&#39;bozo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">result</span><span class="p">[</span><span class="s">&#39;bozo_exception&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">e</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">None</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-295'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-295'>#</a>
      </div>
      <p>if feed is gzip-compressed, decompress it</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="n">f</span> <span class="ow">and</span> <span class="n">data</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&#39;headers&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">gzip</span> <span class="ow">and</span> <span class="n">f</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;content-encoding&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;gzip&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">gzip</span><span class="o">.</span><span class="n">GzipFile</span><span class="p">(</span><span class="n">fileobj</span><span class="o">=</span><span class="n">_StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">))</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-296'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-296'>#</a>
      </div>
      <p>Some feeds claim to be gzipped but they're not, so
we get garbage.  Ideally, we should re-request the
feed without the 'Accept-encoding: gzip' header,
but we don't.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="n">result</span><span class="p">[</span><span class="s">&#39;bozo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">result</span><span class="p">[</span><span class="s">&#39;bozo_exception&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">e</span>
                <span class="n">data</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">elif</span> <span class="n">zlib</span> <span class="ow">and</span> <span class="n">f</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;content-encoding&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;deflate&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">-</span><span class="n">zlib</span><span class="o">.</span><span class="n">MAX_WBITS</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="s">&#39;bozo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">result</span><span class="p">[</span><span class="s">&#39;bozo_exception&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">e</span>
                <span class="n">data</span> <span class="o">=</span> <span class="s">&#39;&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-297'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-297'>#</a>
      </div>
      <p>save HTTP headers</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&#39;info&#39;</span><span class="p">):</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
        <span class="n">result</span><span class="p">[</span><span class="s">&#39;etag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">getheader</span><span class="p">(</span><span class="s">&#39;ETag&#39;</span><span class="p">)</span>
        <span class="n">last_modified</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">getheader</span><span class="p">(</span><span class="s">&#39;Last-Modified&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">last_modified</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s">&#39;modified&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_parse_date</span><span class="p">(</span><span class="n">last_modified</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&#39;url&#39;</span><span class="p">):</span>
        <span class="n">result</span><span class="p">[</span><span class="s">&#39;href&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">url</span>
        <span class="n">result</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&#39;status&#39;</span><span class="p">):</span>
        <span class="n">result</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">status</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&#39;headers&#39;</span><span class="p">):</span>
        <span class="n">result</span><span class="p">[</span><span class="s">&#39;headers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">dict</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&#39;close&#39;</span><span class="p">):</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-298'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-298'>#</a>
      </div>
      <p>there are four encodings to keep track of:
- http_encoding is the encoding declared in the Content-Type HTTP header
- xml_encoding is the encoding declared in the &lt;?xml declaration
- sniffed_encoding is the encoding sniffed from the first 4 bytes of the XML data
- result['encoding'] is the actual encoding, as per RFC 3023 and a variety of other conflicting specifications</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">http_headers</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;headers&#39;</span><span class="p">,</span> <span class="p">{})</span>
    <span class="n">result</span><span class="p">[</span><span class="s">&#39;encoding&#39;</span><span class="p">],</span> <span class="n">http_encoding</span><span class="p">,</span> <span class="n">xml_encoding</span><span class="p">,</span> <span class="n">sniffed_xml_encoding</span><span class="p">,</span> <span class="n">acceptable_content_type</span> <span class="o">=</span> \
        <span class="n">_getCharacterEncoding</span><span class="p">(</span><span class="n">http_headers</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">http_headers</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">acceptable_content_type</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">http_headers</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;content-type&#39;</span><span class="p">):</span>
            <span class="n">bozo_message</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> is not an XML media type&#39;</span> <span class="o">%</span> <span class="n">http_headers</span><span class="p">[</span><span class="s">&#39;content-type&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bozo_message</span> <span class="o">=</span> <span class="s">&#39;no Content-type specified&#39;</span>
        <span class="n">result</span><span class="p">[</span><span class="s">&#39;bozo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">result</span><span class="p">[</span><span class="s">&#39;bozo_exception&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">NonXMLContentType</span><span class="p">(</span><span class="n">bozo_message</span><span class="p">)</span>
        
    <span class="n">result</span><span class="p">[</span><span class="s">&#39;version&#39;</span><span class="p">],</span> <span class="n">data</span> <span class="o">=</span> <span class="n">_stripDoctype</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="n">baseuri</span> <span class="o">=</span> <span class="n">http_headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;content-location&#39;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;href&#39;</span><span class="p">))</span>
    <span class="n">baselang</span> <span class="o">=</span> <span class="n">http_headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;content-language&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-299'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-299'>#</a>
      </div>
      <p>if server sent 304, we're done</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;status&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">304</span><span class="p">:</span>
        <span class="n">result</span><span class="p">[</span><span class="s">&#39;version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">result</span><span class="p">[</span><span class="s">&#39;debug_message&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;The feed has not changed since you last checked, &#39;</span> <span class="o">+</span> \
            <span class="s">&#39;so the server sent no data.  This is a feature, not a bug!&#39;</span>
        <span class="k">return</span> <span class="n">result</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-300'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-300'>#</a>
      </div>
      <p>if there was a problem downloading, we're done</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">result</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-301'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-301'>#</a>
      </div>
      <p>determine character encoding</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">use_strict_parser</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">known_encoding</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">tried_encodings</span> <span class="o">=</span> <span class="p">[]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-302'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-302'>#</a>
      </div>
      <p>try: HTTP encoding, declared XML encoding, encoding sniffed from BOM</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">for</span> <span class="n">proposed_encoding</span> <span class="ow">in</span> <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s">&#39;encoding&#39;</span><span class="p">],</span> <span class="n">xml_encoding</span><span class="p">,</span> <span class="n">sniffed_xml_encoding</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">proposed_encoding</span><span class="p">:</span> <span class="k">continue</span>
        <span class="k">if</span> <span class="n">proposed_encoding</span> <span class="ow">in</span> <span class="n">tried_encodings</span><span class="p">:</span> <span class="k">continue</span>
        <span class="n">tried_encodings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">proposed_encoding</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">_toUTF8</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">proposed_encoding</span><span class="p">)</span>
            <span class="n">known_encoding</span> <span class="o">=</span> <span class="n">use_strict_parser</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">break</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-303'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-303'>#</a>
      </div>
      <p>if no luck and we have auto-detection library, try that</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">known_encoding</span><span class="p">)</span> <span class="ow">and</span> <span class="n">chardet</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">proposed_encoding</span> <span class="o">=</span> <span class="n">chardet</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="s">&#39;encoding&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">proposed_encoding</span> <span class="ow">and</span> <span class="p">(</span><span class="n">proposed_encoding</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tried_encodings</span><span class="p">):</span>
                <span class="n">tried_encodings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">proposed_encoding</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">_toUTF8</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">proposed_encoding</span><span class="p">)</span>
                <span class="n">known_encoding</span> <span class="o">=</span> <span class="n">use_strict_parser</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-304'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-304'>#</a>
      </div>
      <p>if still no luck and we haven't tried utf-8 yet, try that</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">known_encoding</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s">&#39;utf-8&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tried_encodings</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">proposed_encoding</span> <span class="o">=</span> <span class="s">&#39;utf-8&#39;</span>
            <span class="n">tried_encodings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">proposed_encoding</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">_toUTF8</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">proposed_encoding</span><span class="p">)</span>
            <span class="n">known_encoding</span> <span class="o">=</span> <span class="n">use_strict_parser</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-305'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-305'>#</a>
      </div>
      <p>if still no luck and we haven't tried windows-1252 yet, try that</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">known_encoding</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s">&#39;windows-1252&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tried_encodings</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">proposed_encoding</span> <span class="o">=</span> <span class="s">&#39;windows-1252&#39;</span>
            <span class="n">tried_encodings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">proposed_encoding</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">_toUTF8</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">proposed_encoding</span><span class="p">)</span>
            <span class="n">known_encoding</span> <span class="o">=</span> <span class="n">use_strict_parser</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-306'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-306'>#</a>
      </div>
      <p>if still no luck, give up</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="ow">not</span> <span class="n">known_encoding</span><span class="p">:</span>
        <span class="n">result</span><span class="p">[</span><span class="s">&#39;bozo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">result</span><span class="p">[</span><span class="s">&#39;bozo_exception&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CharacterEncodingUnknown</span><span class="p">(</span> \
            <span class="s">&#39;document encoding unknown, I tried &#39;</span> <span class="o">+</span> \
            <span class="s">&#39;</span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, utf-8, and windows-1252 but nothing worked&#39;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s">&#39;encoding&#39;</span><span class="p">],</span> <span class="n">xml_encoding</span><span class="p">))</span>
        <span class="n">result</span><span class="p">[</span><span class="s">&#39;encoding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="k">elif</span> <span class="n">proposed_encoding</span> <span class="o">!=</span> <span class="n">result</span><span class="p">[</span><span class="s">&#39;encoding&#39;</span><span class="p">]:</span>
        <span class="n">result</span><span class="p">[</span><span class="s">&#39;bozo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">result</span><span class="p">[</span><span class="s">&#39;bozo_exception&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CharacterEncodingOverride</span><span class="p">(</span> \
            <span class="s">&#39;documented declared as </span><span class="si">%s</span><span class="s">, but parsed as </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s">&#39;encoding&#39;</span><span class="p">],</span> <span class="n">proposed_encoding</span><span class="p">))</span>
        <span class="n">result</span><span class="p">[</span><span class="s">&#39;encoding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">proposed_encoding</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">_XML_AVAILABLE</span><span class="p">:</span>
        <span class="n">use_strict_parser</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">use_strict_parser</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-307'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-307'>#</a>
      </div>
      <p>initialize the SAX parser</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">feedparser</span> <span class="o">=</span> <span class="n">_StrictFeedParser</span><span class="p">(</span><span class="n">baseuri</span><span class="p">,</span> <span class="n">baselang</span><span class="p">,</span> <span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="n">saxparser</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">sax</span><span class="o">.</span><span class="n">make_parser</span><span class="p">(</span><span class="n">PREFERRED_XML_PARSERS</span><span class="p">)</span>
        <span class="n">saxparser</span><span class="o">.</span><span class="n">setFeature</span><span class="p">(</span><span class="n">xml</span><span class="o">.</span><span class="n">sax</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">feature_namespaces</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">saxparser</span><span class="o">.</span><span class="n">setContentHandler</span><span class="p">(</span><span class="n">feedparser</span><span class="p">)</span>
        <span class="n">saxparser</span><span class="o">.</span><span class="n">setErrorHandler</span><span class="p">(</span><span class="n">feedparser</span><span class="p">)</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">sax</span><span class="o">.</span><span class="n">xmlreader</span><span class="o">.</span><span class="n">InputSource</span><span class="p">()</span>
        <span class="n">source</span><span class="o">.</span><span class="n">setByteStream</span><span class="p">(</span><span class="n">_StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">saxparser</span><span class="p">,</span> <span class="s">&#39;_ns_stack&#39;</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-308'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-308'>#</a>
      </div>
      <p>work around bug in built-in SAX parser (doesn't recognize xml: namespace)
PyXML doesn't have this problem, and it doesn't have _ns_stack either</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">saxparser</span><span class="o">.</span><span class="n">_ns_stack</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s">&#39;http://www.w3.org/XML/1998/namespace&#39;</span><span class="p">:</span><span class="s">&#39;xml&#39;</span><span class="p">})</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">saxparser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_debug</span><span class="p">:</span>
                <span class="kn">import</span> <span class="nn">traceback</span>
                <span class="n">traceback</span><span class="o">.</span><span class="n">print_stack</span><span class="p">()</span>
                <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;xml parsing failed</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">result</span><span class="p">[</span><span class="s">&#39;bozo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">result</span><span class="p">[</span><span class="s">&#39;bozo_exception&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">feedparser</span><span class="o">.</span><span class="n">exc</span> <span class="ow">or</span> <span class="n">e</span>
            <span class="n">use_strict_parser</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">use_strict_parser</span><span class="p">:</span>
        <span class="n">feedparser</span> <span class="o">=</span> <span class="n">_LooseFeedParser</span><span class="p">(</span><span class="n">baseuri</span><span class="p">,</span> <span class="n">baselang</span><span class="p">,</span> <span class="n">known_encoding</span> <span class="ow">and</span> <span class="s">&#39;utf-8&#39;</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">feedparser</span><span class="o">.</span><span class="n">feed</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">result</span><span class="p">[</span><span class="s">&#39;feed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">feedparser</span><span class="o">.</span><span class="n">feeddata</span>
    <span class="n">result</span><span class="p">[</span><span class="s">&#39;entries&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">feedparser</span><span class="o">.</span><span class="n">entries</span>
    <span class="n">result</span><span class="p">[</span><span class="s">&#39;version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s">&#39;version&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">feedparser</span><span class="o">.</span><span class="n">version</span>
    <span class="n">result</span><span class="p">[</span><span class="s">&#39;namespaces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">feedparser</span><span class="o">.</span><span class="n">namespacesInUse</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="k">print</span> <span class="n">__doc__</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">urls</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">zopeCompatibilityHack</span><span class="p">()</span>
    <span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
    <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">:</span>
        <span class="k">print</span> <span class="n">url</span>
        <span class="k">print</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">pprint</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">print</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-309'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-309'>#</a>
      </div>
      <p>REVISION HISTORY
1.0 - 9/27/2002 - MAP - fixed namespace processing on prefixed RSS 2.0 elements,
 added Simon Fell's test suite
1.1 - 9/29/2002 - MAP - fixed infinite loop on incomplete CDATA sections
2.0 - 10/19/2002
 JD - use inchannel to watch out for image and textinput elements which can
 also contain title, link, and description elements
 JD - check for isPermaLink='false' attribute on guid elements
 JD - replaced openAnything with open_resource supporting ETag and
 If-Modified-Since request headers
 JD - parse now accepts etag, modified, agent, and referrer optional
 arguments
 JD - modified parse to return a dictionary instead of a tuple so that any
 etag or modified information can be returned and cached by the caller
2.0.1 - 10/21/2002 - MAP - changed parse() so that if we don't get anything
 because of etag/modified, return the old etag/modified to the caller to
 indicate why nothing is being returned
2.0.2 - 10/21/2002 - JB - added the inchannel to the if statement, otherwise its
 useless.  Fixes the problem JD was addressing by adding it.
2.1 - 11/14/2002 - MAP - added gzip support
2.2 - 1/27/2003 - MAP - added attribute support, admin:generatorAgent.
 start_admingeneratoragent is an example of how to handle elements with
 only attributes, no content.
2.3 - 6/11/2003 - MAP - added USER_AGENT for default (if caller doesn't specify);
 also, make sure we send the User-Agent even if urllib2 isn't available.
 Match any variation of backend.userland.com/rss namespace.
2.3.1 - 6/12/2003 - MAP - if item has both link and guid, return both as-is.
2.4 - 7/9/2003 - MAP - added preliminary Pie/Atom/Echo support based on Sam Ruby's
 snapshot of July 1 <a href="http://www.intertwingly.net/blog/1506.html">http://www.intertwingly.net/blog/1506.html</a>; changed
 project name
2.5 - 7/25/2003 - MAP - changed to Python license (all contributors agree);
 removed unnecessary urllib code -- urllib2 should always be available anyway;
 return actual url, status, and full HTTP headers (as result['url'],
 result['status'], and result['headers']) if parsing a remote feed over HTTP --
 this should pass all the HTTP tests at <a href="http://diveintomark.org/tests/client/http/">http://diveintomark.org/tests/client/http/</a>;
 added the latest namespace-of-the-week for RSS 2.0
2.5.1 - 7/26/2003 - RMK - clear opener.addheaders so we only send our custom
 User-Agent (otherwise urllib2 sends two, which confuses some servers)
2.5.2 - 7/28/2003 - MAP - entity-decode inline xml properly; added support for
 inline <xhtml:body> and <xhtml:div> as used in some RSS 2.0 feeds
2.5.3 - 8/6/2003 - TvdV - patch to track whether we're inside an image or
 textInput, and also to return the character encoding (if specified)
2.6 - 1/1/2004 - MAP - dc:author support (MarekK); fixed bug tracking
 nested divs within content (JohnD); fixed missing sys import (JohanS);
 fixed regular expression to capture XML character encoding (Andrei);
 added support for Atom 0.3-style links; fixed bug with textInput tracking;
 added support for cloud (MartijnP); added support for multiple
 category/dc:subject (MartijnP); normalize content model: 'description' gets
 description (which can come from description, summary, or full content if no
 description), 'content' gets dict of base/language/type/value (which can come
 from content:encoded, xhtml:body, content, or fullitem);
 fixed bug matching arbitrary Userland namespaces; added xml:base and xml:lang
 tracking; fixed bug tracking unknown tags; fixed bug tracking content when
 <content> element is not in default namespace (like Pocketsoap feed);
 resolve relative URLs in link, guid, docs, url, comments, wfw:comment,
 wfw:commentRSS; resolve relative URLs within embedded HTML markup in
 description, xhtml:body, content, content:encoded, title, subtitle,
 summary, info, tagline, and copyright; added support for pingback and
 trackback namespaces
2.7 - 1/5/2004 - MAP - really added support for trackback and pingback
 namespaces, as opposed to 2.6 when I said I did but didn't really;
 sanitize HTML markup within some elements; added mxTidy support (if
 installed) to tidy HTML markup within some elements; fixed indentation
 bug in _parse_date (FazalM); use socket.setdefaulttimeout if available
 (FazalM); universal date parsing and normalization (FazalM): 'created', modified',
 'issued' are parsed into 9-tuple date format and stored in 'created_parsed',
 'modified_parsed', and 'issued_parsed'; 'date' is duplicated in 'modified'
 and vice-versa; 'date_parsed' is duplicated in 'modified_parsed' and vice-versa
2.7.1 - 1/9/2004 - MAP - fixed bug handling &quot; and &apos;.  fixed memory
 leak not closing url opener (JohnD); added dc:publisher support (MarekK);
 added admin:errorReportsTo support (MarekK); Python 2.1 dict support (MarekK)
2.7.4 - 1/14/2004 - MAP - added workaround for improperly formed <br/> tags in
 encoded HTML (skadz); fixed unicode handling in normalize_attrs (ChrisL);
 fixed relative URI processing for guid (skadz); added ICBM support; added
 base64 support
2.7.5 - 1/15/2004 - MAP - added workaround for malformed DOCTYPE (seen on many
 blogspot.com sites); added _debug variable
2.7.6 - 1/16/2004 - MAP - fixed bug with StringIO importing
3.0b3 - 1/23/2004 - MAP - parse entire feed with real XML parser (if available);
 added several new supported namespaces; fixed bug tracking naked markup in
 description; added support for enclosure; added support for source; re-added
 support for cloud which got dropped somehow; added support for expirationDate
3.0b4 - 1/26/2004 - MAP - fixed xml:lang inheritance; fixed multiple bugs tracking
 xml:base URI, one for documents that don't define one explicitly and one for
 documents that define an outer and an inner xml:base that goes out of scope
 before the end of the document
3.0b5 - 1/26/2004 - MAP - fixed bug parsing multiple links at feed level
3.0b6 - 1/27/2004 - MAP - added feed type and version detection, result['version']
 will be one of SUPPORTED_VERSIONS.keys() or empty string if unrecognized;
 added support for creativeCommons:license and cc:license; added support for
 full Atom content model in title, tagline, info, copyright, summary; fixed bug
 with gzip encoding (not always telling server we support it when we do)
3.0b7 - 1/28/2004 - MAP - support Atom-style author element in author_detail
 (dictionary of 'name', 'url', 'email'); map author to author_detail if author
 contains name + email address
3.0b8 - 1/28/2004 - MAP - added support for contributor
3.0b9 - 1/29/2004 - MAP - fixed check for presence of dict function; added
 support for summary
3.0b10 - 1/31/2004 - MAP - incorporated ISO-8601 date parsing routines from
 xml.util.iso8601
3.0b11 - 2/2/2004 - MAP - added 'rights' to list of elements that can contain
 dangerous markup; fiddled with decodeEntities (not right); liberalized
 date parsing even further
3.0b12 - 2/6/2004 - MAP - fiddled with decodeEntities (still not right);
 added support to Atom 0.2 subtitle; added support for Atom content model
 in copyright; better sanitizing of dangerous HTML elements with end tags
 (script, frameset)
3.0b13 - 2/8/2004 - MAP - better handling of empty HTML tags (br, hr, img,
 etc.) in embedded markup, in either HTML or XHTML form (<br>, <br/>, <br />)
3.0b14 - 2/8/2004 - MAP - fixed CDATA handling in non-wellformed feeds under
 Python 2.1
3.0b15 - 2/11/2004 - MAP - fixed bug resolving relative links in wfw:commentRSS;
 fixed bug capturing author and contributor URL; fixed bug resolving relative
 links in author and contributor URL; fixed bug resolvin relative links in
 generator URL; added support for recognizing RSS 1.0; passed Simon Fell's
 namespace tests, and included them permanently in the test suite with his
 permission; fixed namespace handling under Python 2.1
3.0b16 - 2/12/2004 - MAP - fixed support for RSS 0.90 (broken in b15)
3.0b17 - 2/13/2004 - MAP - determine character encoding as per RFC 3023
3.0b18 - 2/17/2004 - MAP - always map description to summary_detail (Andrei);
 use libxml2 (if available)
3.0b19 - 3/15/2004 - MAP - fixed bug exploding author information when author
 name was in parentheses; removed ultra-problematic mxTidy support; patch to
 workaround crash in PyXML/expat when encountering invalid entities
 (MarkMoraes); support for textinput/textInput
3.0b20 - 4/7/2004 - MAP - added CDF support
3.0b21 - 4/14/2004 - MAP - added Hot RSS support
3.0b22 - 4/19/2004 - MAP - changed 'channel' to 'feed', 'item' to 'entries' in
 results dict; changed results dict to allow getting values with results.key
 as well as results[key]; work around embedded illformed HTML with half
 a DOCTYPE; work around malformed Content-Type header; if character encoding
 is wrong, try several common ones before falling back to regexes (if this
 works, bozo_exception is set to CharacterEncodingOverride); fixed character
 encoding issues in BaseHTMLProcessor by tracking encoding and converting
 from Unicode to raw strings before feeding data to sgmllib.SGMLParser;
 convert each value in results to Unicode (if possible), even if using
 regex-based parsing
3.0b23 - 4/21/2004 - MAP - fixed UnicodeDecodeError for feeds that contain
 high-bit characters in attributes in embedded HTML in description (thanks
 Thijs van de Vossen); moved guid, date, and date_parsed to mapped keys in
 FeedParserDict; tweaked FeedParserDict.has_key to return True if asking
 about a mapped key
3.0fc1 - 4/23/2004 - MAP - made results.entries[0].links[0] and
 results.entries[0].enclosures[0] into FeedParserDict; fixed typo that could
 cause the same encoding to be tried twice (even if it failed the first time);
 fixed DOCTYPE stripping when DOCTYPE contained entity declarations;
 better textinput and image tracking in illformed RSS 1.0 feeds
3.0fc2 - 5/10/2004 - MAP - added and passed Sam's amp tests; added and passed
 my blink tag tests
3.0fc3 - 6/18/2004 - MAP - fixed bug in _changeEncodingDeclaration that
 failed to parse utf-16 encoded feeds; made source into a FeedParserDict;
 duplicate admin:generatorAgent/@rdf:resource in generator_detail.url;
 added support for image; refactored parse() fallback logic to try other
 encodings if SAX parsing fails (previously it would only try other encodings
 if re-encoding failed); remove unichr madness in normalize_attrs now that
 we're properly tracking encoding in and out of BaseHTMLProcessor; set
 feed.language from root-level xml:lang; set entry.id from rdf:about;
 send Accept header
3.0 - 6/21/2004 - MAP - don't try iso-8859-1 (can't distinguish between
 iso-8859-1 and windows-1252 anyway, and most incorrectly marked feeds are
 windows-1252); fixed regression that could cause the same encoding to be
 tried twice (even if it failed the first time)
3.0.1 - 6/22/2004 - MAP - default to us-ascii for all text/* content types;
 recover from malformed content-type header parameter with no equals sign
 ('text/xml; charset:iso-8859-1')
3.1 - 6/28/2004 - MAP - added and passed tests for converting HTML entities
 to Unicode equivalents in illformed feeds (aaronsw); added and
 passed tests for converting character entities to Unicode equivalents
 in illformed feeds (aaronsw); test for valid parsers when setting
 XML_AVAILABLE; make version and encoding available when server returns
 a 304; add handlers parameter to pass arbitrary urllib2 handlers (like
 digest auth or proxy support); add code to parse username/password
 out of url and send as basic authentication; expose downloading-related
 exceptions in bozo_exception (aaronsw); added <strong>contains</strong> method to
 FeedParserDict (aaronsw); added publisher_detail (aaronsw)
3.2 - 7/3/2004 - MAP - use cjkcodecs and iconv_codec if available; always
 convert feed to UTF-8 before passing to XML parser; completely revamped
 logic for determining character encoding and attempting XML parsing
 (much faster); increased default timeout to 20 seconds; test for presence
 of Location header on redirects; added tests for many alternate character
 encodings; support various EBCDIC encodings; support UTF-16BE and
 UTF16-LE with or without a BOM; support UTF-8 with a BOM; support
 UTF-32BE and UTF-32LE with or without a BOM; fixed crashing bug if no
 XML parsers are available; added support for 'Content-encoding: deflate';
 send blank 'Accept-encoding: ' header if neither gzip nor zlib modules
 are available
3.3 - 7/15/2004 - MAP - optimize EBCDIC to ASCII conversion; fix obscure
 problem tracking xml:base and xml:lang if element declares it, child
 doesn't, first grandchild redeclares it, and second grandchild doesn't;
 refactored date parsing; defined public registerDateHandler so callers
 can add support for additional date formats at runtime; added support
 for OnBlog, Nate, MSSQL, Greek, and Hungarian dates (ytrewq1); added
 zopeCompatibilityHack() which turns FeedParserDict into a regular
 dictionary, required for Zope compatibility, and also makes command-
 line debugging easier because pprint module formats real dictionaries
 better than dictionary-like objects; added NonXMLContentType exception,
 which is stored in bozo_exception when a feed is served with a non-XML
 media type such as 'text/plain'; respect Content-Language as default
 language if not xml:lang is present; cloud dict is now FeedParserDict;
 generator dict is now FeedParserDict; better tracking of xml:lang,
 including support for xml:lang='' to unset the current language;
 recognize RSS 1.0 feeds even when RSS 1.0 namespace is not the default
 namespace; don't overwrite final status on redirects (scenarios:
 redirecting to a URL that returns 304, redirecting to a URL that
 redirects to another URL with a different type of redirect); add
 support for HTTP 303 redirects
4.0 - MAP - support for relative URIs in xml:base attribute; fixed
 encoding issue with mxTidy (phopkins); preliminary support for RFC 3229;
 support for Atom 1.0; support for iTunes extensions; new 'tags' for
 categories/keywords/etc. as array of dict
 {'term': term, 'scheme': scheme, 'label': label} to match Atom 1.0
 terminology; parse RFC 822-style dates with no time; lots of other
 bug fixes
4.1 - MAP - removed socket timeout; added support for chardet library</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  
</div>
</body>
